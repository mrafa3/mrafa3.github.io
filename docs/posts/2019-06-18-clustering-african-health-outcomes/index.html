<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mickey Rafa">
<meta name="dcterms.date" content="2019-06-18">
<meta name="description" content="Exploring how African countries cluster based on their health outcomes">

<title>PART ONE: Cluster Analysis of African Health Outcomes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mickey Rafa</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../workshops.html"> 
<span class="menu-text">Workshops</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">PART ONE: Cluster Analysis of African Health Outcomes</h1>
                  <div>
        <div class="description">
          Exploring how African countries cluster based on their health outcomes
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">data-viz</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">international-development</div>
                <div class="quarto-category">cluster-analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://mrafa3.github.io/">Mickey Rafa</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 18, 2019</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering">Clustering</a>
  <ul class="collapse">
  <li><a href="#wrangling-cluster-results" id="toc-wrangling-cluster-results" class="nav-link" data-scroll-target="#wrangling-cluster-results">Wrangling cluster results</a></li>
  </ul></li>
  <li><a href="#analysis-of-results" id="toc-analysis-of-results" class="nav-link" data-scroll-target="#analysis-of-results">Analysis of results</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NbClust)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)              <span class="co">#for jco color palette</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)              <span class="co">#for PCA</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#library(extrafont)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#library(class)             #for kNN</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#library(caret)             #backup kNN function</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>my.theme <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">face=</span><span class="st">"plain"</span>, <span class="at">size=</span><span class="dv">17</span>, <span class="at">hjust=</span><span class="dv">0</span>), </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">15</span>, <span class="at">hjust=</span><span class="dv">0</span>), </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">face=</span><span class="st">"plain"</span>, <span class="at">size=</span><span class="dv">14</span>), </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>), </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size=</span><span class="dv">13</span>), </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">13</span>), </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span>  <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#F7F7F7"</span>, <span class="at">colour =</span> <span class="cn">NA</span>), </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey90"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey93"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title=</span><span class="fu">element_blank</span>(), </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">hjust=</span><span class="dv">0</span>),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.spacing.x =</span> <span class="fu">unit</span>(.<span class="dv">5</span>, <span class="st">'cm'</span>), </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">'bottom'</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">face=</span><span class="st">"plain"</span>, <span class="at">size=</span><span class="dv">16</span>),</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dataset contains country-level health outcomes projections from the International Futures model from 2015-2065. For this clustering exercise, I am using the 2019 results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>(df <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">'.//data/cluster_health_afr_14mar2019.xlsx'</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,080 × 56
   variable      country dim   unit  scenario `2015` `2016` `2017` `2018` `2019`
   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 DR_OthCommum… Algeria Total &lt;NA&gt;  Base      0.445  0.425  0.41   0.394  0.377
 2 DR_MaligNeoPl Algeria Total &lt;NA&gt;  Base      0.512  0.517  0.521  0.526  0.531
 3 DR_CardioVasc Algeria Total &lt;NA&gt;  Base      1.76   1.80   1.83   1.86   1.89 
 4 DR_Digestive  Algeria Total &lt;NA&gt;  Base      0.063  0.064  0.064  0.064  0.065
 5 DR_Respirato… Algeria Total &lt;NA&gt;  Base      0.153  0.157  0.161  0.164  0.168
 6 DR_OtherNonC… Algeria Total &lt;NA&gt;  Base      0.622  0.618  0.617  0.616  0.614
 7 DR_TrafficAcc Algeria Total &lt;NA&gt;  Base      0.276  0.28   0.279  0.278  0.278
 8 DR_UnIntInj   Algeria Total &lt;NA&gt;  Base      0.146  0.146  0.148  0.149  0.15 
 9 DR_IntInj     Algeria Total &lt;NA&gt;  Base      0.053  0.053  0.053  0.053  0.053
10 DR_Diabetes   Algeria Total &lt;NA&gt;  Base      0.214  0.218  0.223  0.229  0.234
# ℹ 1,070 more rows
# ℹ 46 more variables: `2020` &lt;dbl&gt;, `2021` &lt;dbl&gt;, `2022` &lt;dbl&gt;, `2023` &lt;dbl&gt;,
#   `2024` &lt;dbl&gt;, `2025` &lt;dbl&gt;, `2026` &lt;dbl&gt;, `2027` &lt;dbl&gt;, `2028` &lt;dbl&gt;,
#   `2029` &lt;dbl&gt;, `2030` &lt;dbl&gt;, `2031` &lt;dbl&gt;, `2032` &lt;dbl&gt;, `2033` &lt;dbl&gt;,
#   `2034` &lt;dbl&gt;, `2035` &lt;dbl&gt;, `2036` &lt;dbl&gt;, `2037` &lt;dbl&gt;, `2038` &lt;dbl&gt;,
#   `2039` &lt;dbl&gt;, `2040` &lt;dbl&gt;, `2041` &lt;dbl&gt;, `2042` &lt;dbl&gt;, `2043` &lt;dbl&gt;,
#   `2044` &lt;dbl&gt;, `2045` &lt;dbl&gt;, `2046` &lt;dbl&gt;, `2047` &lt;dbl&gt;, `2048` &lt;dbl&gt;, …</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 1
   variable       
   &lt;chr&gt;          
 1 DR_OthCommumDis
 2 DR_MaligNeoPl  
 3 DR_CardioVasc  
 4 DR_Digestive   
 5 DR_Respiratory 
 6 DR_OtherNonComm
 7 DR_TrafficAcc  
 8 DR_UnIntInj    
 9 DR_IntInj      
10 DR_Diabetes    
11 DR_AIDS        
12 DR_Diarrhea    
13 DR_Malaria     
14 DR_RespInfec   
15 DR_MentalHealth
16 CLPC           
17 HLSTUNT        
18 HLSMOKING      
19 INFMOR         
20 MATMORTRATIO   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#pivot data</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gather</span>(year, val, <span class="dv">6</span><span class="sc">:</span><span class="dv">56</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter on 2019 results</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">'2019'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#select variable, country, and val</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#group by variable and generate z-score for clustering</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">val =</span> <span class="fu">scale</span>(val)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">spread</span>(variable, val)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 21
   country       CLPC DR_AIDS DR_CardioVasc DR_Diabetes DR_Diarrhea DR_Digestive
   &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
 1 Algeria     1.63    -0.948         1.19       0.102      -1.42        -1.95  
 2 Angola     -0.0927  -0.427        -0.951     -0.510       1.10         0.443 
 3 Benin       0.609   -0.610        -0.427     -0.385       0.815        0.0179
 4 Botswana   -0.846    1.68         -0.224      0.835      -0.601       -1.28  
 5 Burkina F…  0.821   -0.709        -0.624     -0.471      -0.0198       0.307 
 6 Burundi    -1.41    -0.636        -0.777     -0.436       2.16         0.597 
 7 Cameroon    0.821    0.663        -0.513     -0.178      -0.117        0.346 
 8 Cape Verde -0.494   -0.637         0.788      0.0205     -1.30        -1.62  
 9 Central A… -1.29     0.902         0.166     -0.367       1.56         1.81  
10 Chad       -0.887   -0.621        -0.466     -0.428       3.26         1.48  
# ℹ 44 more rows
# ℹ 14 more variables: DR_IntInj &lt;dbl&gt;, DR_Malaria &lt;dbl&gt;, DR_MaligNeoPl &lt;dbl&gt;,
#   DR_MentalHealth &lt;dbl&gt;, DR_OthCommumDis &lt;dbl&gt;, DR_OtherNonComm &lt;dbl&gt;,
#   DR_RespInfec &lt;dbl&gt;, DR_Respiratory &lt;dbl&gt;, DR_TrafficAcc &lt;dbl&gt;,
#   DR_UnIntInj &lt;dbl&gt;, HLSMOKING &lt;dbl&gt;, HLSTUNT &lt;dbl&gt;, INFMOR &lt;dbl&gt;,
#   MATMORTRATIO &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="clustering" class="level2">
<h2 class="anchored" data-anchor-id="clustering">Clustering</h2>
<p>The <code>NbClust::</code> package has a handy function for evaluating possible cluster counts on the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(nbclust_eval <span class="ot">&lt;-</span> <span class="fu">NbClust</span>(df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">min.nc =</span> <span class="dv">3</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">max.nc =</span> <span class="dv">10</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">method =</span> <span class="st">"complete"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">index =</span> <span class="st">"all"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/nbclust-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>*** : The Hubert index is a graphical method of determining the number of clusters.
                In the plot of Hubert index, we seek a significant knee that corresponds to a 
                significant increase of the value of the measure i.e the significant peak in Hubert
                index second differences plot. 
 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/nbclust-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>*** : The D index is a graphical method of determining the number of clusters. 
                In the plot of D index, we seek a significant knee (the significant peak in Dindex
                second differences plot) that corresponds to a significant increase of the value of
                the measure. 
 
******************************************************************* 
* Among all indices:                                                
* 3 proposed 3 as the best number of clusters 
* 11 proposed 4 as the best number of clusters 
* 2 proposed 5 as the best number of clusters 
* 6 proposed 9 as the best number of clusters 
* 1 proposed 10 as the best number of clusters 

                   ***** Conclusion *****                            
 
* According to the majority rule, the best number of clusters is  4 
 
 
******************************************************************* </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$All.index
       KL      CH Hartigan     CCC    Scott      Marriot    TrCovW   TraceW
3  1.3365 15.6335   9.0320 -1.3602 214.1099 8.111701e+24 2246.2694 657.1279
4  2.7577 14.9792   3.9393 -0.6230 307.6816 2.549409e+24 1408.7282 558.2614
5  1.2066 12.8423   3.2841 -1.1342 470.0117 1.971161e+23 1269.7717 517.4901
6  0.6502 11.3821   4.6089 -1.6222 529.4997 9.433051e+22 1099.7727 484.9854
7  1.1310 10.9314   4.2211 -1.3236 608.3339 2.982103e+22  949.7958 442.4974
8  1.2908 10.5842   3.4306 -1.0429 721.2091 4.816247e+21  829.7843 406.0318
9  0.6574 10.1550   5.2118 -1.0709 804.4149 1.305667e+21  734.2950 377.8525
10 1.0994 10.4145   5.0686 -0.3855 877.9289 4.131537e+20  587.3426 338.6329
   Friedman  Rubin Cindex     DB Silhouette   Duda Pseudot2   Beale Ratkowsky
3   77.4165 1.6131 0.3862 1.5630     0.2204 0.7517  10.9011  4.4671    0.3345
4   91.5396 1.8988 0.4183 1.3010     0.2417 1.3728  -1.3578 -3.1530    0.3354
5  129.9878 2.0483 0.4345 1.1117     0.2594 0.7780   2.8542  3.6152    0.3124
6  138.8076 2.1856 0.4372 1.1590     0.2306 1.5606  -1.4368 -4.0037    0.2945
7  151.7404 2.3955 0.4470 0.9928     0.2517 1.1591  -4.2540 -1.8522    0.2838
8  165.8865 2.6106 0.4771 0.9086     0.2769 1.0077  -0.0611 -0.0946    0.2745
9  187.7532 2.8053 0.5062 0.8398     0.2872 0.8459   5.4657  2.4565    0.2650
10 204.8779 3.1302 0.5065 1.0891     0.2166 0.6590   5.1736  6.5529    0.2587
       Ball Ptbiserial    Frey McClain   Dunn Hubert SDindex Dindex   SDbw
3  219.0426     0.5310 -0.2141  0.7172 0.2485 0.0033  1.3456 3.2549 0.9642
4  139.5653     0.6220 -0.1200  0.7867 0.2941 0.0037  1.0579 3.0335 0.7583
5  103.4980     0.6294  0.5894  0.7934 0.2943 0.0038  0.9281 2.9045 0.5488
6   80.8309     0.6312 -0.0791  0.8332 0.3004 0.0040  1.0086 2.8171 0.5427
7   63.2139     0.6369  0.0900  0.8393 0.3087 0.0040  0.8304 2.6765 0.3744
8   50.7540     0.6600  0.2276  0.8894 0.3411 0.0040  0.7780 2.5601 0.3213
9   41.9836     0.6640  2.1692  0.9058 0.3628 0.0040  0.7195 2.4562 0.2669
10  33.8633     0.5024  0.2534  2.0917 0.2558 0.0043  1.0667 2.3387 0.2832

$All.CriticalValues
   CritValue_Duda CritValue_PseudoT2 Fvalue_Beale
3          0.8006             8.2179        0e+00
4          0.5935             3.4242        1e+00
5          0.6820             4.6621        0e+00
6          0.5635             3.0984        1e+00
7          0.7956             7.9633        1e+00
8          0.6547             4.2190        1e+00
9          0.7929             7.8336        4e-04
10         0.6820             4.6621        0e+00

$Best.nc
                    KL      CH Hartigan     CCC  Scott      Marriot   TrCovW
Number_clusters 4.0000  3.0000   4.0000 10.0000   5.00 4.000000e+00   4.0000
Value_Index     2.7577 15.6335   5.0926 -0.3855 162.33 3.209998e+24 837.5411
                 TraceW Friedman   Rubin Cindex     DB Silhouette   Duda
Number_clusters  4.0000   5.0000  4.0000 3.0000 9.0000     9.0000 4.0000
Value_Index     58.0952  38.4482 -0.1361 0.3862 0.8398     0.2872 1.3728
                PseudoT2  Beale Ratkowsky    Ball PtBiserial Frey McClain
Number_clusters   4.0000  4.000    4.0000  4.0000      9.000    2  3.0000
Value_Index      -1.3578 -3.153    0.3354 79.4773      0.664   NA  0.7172
                  Dunn Hubert SDindex Dindex   SDbw
Number_clusters 9.0000      0  9.0000      0 9.0000
Value_Index     0.3628      0  0.7195      0 0.2669

$Best.partition
 [1] 1 2 3 3 3 2 3 3 2 2 3 2 3 2 3 1 2 3 3 3 3 3 3 2 3 4 3 1 3 3 3 3 1 1 3 3 3 2
[39] 3 3 3 1 2 2 4 3 2 3 3 3 1 3 3 3</code></pre>
</div>
</div>
<p>This function evaluates 23 heuristics for choosing the cluster amount, and recommends the best number to use based on the count that the most tests recommend. In this case, four clusters is recommended by the largest number of heuristics.</p>
<p>The elbow plot of four clusters supports this recommendation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>), <span class="at">FUNcluster =</span> kmeans, <span class="at">method=</span><span class="st">'wss'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/elbow_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>(kmeans_sdg3 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>)), <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>K-means clustering with 4 clusters of sizes 8, 5, 28, 13

Cluster means:
        CLPC     DR_AIDS DR_CardioVasc DR_Diabetes DR_Diarrhea DR_Digestive
1  1.3482246 -0.79633839     1.8607456   0.8648762 -1.36671009  -1.18128326
2 -0.4612575  2.01614378     0.2989428   1.3413175 -0.11916515  -0.55733621
3 -0.1630247 -0.17010246    -0.4334196  -0.3474342 -0.05180124   0.01649377
4 -0.3011397  0.08098901    -0.3265331  -0.2998032  0.99845702   0.90577858
    DR_IntInj  DR_Malaria DR_MaligNeoPl DR_MentalHealth DR_OthCommumDis
1 -0.54678017 -0.78068551     1.1131725       1.9150416     -1.40760552
2  2.41728180 -0.76340618     0.2580764       0.5803655     -0.53716577
3 -0.24010893 -0.05144041    -0.2683869      -0.4630447     -0.08905388
4 -0.07608597  0.88483434    -0.2062252      -0.4043776      1.26462935
  DR_OtherNonComm DR_RespInfec DR_Respiratory DR_TrafficAcc DR_UnIntInj
1       0.5193418   -1.3234956      0.5339725    0.03751842 -1.46175497
2      -0.6326953   -0.2327741      1.9103998    0.90293248 -0.59792256
3      -0.2793787   -0.1522466     -0.3965467   -0.37603897 -0.09880806
4       0.5254881    1.2319032     -0.2092669    0.43956011  1.34232910
   HLSMOKING    HLSTUNT      INFMOR MATMORTRATIO
1  1.0551313 -0.8965578 -1.56432785  -1.38933306
2  0.7019074 -0.6175282 -0.42921357  -0.56210398
3 -0.3503515  0.1909051 -0.08039168  -0.02551253
4 -0.1646727  0.3780585  1.30089675   1.12611809

Clustering vector:
 [1] 1 4 3 2 3 4 4 1 4 4 3 4 3 4 3 1 4 3 3 3 3 3 3 4 3 2 3 1 3 3 3 3 1 1 3 2 3 4
[39] 3 3 3 1 4 4 2 3 4 2 3 3 1 3 3 3

Within cluster sum of squares by cluster:
[1] 131.30665  49.14012 207.32777 155.21550
 (between_SS / total_SS =  48.8 %)

Available components:

[1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss"
[6] "betweenss"    "size"         "iter"         "ifault"      </code></pre>
</div>
</div>
<section id="wrangling-cluster-results" class="level3">
<h3 class="anchored" data-anchor-id="wrangling-cluster-results">Wrangling cluster results</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(df_cluster_4_results <span class="ot">&lt;-</span> kmeans_sdg3 <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#broom to pull the cluster into the dataframe</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">augment</span>(df) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.cluster, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.cluster =</span> <span class="fu">as.character</span>(.cluster)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 22
   .cluster country         CLPC DR_AIDS DR_CardioVasc DR_Diabetes DR_Diarrhea
   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 1        Algeria       1.63    -0.948         1.19       0.102      -1.42  
 2 4        Angola       -0.0927  -0.427        -0.951     -0.510       1.10  
 3 3        Benin         0.609   -0.610        -0.427     -0.385       0.815 
 4 2        Botswana     -0.846    1.68         -0.224      0.835      -0.601 
 5 3        Burkina Faso  0.821   -0.709        -0.624     -0.471      -0.0198
 6 4        Burundi      -1.41    -0.636        -0.777     -0.436       2.16  
 7 4        Cameroon      0.821    0.663        -0.513     -0.178      -0.117 
 8 1        Cape Verde   -0.494   -0.637         0.788      0.0205     -1.30  
 9 4        Central AfR  -1.29     0.902         0.166     -0.367       1.56  
10 4        Chad         -0.887   -0.621        -0.466     -0.428       3.26  
# ℹ 44 more rows
# ℹ 15 more variables: DR_Digestive &lt;dbl&gt;, DR_IntInj &lt;dbl&gt;, DR_Malaria &lt;dbl&gt;,
#   DR_MaligNeoPl &lt;dbl&gt;, DR_MentalHealth &lt;dbl&gt;, DR_OthCommumDis &lt;dbl&gt;,
#   DR_OtherNonComm &lt;dbl&gt;, DR_RespInfec &lt;dbl&gt;, DR_Respiratory &lt;dbl&gt;,
#   DR_TrafficAcc &lt;dbl&gt;, DR_UnIntInj &lt;dbl&gt;, HLSMOKING &lt;dbl&gt;, HLSTUNT &lt;dbl&gt;,
#   INFMOR &lt;dbl&gt;, MATMORTRATIO &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 159 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): type, country, group

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 3
   type     country                       group        
   &lt;chr&gt;    &lt;chr&gt;                         &lt;chr&gt;        
 1 Regional Cameroon                      Cenral Africa
 2 Regional Central AfR                   Cenral Africa
 3 Regional Chad                          Cenral Africa
 4 Regional Congo, Democratic Republic of Cenral Africa
 5 Regional Congo, Republic of            Cenral Africa
 6 Regional Equa Guinea                   Cenral Africa
 7 Regional Gabon                         Cenral Africa
 8 Regional Sao Tome and Principe         Cenral Africa
 9 Regional Burundi                       East Africa  
10 Regional Comoros                       East Africa  
# ℹ 44 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 23
   .cluster country  group    CLPC DR_AIDS DR_CardioVasc DR_Diabetes DR_Diarrhea
   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 1        Algeria  Nort…  1.63    -0.948         1.19       0.102      -1.42  
 2 4        Angola   Sout… -0.0927  -0.427        -0.951     -0.510       1.10  
 3 3        Benin    West…  0.609   -0.610        -0.427     -0.385       0.815 
 4 2        Botswana Sout… -0.846    1.68         -0.224      0.835      -0.601 
 5 3        Burkina… West…  0.821   -0.709        -0.624     -0.471      -0.0198
 6 4        Burundi  East… -1.41    -0.636        -0.777     -0.436       2.16  
 7 4        Cameroon Cenr…  0.821    0.663        -0.513     -0.178      -0.117 
 8 1        Cape Ve… West… -0.494   -0.637         0.788      0.0205     -1.30  
 9 4        Central… Cenr… -1.29     0.902         0.166     -0.367       1.56  
10 4        Chad     Cenr… -0.887   -0.621        -0.466     -0.428       3.26  
# ℹ 44 more rows
# ℹ 15 more variables: DR_Digestive &lt;dbl&gt;, DR_IntInj &lt;dbl&gt;, DR_Malaria &lt;dbl&gt;,
#   DR_MaligNeoPl &lt;dbl&gt;, DR_MentalHealth &lt;dbl&gt;, DR_OthCommumDis &lt;dbl&gt;,
#   DR_OtherNonComm &lt;dbl&gt;, DR_RespInfec &lt;dbl&gt;, DR_Respiratory &lt;dbl&gt;,
#   DR_TrafficAcc &lt;dbl&gt;, DR_UnIntInj &lt;dbl&gt;, HLSMOKING &lt;dbl&gt;, HLSTUNT &lt;dbl&gt;,
#   INFMOR &lt;dbl&gt;, MATMORTRATIO &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="analysis-of-results" class="level2">
<h2 class="anchored" data-anchor-id="analysis-of-results">Analysis of results</h2>
<p>First, I’ll use the <code>fiz_cluster()</code> function to visualize cluster membership. (There’s further clean-up needed, but I want to see the initial viz).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(kmeans_viz <span class="ot">&lt;-</span> <span class="fu">fviz_cluster</span>(kmeans_sdg3, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">stand =</span> <span class="cn">FALSE</span>, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">ellipse.type =</span> <span class="st">"convex"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">palette =</span> <span class="st">"jco"</span>) <span class="sc">+</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  my.theme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/kmeans_vis-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>What do each of these clusters mean? What do they represent?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>cluster_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#868686FF"</span>, <span class="st">"#CD534CFF"</span>, <span class="st">"#EFC000FF"</span>, <span class="st">"#0073C2FF"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df_cluster_4_results <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(variable, val, <span class="dv">4</span><span class="sc">:</span><span class="dv">23</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">%in%</span> spot_vars) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">recode</span>(variable,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'DR_AIDS'</span> <span class="ot">=</span> <span class="st">'AIDS death rate'</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'DR_CardioVasc'</span> <span class="ot">=</span> <span class="st">'Cardiovascular death rate'</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'MATMORTRATIO'</span> <span class="ot">=</span> <span class="st">'Maternal mortality rate'</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'DR_Respiratory'</span> <span class="ot">=</span> <span class="st">'Respiratory mortality rate'</span>, </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'HLSTUNT'</span> <span class="ot">=</span> <span class="st">'Stunting rate'</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'DR_IntInj'</span> <span class="ot">=</span> <span class="st">'Intentional injury death rate'</span>, </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'DR_Malaria'</span> <span class="ot">=</span> <span class="st">'Malaria death rate'</span>, </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'DR_Diabetes'</span> <span class="ot">=</span> <span class="st">'Diabetes death rate'</span>),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">clust_name =</span> <span class="fu">case_when</span>(.cluster <span class="sc">==</span> <span class="st">'1'</span> <span class="sc">~</span> <span class="st">'CDs'</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                                .cluster <span class="sc">==</span> <span class="st">'2'</span> <span class="sc">~</span> <span class="st">'NCDs'</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>                                .cluster <span class="sc">==</span> <span class="st">'3'</span> <span class="sc">~</span> <span class="st">'NCDs &amp; HIV'</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>                                .cluster <span class="sc">==</span> <span class="st">'4'</span> <span class="sc">~</span> <span class="st">'Double Burden'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x=</span>.cluster,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">y=</span>val,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill=</span>.cluster)) <span class="sc">+</span> </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span> </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> .<span class="dv">2</span>, <span class="at">height =</span> .<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, </span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">'free'</span>,</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_wrap_gen</span>()) <span class="sc">+</span> </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">''</span>,</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">'Each dot represents an African country within its cluster'</span>) <span class="sc">+</span> </span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">'z-score'</span>,</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">'Cluster'</span>) <span class="sc">+</span> </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  my.theme <span class="sc">+</span> </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cluster_fill) <span class="sc">+</span> </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(.<span class="dv">25</span>,<span class="dv">0</span>,.<span class="dv">25</span>,<span class="dv">0</span>, <span class="st">"cm"</span>)),</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/cluster_smallmults-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><strong>Cluster 1</strong>: Higher levels of non-communicable disease reflecting higher development.</p>
<p><strong>Cluster 2</strong>: Highest burdens of HIV/AIDS, diabetes, respiratory illnesses, traffic fatalities, and deaths from intentional injuries.</p>
<p><strong>Cluster 3</strong>: Countries in the middle of the “double burden” of disease, with elevated (but generally falling) burden of communicable disease and rising burdens from non-communicable disease.</p>
<p><strong>Cluster 4</strong>: Communicable disease mortality characterizes these countries. Countries in this cluster are at the beginning of development towards the “double burden” of disease.</p>
<p>Some quick clean-up to support putting labels on the cluster graphic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(df_label_help <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 2
   rowname country     
   &lt;chr&gt;   &lt;chr&gt;       
 1 1       Algeria     
 2 2       Angola      
 3 3       Benin       
 4 4       Botswana    
 5 5       Burkina Faso
 6 6       Burundi     
 7 7       Cameroon    
 8 8       Cape Verde  
 9 9       Central AfR 
10 10      Chad        
# ℹ 44 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   name          x           y       coord cluster
1     1 -4.3024636  1.80865284 21.78241826       1
2     2  2.5755214 -0.07889390  6.63953471       4
3     3  1.0169684  0.33706615  1.14783841       3
4     4 -2.3642511  0.63494494  5.99283814       2
5     5  0.8993824  0.82947169  1.49691205       3
6     6  3.5790154  0.12038452 12.82384342       4
7     7  0.9569876 -1.10554744  2.13806044       4
8     8 -3.1992280  1.56693482 12.69034466       1
9     9  4.1259704 -2.22199890 21.96091056       4
10   10  5.6425998 -2.51144500 38.14628795       4
11   11  0.6317898  0.79935106  1.03812047       3
12   12  2.8034932  0.29375838  7.94586811       4
13   13  0.3687783  1.02798718  1.19275508       3
14   14  1.2758298 -2.43850287  7.57403791       4
15   15 -0.2122328 -0.08452750  0.05218765       3
16   16 -4.8746473  0.56767475 24.08444092       1
17   17  2.1326087 -1.89742082  8.14822560       4
18   18  1.0316133  1.46454137  3.20910741       3
19   19  0.8334748  1.56408985  3.14105736       3
20   20 -0.8819849  0.08342655  0.78485739       3
21   21  0.4273448  0.99698232  1.17659728       3
22   22 -0.7456978  0.84322822  1.26709904       3
23   23  1.0721493 -0.06478235  1.15370079       3
24   24  1.9407232 -0.56190798  4.08214716       4
25   25  0.6686306  3.08182329  9.94470168       3
26   26 -1.6442519 -4.73840005 25.15599931       2
27   27  0.8823869  1.08552443  1.95696991       3
28   28 -5.0939159  1.05318693 27.05718209       1
29   29 -0.1219820  1.81595847  3.31258478       3
30   30  0.7539831  1.67684599  3.38030304       3
31   31  0.9899307  0.48061503  1.21095368       3
32   32  0.4174827  0.35810341  0.30252987       3
33   33 -7.1835908 -2.57711364 58.24549129       1
34   34 -4.8250325  1.68917653 26.13425564       1
35   35  0.8549720  0.78819666  1.35223117       3
36   36 -1.8082677 -0.69571408  3.75385013       2
37   37  2.1517074  1.51364425  6.92096363       3
38   38  3.2091357 -2.09075227 14.66979676       4
39   39 -0.2361615  2.02429432  4.15353976       3
40   40 -0.9941374  0.91320146  1.82224606       3
41   41 -0.9138675  2.43145802  6.74714196       3
42   42 -5.2103788 -3.34420231 38.33173673       1
43   43  2.1218142 -2.41530504 10.33579390       4
44   44  5.2056186 -0.93944297 27.98101823       4
45   45 -3.6462041 -4.98956383 38.19055169       2
46   46 -1.0108568 -0.38050415  1.16661488       3
47   47  4.0455876 -0.62946960 16.76301062       4
48   48 -0.6776526 -1.84331557  3.85702536       2
49   49  0.3131814  1.70183621  2.99432904       3
50   50  0.2815917  0.64157101  0.49090723       3
51   51 -6.5797150 -0.47025448 43.51378831       1
52   52  1.8420731  0.91715107  4.23439936       3
53   53  1.3506020  1.25844087  3.40779929       3
54   54  0.1235718 -0.29045781  0.09963573       3
                         country
1                        Algeria
2                         Angola
3                          Benin
4                       Botswana
5                   Burkina Faso
6                        Burundi
7                       Cameroon
8                     Cape Verde
9                    Central AfR
10                          Chad
11                       Comoros
12 Congo, Democratic Republic of
13            Congo, Republic of
14                 Cote d'Ivoire
15                      Djibouti
16                         Egypt
17                   Equa Guinea
18                       Eritrea
19                      Ethiopia
20                         Gabon
21                        Gambia
22                         Ghana
23                        Guinea
24                    GuineaBiss
25                         Kenya
26                       Lesotho
27                       Liberia
28                         Libya
29                    Madagascar
30                        Malawi
31                          Mali
32                    Mauritania
33                     Mauritius
34                       Morocco
35                    Mozambique
36                       Namibia
37                         Niger
38                       Nigeria
39                        Rwanda
40         Sao Tome and Principe
41                       Senegal
42                    Seychelles
43                     SierraLeo
44                       Somalia
45                  South Africa
46                         Sudan
47                   Sudan South
48                     Swaziland
49                      Tanzania
50                          Togo
51                       Tunisia
52                        Uganda
53                        Zambia
54                      Zimbabwe</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   name          x           y       coord cluster
1     1 -4.3024636  1.80865284 21.78241826       1
2     2  2.5755214 -0.07889390  6.63953471       4
3     3  1.0169684  0.33706615  1.14783841       3
4     4 -2.3642511  0.63494494  5.99283814       2
5     5  0.8993824  0.82947169  1.49691205       3
6     6  3.5790154  0.12038452 12.82384342       4
7     7  0.9569876 -1.10554744  2.13806044       4
8     8 -3.1992280  1.56693482 12.69034466       1
9     9  4.1259704 -2.22199890 21.96091056       4
10   10  5.6425998 -2.51144500 38.14628795       4
11   11  0.6317898  0.79935106  1.03812047       3
12   12  2.8034932  0.29375838  7.94586811       4
13   13  0.3687783  1.02798718  1.19275508       3
14   14  1.2758298 -2.43850287  7.57403791       4
15   15 -0.2122328 -0.08452750  0.05218765       3
16   16 -4.8746473  0.56767475 24.08444092       1
17   17  2.1326087 -1.89742082  8.14822560       4
18   18  1.0316133  1.46454137  3.20910741       3
19   19  0.8334748  1.56408985  3.14105736       3
20   20 -0.8819849  0.08342655  0.78485739       3
21   21  0.4273448  0.99698232  1.17659728       3
22   22 -0.7456978  0.84322822  1.26709904       3
23   23  1.0721493 -0.06478235  1.15370079       3
24   24  1.9407232 -0.56190798  4.08214716       4
25   25  0.6686306  3.08182329  9.94470168       3
26   26 -1.6442519 -4.73840005 25.15599931       2
27   27  0.8823869  1.08552443  1.95696991       3
28   28 -5.0939159  1.05318693 27.05718209       1
29   29 -0.1219820  1.81595847  3.31258478       3
30   30  0.7539831  1.67684599  3.38030304       3
31   31  0.9899307  0.48061503  1.21095368       3
32   32  0.4174827  0.35810341  0.30252987       3
33   33 -7.1835908 -2.57711364 58.24549129       1
34   34 -4.8250325  1.68917653 26.13425564       1
35   35  0.8549720  0.78819666  1.35223117       3
36   36 -1.8082677 -0.69571408  3.75385013       2
37   37  2.1517074  1.51364425  6.92096363       3
38   38  3.2091357 -2.09075227 14.66979676       4
39   39 -0.2361615  2.02429432  4.15353976       3
40   40 -0.9941374  0.91320146  1.82224606       3
41   41 -0.9138675  2.43145802  6.74714196       3
42   42 -5.2103788 -3.34420231 38.33173673       1
43   43  2.1218142 -2.41530504 10.33579390       4
44   44  5.2056186 -0.93944297 27.98101823       4
45   45 -3.6462041 -4.98956383 38.19055169       2
46   46 -1.0108568 -0.38050415  1.16661488       3
47   47  4.0455876 -0.62946960 16.76301062       4
48   48 -0.6776526 -1.84331557  3.85702536       2
49   49  0.3131814  1.70183621  2.99432904       3
50   50  0.2815917  0.64157101  0.49090723       3
51   51 -6.5797150 -0.47025448 43.51378831       1
52   52  1.8420731  0.91715107  4.23439936       3
53   53  1.3506020  1.25844087  3.40779929       3
54   54  0.1235718 -0.29045781  0.09963573       3
                         country    clust_name africa
1                        Algeria          NCDs      1
2                         Angola           CDs      1
3                          Benin Double Burden      1
4                       Botswana    NCDs &amp; HIV      1
5                   Burkina Faso Double Burden      1
6                        Burundi           CDs      1
7                       Cameroon           CDs      1
8                     Cape Verde          NCDs      1
9                    Central AfR           CDs      1
10                          Chad           CDs      1
11                       Comoros Double Burden      1
12 Congo, Democratic Republic of           CDs      1
13            Congo, Republic of Double Burden      1
14                 Cote d'Ivoire           CDs      1
15                      Djibouti Double Burden      1
16                         Egypt          NCDs      1
17                   Equa Guinea           CDs      1
18                       Eritrea Double Burden      1
19                      Ethiopia Double Burden      1
20                         Gabon Double Burden      1
21                        Gambia Double Burden      1
22                         Ghana Double Burden      1
23                        Guinea Double Burden      1
24                    GuineaBiss           CDs      1
25                         Kenya Double Burden      1
26                       Lesotho    NCDs &amp; HIV      1
27                       Liberia Double Burden      1
28                         Libya          NCDs      1
29                    Madagascar Double Burden      1
30                        Malawi Double Burden      1
31                          Mali Double Burden      1
32                    Mauritania Double Burden      1
33                     Mauritius          NCDs      1
34                       Morocco          NCDs      1
35                    Mozambique Double Burden      1
36                       Namibia    NCDs &amp; HIV      1
37                         Niger Double Burden      1
38                       Nigeria           CDs      1
39                        Rwanda Double Burden      1
40         Sao Tome and Principe Double Burden      1
41                       Senegal Double Burden      1
42                    Seychelles          NCDs      1
43                     SierraLeo           CDs      1
44                       Somalia           CDs      1
45                  South Africa    NCDs &amp; HIV      1
46                         Sudan Double Burden      1
47                   Sudan South           CDs      1
48                     Swaziland    NCDs &amp; HIV      1
49                      Tanzania Double Burden      1
50                          Togo Double Burden      1
51                       Tunisia          NCDs      1
52                        Uganda Double Burden      1
53                        Zambia Double Burden      1
54                      Zimbabwe Double Burden      1</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>kmeans_viz_data <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y=</span>y,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span>clust_name,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span>clust_name)) <span class="sc">+</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data=</span>. <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">%in%</span> spotlight),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">label =</span> country), <span class="at">force =</span> <span class="dv">10</span>, <span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggtitle('K-means') + </span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(<span class="st">''</span> <span class="sc">%&lt;-%</span> <span class="st">'  Higher NCD burden, higher life expectancy    -    Higher CD burden, lower life expectancy  '</span> <span class="sc">%-&gt;%</span> <span class="st">''</span>),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="fu">expression</span>(<span class="st">''</span> <span class="sc">%&lt;-%</span> <span class="st">'  Higher burden from AIDS, respiratory and injury deaths'</span>)) <span class="sc">+</span> </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_jco</span>() <span class="sc">+</span> </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  my.theme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/final_viz-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>