[
  {
    "objectID": "posts.html",
    "href": "posts.html",
    "title": "My Portfolio",
    "section": "",
    "text": "Mickey Rafa\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAbout\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBuilding beautiful tables with the gt:: package in R\n\n\n\nQuarto\n\n\nR\n\n\nweb-scraping\n\n\ngt\n\n\n\nThis post outlines how to quickly scrape and clean data from Wikipedia and build a beautiful table in R\n\n\n\nMickey Rafa\n\n\nJul 15, 2024\n\n\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Mickey Rafa",
    "section": "",
    "text": "My name is Mickey, and welcome to my personal portfolio website! Iâ€™ll be adding a selection of data science and viz projects here that showcase the breadth of work that Iâ€™ve completed.\nLetâ€™s connect! Feel free to reach out to me on LinkedIn or send me an email.\nðŸš§ This site is under construction ðŸš§"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "In progress"
  },
  {
    "objectID": "posts/2024-07-15-wikipedia-international-mens-soccer/index.html",
    "href": "posts/2024-07-15-wikipedia-international-mens-soccer/index.html",
    "title": "Building beautiful tables with the gt:: package in R",
    "section": "",
    "text": "In this project, I wanted to experiment with the gt:: package to create a beautiful table using R. This code will walk through scraping a table from Wikipedia of the top international goal scorers in menâ€™s soccer history.\n\nSetup\nRequired packages:\n\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(scales)\nlibrary(ggtext)\nlibrary(htmltools)\nlibrary(sysfonts)\nlibrary(showtext)\nlibrary(rvest)\nlibrary(gt)\nlibrary(sysfonts)\nlibrary(showtext)\nlibrary(countrycode)\n\nData.world has a dataset that consists of country names and URLs associated with .svg images of their national flags, which Iâ€™d like to include within the table for extra style.\n\nflag_db &lt;- read.csv(\"https://query.data.world/s/cnheo22w5mwowz2tfxrbb3z2i3mzya?dws=00000\", header=TRUE, stringsAsFactors=FALSE) %&gt;% \n  #Convert country names into 3-letter country codes\n  mutate(Code = countrycode(sourcevar = Country, origin = \"country.name\", destination = \"iso3c\", warn = FALSE)) %&gt;% \n  select(Country, flag_URL = ImageURL)\n\n\n\nScrape Wikipedia Data\n\nurl_goals &lt;- 'https://en.wikipedia.org/wiki/List_of_men%27s_footballers_with_50_or_more_international_goals'\n\n\n(raw &lt;- url_goals %&gt;%\n  rvest::read_html() %&gt;%\n  rvest::html_nodes(xpath='//*[@id=\"mw-content-text\"]/div[1]/table[2]') %&gt;% \n  html_table() %&gt;% \n  .[[1]] %&gt;% \n  clean_names())\n\n# A tibble: 80 Ã— 10\n    rank player      nation confederation goals caps  goalsper_match career_span\n   &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;      \n 1     1 Cristiano â€¦ Portuâ€¦ UEFA          130   212   0.61           2003â€“      \n 2     2 Lionel Mesâ€¦ Argenâ€¦ CONMEBOL      109   187   0.58           2005â€“      \n 3     3 Ali Daei    Iran   AFC           108[â€¦ 148[â€¦ 0.73           1993â€“2006  \n 4     4 Sunil Chheâ€¦ India  AFC           94    151[â€¦ 0.62           2005â€“2024  \n 5     5 Mokhtar Daâ€¦ Malayâ€¦ AFC           89    142   0.63           1972â€“1985  \n 6     6 Ali Mabkhoâ€¦ Uniteâ€¦ AFC           85    115   0.74           2009â€“      \n 7     6 Romelu Lukâ€¦ Belgiâ€¦ UEFA          85    119   0.71           2010â€“      \n 8     8 Ferenc Pusâ€¦ Hungaâ€¦ UEFA          84    89    0.94           1945â€“1962  \n 9     9 Robert Lewâ€¦ Poland UEFA          83    152   0.55           2008â€“      \n10    10 Godfrey Châ€¦ Zambia CAF           79    111   0.71           1968â€“1980  \n# â„¹ 70 more rows\n# â„¹ 2 more variables: date_of_50th_goal &lt;chr&gt;, ref &lt;chr&gt;\n\n\nFor data cleaning of this Wiki table, we need to: * Remove all footnotes within the table * Convert all chr columns to numeric values * Re-code one of the confederation values so that itâ€™s clean for the by confederation table\n\n(raw &lt;- raw %&gt;% \n  #Remove extra spaces in nation to clean this column\n  mutate(nation = str_replace_all(str_trim(nation), \"\\\\s+\", \" \")) %&gt;%\n  mutate(nation = case_when(\n    str_detect(nation, \"^Hungary\\\\s+Spain$\") ~ \"Hungary\",\n    #re-coding this as United Kingdom to bring in flag\n    str_detect(nation, \"^England\\\\s+England\\\\s+amateurs$\") ~ \"United Kingdom\",\n    TRUE ~ nation\n  )) %&gt;%\n  mutate(confederation = case_when(\n    confederation == \"AFC / OFC[h]\" ~ \"AFC\",\n    TRUE ~ confederation)) %&gt;% \n  #remove footnotes and transform columns to numeric values\n  mutate_at(vars(player, career_span, goals, caps, goalsper_match), \n            ~ str_remove(., \"\\\\[.*\\\\]\")) %&gt;% \n  mutate_at(vars(goals, caps, goalsper_match), \n            as.numeric) %&gt;% \n  left_join(flag_db, by = c('nation' = 'Country')) %&gt;% \n  select(flag_URL, everything()))\n\n# A tibble: 80 Ã— 11\n   flag_URL          rank player nation confederation goals  caps goalsper_match\n   &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;\n 1 https://upload.â€¦     1 Cristâ€¦ Portuâ€¦ UEFA            130   212           0.61\n 2 https://upload.â€¦     2 Lioneâ€¦ Argenâ€¦ CONMEBOL        109   187           0.58\n 3 https://upload.â€¦     3 Ali Dâ€¦ Iran   AFC             108   148           0.73\n 4 https://upload.â€¦     4 Sunilâ€¦ India  AFC              94   151           0.62\n 5 https://upload.â€¦     5 Mokhtâ€¦ Malayâ€¦ AFC              89   142           0.63\n 6 https://upload.â€¦     6 Ali Mâ€¦ Uniteâ€¦ AFC              85   115           0.74\n 7 https://upload.â€¦     6 Romelâ€¦ Belgiâ€¦ UEFA             85   119           0.71\n 8 https://upload.â€¦     8 Ferenâ€¦ Hungaâ€¦ UEFA             84    89           0.94\n 9 https://upload.â€¦     9 Roberâ€¦ Poland UEFA             83   152           0.55\n10 https://upload.â€¦    10 Godfrâ€¦ Zambia CAF              79   111           0.71\n# â„¹ 70 more rows\n# â„¹ 3 more variables: career_span &lt;chr&gt;, date_of_50th_goal &lt;chr&gt;, ref &lt;chr&gt;\n\n\n\n\nData Prep\nNow that I have the data scraped and cleaned, Iâ€™m interested in making some tables using the ::gt() package. Tables are great for communicating summary information, so Iâ€™ll first build a graphic of the top 12 international goal scorers of all time.\n\ndf_top_scorers &lt;- raw %&gt;% \n  slice(1:12)\n\nThen, Iâ€™ll extract the min and max values from the table for conditional formatting of the table.\n\nmin_goals &lt;- df_top_scorers$goals %&gt;% min()\nmax_goals &lt;- df_top_scorers$goals %&gt;% max()\n\ngoals_palette &lt;- col_numeric(c(\"lightgreen\", \"darkgreen\"), \n                             domain = c(min_goals, max_goals), \n                             alpha = .75)\n\nFor the first table, Iâ€™ll put the columns and styling in place first. Iâ€™m going to build a table that includes the flag_url column â€“ which is messy at first â€“ and then Iâ€™ll use a function to render the flag graphics from those URLs. This blog post is excellent â€“ it showed me how to do this step-by-step.\n\n(tbl_top_scorers &lt;- df_top_scorers %&gt;% \n  select(rank, player, career_span, flag_URL, nation, goals, caps, goalsper_match) %&gt;% \n  gt() %&gt;% \n  #rename columns\n  cols_label(rank = 'Rank',\n             player = 'Name',\n             career_span = 'Career Span',\n             nation = 'Country',\n             goals = 'Total Goals Scored',\n             caps = 'Matches',\n             goalsper_match = 'Goals per Match') %&gt;% \n  #add table title\n  tab_header(title = md(\"**Total Goals Scored in Men's International Soccer Matches**\")) %&gt;% \n  tab_source_note(source_note = \"Data from Wikipedia\") %&gt;% \n  #apply new style to all column headers\n  tab_style(\n    locations = cells_column_labels(columns = everything()),\n    style = list(\n      #thick border\n      cell_borders(sides = \"bottom\", weight = px(3)),\n      #make text bold\n      cell_text(weight = \"bold\")\n    )\n  ) %&gt;% \n  #apply different style to title\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(\n              cell_text(weight = \"bold\", size = 24)\n            )) %&gt;% \n  data_color(columns = c(goals),\n             colors = goals_palette) %&gt;% \n  opt_all_caps() %&gt;% \n  opt_table_font(\n    font = list(\n      google_font(\"Chivo\"),\n      default_fonts()\n    )\n  ) %&gt;% \n  tab_options(\n    #remove border between column headers and title\n    column_labels.border.top.width = px(3),\n    column_labels.border.top.color = \"transparent\",\n    #remove border around the table\n    table.border.top.color = \"transparent\",\n    table.border.bottom.color = \"transparent\",\n    #adjust font sizes and alignment\n    source_notes.font.size = 12,\n    heading.align = \"left\"\n  ))\n\n\n\n\n\n\n\nTotal Goals Scored in Menâ€™s International Soccer Matches\n\n\nRank\nName\nCareer Span\nflag_URL\nCountry\nTotal Goals Scored\nMatches\nGoals per Match\n\n\n\n\n1\nCristiano Ronaldo\n2003â€“\nhttps://upload.wikimedia.org/wikipedia/commons/5/5c/Flag_of_Portugal.svg\nPortugal\n130\n212\n0.61\n\n\n2\nLionel Messi\n2005â€“\nhttps://upload.wikimedia.org/wikipedia/commons/1/1a/Flag_of_Argentina.svg\nArgentina\n109\n187\n0.58\n\n\n3\nAli Daei\n1993â€“2006\nhttps://upload.wikimedia.org/wikipedia/commons/c/ca/Flag_of_Iran.svg\nIran\n108\n148\n0.73\n\n\n4\nSunil Chhetri\n2005â€“2024\nhttps://upload.wikimedia.org/wikipedia/en/4/41/Flag_of_India.svg\nIndia\n94\n151\n0.62\n\n\n5\nMokhtar Dahari\n1972â€“1985\nhttps://upload.wikimedia.org/wikipedia/commons/6/66/Flag_of_Malaysia.svg\nMalaysia\n89\n142\n0.63\n\n\n6\nAli Mabkhout\n2009â€“\nhttps://upload.wikimedia.org/wikipedia/commons/c/cb/Flag_of_the_United_Arab_Emirates.svg\nUnited Arab Emirates\n85\n115\n0.74\n\n\n6\nRomelu Lukaku\n2010â€“\nhttps://upload.wikimedia.org/wikipedia/commons/9/92/Flag_of_Belgium_%28civil%29.svg\nBelgium\n85\n119\n0.71\n\n\n8\nFerenc PuskÃ¡s\n1945â€“1962\nhttps://upload.wikimedia.org/wikipedia/commons/c/c1/Flag_of_Hungary.svg\nHungary\n84\n89\n0.94\n\n\n9\nRobert Lewandowski\n2008â€“\nhttps://upload.wikimedia.org/wikipedia/en/1/12/Flag_of_Poland.svg\nPoland\n83\n152\n0.55\n\n\n10\nGodfrey Chitalu\n1968â€“1980\nhttps://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Zambia.svg\nZambia\n79\n111\n0.71\n\n\n10\nNeymar\n2010â€“\nhttps://upload.wikimedia.org/wikipedia/en/0/05/Flag_of_Brazil.svg\nBrazil\n79\n128\n0.62\n\n\n12\nHussein Saeed\n1977â€“1990\nhttps://upload.wikimedia.org/wikipedia/commons/f/f6/Flag_of_Iraq.svg\nIraq\n78\n137\n0.57\n\n\n\nData from Wikipedia\n\n\n\n\n\n\n\n\n\n(tbl_top_scorers &lt;- tbl_top_scorers %&gt;% \n    text_transform(\n    #Apply a function to a column\n    locations = cells_body(c(flag_URL)),\n    fn = function(x) {\n      #Return an image of set dimensions\n      web_image(\n        url = x,\n        height = 12\n      )\n    }\n  ) %&gt;% \n  #Hide column header flag_URL and reduce width\n  cols_width(c(flag_URL) ~ px(30)) %&gt;% \n  cols_label(flag_URL = \"\"))\n\n\n\n\n\n\n\nTotal Goals Scored in Menâ€™s International Soccer Matches\n\n\nRank\nName\nCareer Span\n\nCountry\nTotal Goals Scored\nMatches\nGoals per Match\n\n\n\n\n1\nCristiano Ronaldo\n2003â€“\n\nPortugal\n130\n212\n0.61\n\n\n2\nLionel Messi\n2005â€“\n\nArgentina\n109\n187\n0.58\n\n\n3\nAli Daei\n1993â€“2006\n\nIran\n108\n148\n0.73\n\n\n4\nSunil Chhetri\n2005â€“2024\n\nIndia\n94\n151\n0.62\n\n\n5\nMokhtar Dahari\n1972â€“1985\n\nMalaysia\n89\n142\n0.63\n\n\n6\nAli Mabkhout\n2009â€“\n\nUnited Arab Emirates\n85\n115\n0.74\n\n\n6\nRomelu Lukaku\n2010â€“\n\nBelgium\n85\n119\n0.71\n\n\n8\nFerenc PuskÃ¡s\n1945â€“1962\n\nHungary\n84\n89\n0.94\n\n\n9\nRobert Lewandowski\n2008â€“\n\nPoland\n83\n152\n0.55\n\n\n10\nGodfrey Chitalu\n1968â€“1980\n\nZambia\n79\n111\n0.71\n\n\n10\nNeymar\n2010â€“\n\nBrazil\n79\n128\n0.62\n\n\n12\nHussein Saeed\n1977â€“1990\n\nIraq\n78\n137\n0.57\n\n\n\nData from Wikipedia\n\n\n\n\n\n\n\n\n\n\nTop scorers by confederation or continent\nNext, Iâ€™d like to see who are the top-5 all-time goal scorers by confederation.\n\n(df_scorers_by_confed &lt;- raw %&gt;% \n  filter(!is.na(goals)) %&gt;% \n  group_by(confederation) %&gt;% \n  slice(1:5))\n\n# A tibble: 25 Ã— 11\n# Groups:   confederation [5]\n   flag_URL          rank player nation confederation goals  caps goalsper_match\n   &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;\n 1 https://upload.â€¦     3 Ali Dâ€¦ Iran   AFC             108   148           0.73\n 2 https://upload.â€¦     4 Sunilâ€¦ India  AFC              94   151           0.62\n 3 https://upload.â€¦     5 Mokhtâ€¦ Malayâ€¦ AFC              89   142           0.63\n 4 https://upload.â€¦     6 Ali Mâ€¦ Uniteâ€¦ AFC              85   115           0.74\n 5 https://upload.â€¦    12 Husseâ€¦ Iraq   AFC              78   137           0.57\n 6 https://upload.â€¦    10 Godfrâ€¦ Zambia CAF              79   111           0.71\n 7 https://upload.â€¦    19 Kinnaâ€¦ Malawi CAF              71   117           0.61\n 8 https://upload.â€¦    25 Hossaâ€¦ Egypt  CAF              69   177           0.39\n 9 https://upload.â€¦    31 Didieâ€¦ Ivoryâ€¦ CAF              65   105           0.62\n10 https://upload.â€¦    45 Mohamâ€¦ Egypt  CAF              57   100           0.57\n# â„¹ 15 more rows\n# â„¹ 3 more variables: career_span &lt;chr&gt;, date_of_50th_goal &lt;chr&gt;, ref &lt;chr&gt;\n\n\n\n#re-run the min_goals and max_goals functions\nmin_goals &lt;- df_scorers_by_confed$goals %&gt;% min(na.rm = TRUE)\nmax_goals &lt;- df_scorers_by_confed$goals %&gt;% max(na.rm = TRUE)\n\ngoals_palette &lt;- col_numeric(c(\"lightgreen\", \"darkgreen\"), \n                             domain = c(min_goals, max_goals), \n                             alpha = .75)\n\n\n(tbl_scorers_by_confed &lt;- df_scorers_by_confed %&gt;% \n  select(rank, player, career_span, flag_URL, nation, goals, caps, goalsper_match, confederation) %&gt;% \n  gt(groupname_col = \"confederation\") %&gt;% \n    cols_label(rank = 'Global Rank',\n             player = 'Name',\n             career_span = 'Career Span',\n             nation = 'Country',\n             goals = 'Total Goals Scored',\n             caps = 'Matches',\n             goalsper_match = 'Goals per Match') %&gt;% \n  #add table title\n  tab_header(title = md(\"**Total Goals Scored in Men's International Soccer Matches**\")) %&gt;% \n  tab_source_note(source_note = \"Data from Wikipedia\") %&gt;% \n  #apply new style to all column headers\n  tab_style(\n    locations = cells_column_labels(columns = everything()),\n    style = list(\n      #thick border\n      cell_borders(sides = \"bottom\", weight = px(3)),\n      #make text bold\n      cell_text(weight = \"bold\")\n    )\n  ) %&gt;% \n  #apply different style to title\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(\n              cell_text(weight = \"bold\", size = 24)\n            )) %&gt;% \n  data_color(columns = c(goals),\n             colors = goals_palette) %&gt;% \n  opt_all_caps() %&gt;% \n  opt_table_font(\n    font = list(\n      google_font(\"Chivo\"),\n      default_fonts()\n    )\n  ) %&gt;% \n  tab_options(\n    #remove border between column headers and title\n    column_labels.border.top.width = px(3),\n    column_labels.border.top.color = \"transparent\",\n    #remove border around the table\n    table.border.top.color = \"transparent\",\n    table.border.bottom.color = \"transparent\",\n    #adjust font sizes and alignment\n    source_notes.font.size = 12,\n    heading.align = \"left\"\n  ) %&gt;% \n  text_transform(\n    #Apply a function to a column\n    locations = cells_body(c(flag_URL)),\n    fn = function(x) {\n      #Return an image of set dimensions\n      web_image(\n        url = x,\n        height = 12\n      )\n    }\n  ) %&gt;% \n  #Hide column header flag_URL and reduce width\n  cols_width(c(flag_URL) ~ px(30)) %&gt;% \n  cols_label(flag_URL = \"\"))\n\n\n\n\n\n\n\nTotal Goals Scored in Menâ€™s International Soccer Matches\n\n\nGlobal Rank\nName\nCareer Span\n\nCountry\nTotal Goals Scored\nMatches\nGoals per Match\n\n\n\n\nAFC\n\n\n3\nAli Daei\n1993â€“2006\n\nIran\n108\n148\n0.73\n\n\n4\nSunil Chhetri\n2005â€“2024\n\nIndia\n94\n151\n0.62\n\n\n5\nMokhtar Dahari\n1972â€“1985\n\nMalaysia\n89\n142\n0.63\n\n\n6\nAli Mabkhout\n2009â€“\n\nUnited Arab Emirates\n85\n115\n0.74\n\n\n12\nHussein Saeed\n1977â€“1990\n\nIraq\n78\n137\n0.57\n\n\nCAF\n\n\n10\nGodfrey Chitalu\n1968â€“1980\n\nZambia\n79\n111\n0.71\n\n\n19\nKinnah Phiri\n1973â€“1981\n\nMalawi\n71\n117\n0.61\n\n\n25\nHossam Hassan\n1985â€“2006\n\nEgypt\n69\n177\n0.39\n\n\n31\nDidier Drogba\n2002â€“2014\n\nIvory Coast\n65\n105\n0.62\n\n\n45\nMohamed Salah\n2011â€“\n\nEgypt\n57\n100\n0.57\n\n\nCONCACAF\n\n\n22\nStern John\n1995â€“2012\n\nTrinidad and Tobago\n70\n115\n0.61\n\n\n27\nCarlos Ruiz\n1998â€“2016\n\nGuatemala\n68\n133\n0.51\n\n\n45\nCarlos PavÃ³n\n1993â€“2010\n\nHonduras\n57\n101\n0.56\n\n\n45\nClint Dempsey\n2004â€“2018\n\nUnited States\n57\n141\n0.40\n\n\n45\nLandon Donovan\n2000â€“2014\n\nUnited States\n57\n157\n0.36\n\n\nCONMEBOL\n\n\n2\nLionel Messi\n2005â€“\n\nArgentina\n109\n187\n0.58\n\n\n10\nNeymar\n2010â€“\n\nBrazil\n79\n128\n0.62\n\n\n13\nPelÃ©\n1957â€“1971\n\nBrazil\n77\n92\n0.84\n\n\n25\nLuis SuÃ¡rez\n2007â€“\n\nUruguay\n69\n142\n0.49\n\n\n35\nRonaldo\n1994â€“2011\n\nBrazil\n62\n98\n0.63\n\n\nUEFA\n\n\n1\nCristiano Ronaldo\n2003â€“\n\nPortugal\n130\n212\n0.61\n\n\n6\nRomelu Lukaku\n2010â€“\n\nBelgium\n85\n119\n0.71\n\n\n8\nFerenc PuskÃ¡s\n1945â€“1962\n\nHungary\n84\n89\n0.94\n\n\n9\nRobert Lewandowski\n2008â€“\n\nPoland\n83\n152\n0.55\n\n\n14\nVivian Woodward\n1903â€“1914\n\nUnited Kingdom\n75\n53\n1.42\n\n\n\nData from Wikipedia"
  }
]