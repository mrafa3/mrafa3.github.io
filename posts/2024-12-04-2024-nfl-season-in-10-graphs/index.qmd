---
title: "The 2024 NFL Season in 10 Graphs"
description: ""
author:
  - name: Mickey Rafa
    url: https://mrafa3.github.io/
date: 12-04-2024
categories: [R, data-viz, sports] # self-defined categories
# image: theme_map.png
draft: true # setting this to `true` will prevent your post from appearing on your listing page until you're ready!
code-annotations: hover
format:
  html:
    toc: true
    number-sections: true
    code-fold: true
    code-summary: "Show the code"
    warning: false
    message: false
editor: 
  markdown: 
    wrap: 72
fig-cap-location: margin
title-block-banner: "#f0f3f5"
title-block-banner-color: "black"
---

```{r setup, include=TRUE, warning=FALSE, message=FALSE}
#| echo=FALSE
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
    tidyverse,
    nflverse,
    plotly,
    gt,
    gtExtras,
    gtUtils,
    ggfx,
    ggforce,
    rvest,
    httr,
    jsonlite,
    patchwork,
    ggtext,
    ggrepel,
    ggimage,
    dlookr,
    lubridate,
    showtext,
    sysfonts,
    janitor,
    grid,
    ggiraph,
    glue,
    here
)    

sysfonts::font_add_google("Lexend")
showtext::showtext_auto()
```

```{r nfl_analytics_theme, include=TRUE}
#| echo=FALSE
theme_nfl_analytics <- function(..., base_size = 12) {
  theme(
    text = element_text(family = "Lexend", size = base_size, color = "black"),
    axis.ticks = element_blank(),
    axis.title = element_text(face = "bold"),
    axis.text = element_text(face = "bold"),
    plot.title.position = "plot",
    plot.title = element_textbox_simple(size = 16, vjust = .02, hjust = 0.5, face='bold'),
    plot.subtitle = element_textbox(hjust = 0.5, lineheight = .4),
    plot.caption = element_textbox(size = 8),
    panel.grid.minor = element_blank(),
    panel.grid.major =  element_line(color = "#d0d0d0"),
    panel.background = element_rect(fill = "#f7f7f7"),
    plot.background = element_rect(fill = "#f7f7f7"),
    panel.border = element_blank(),
    legend.background = element_rect(color = "#F7F7F7"),
    legend.key = element_rect(color = "#F7F7F7"),
    legend.title = element_text(face = "bold", hjust = .5),
    strip.text = element_text(face = "bold"))
}
```

```{r teams, include=TRUE, message=FALSE}
#| echo=FALSE
teams <- load_teams(current = TRUE)
```

```{r make_2024_df, include=TRUE}
#| echo=FALSE
pbp_2024 <- load_pbp(seasons = 2024)
pbp_2024_reg <- pbp_2024 %>% filter(season_type == 'REG')
ftn_2024 <- load_ftn_charting(seasons = 2024)

pbp_2024_reg <- pbp_2024_reg %>% 
  left_join(x=.,
            y=ftn_2024,
            by=c('game_id' = 'nflverse_game_id',
                 'play_id' = 'nflverse_play_id',
                 'season',
                 'week'))
```

```{r params, include=TRUE}
#| echo=FALSE
max_week_param <- pbp_2024_reg %>% 
  summarise(max(week)) %>% 
  pull()
```

# Rookie QBs: performance and inconsistency

A major storyline of the 2024 season started with the NFL Draft, when six quarterbacks were selected in the first 12 picks. Four of those QBs saw significant snaps during the season: Caleb Williams (Chicago, Pick #1), Jayden Daniels (Washington, Pick #2), Drake Maye (New England, Pick #3), and Bo Nix (Denver, Pick #12).

:::  column-margin
Six QBs selected in the first round ties the record set in the 1983 draft -- the draft that included John Elway, Jim Kelly, and Dan Marino.
:::

Jayden Daniels' had the best campaign of this rookie class and among the best seasons among all passers. Daniels finished fourth in total quarterback rating (QBR) and in total expected points added (EPA), the two primary composite metrics used to evaluate quarterback play. And not only that, Daniels led the Commanders to a surprising NFC title birth in his rookie season.

While this story could have centered on Jayden Daniels' successful year, or the volume of snaps played by this rookie class, the *inconsistency* of play stands out. Aside from Daniels' remarkable season, the other rookie first round QBs turned in a combined record of 19-30 in games that they started in. The below graphic shows the weekly EPA per dropback of the four first rounders with significant playing time, highlighting the performance of Daniels and Bo Nix, who each led their teams to the playoffs.

```{r rookie_qb_epa_weekly_2024, include=TRUE}
#| echo=FALSE
rookie_qb_epa_weekly_2024 <- pbp_2024_reg %>% 
  filter(passer %in% c('J.Daniels', 'C.Williams', 'B.Nix', 'D.Maye')) %>% 
  group_by(game_id, week, posteam, passer, passer_id) %>% 
  summarise(across(
    c('qb_epa', 'pass_attempt', 'air_epa', 'yac_epa'),
    list(
        mean = ~round(mean(., na.rm = TRUE), 2),
        sum = ~round(sum(., na.rm = TRUE), 2)
      ),
      .names = "{.fn}_{.col}"
    ),
    .groups = 'drop') %>% 
  filter(sum_pass_attempt >= 10)


rookie_qp_epa_season_2024 <- pbp_2024_reg %>% 
  filter(passer %in% c('J.Daniels', 'C.Williams', 'B.Nix', 'D.Maye')) %>% 
  group_by(posteam, passer, passer_id) %>% 
  summarise(across(
    c('qb_epa', 'pass_attempt', 'air_epa', 'yac_epa'),
    list(
        mean = ~round(mean(., na.rm = TRUE), 2),
        sum = ~round(sum(., na.rm = TRUE), 2)
      ),
      .names = "{.fn}_{.col}"
    ),
    .groups = 'drop')
```

```{r last_week_rookie_qb, include=TRUE}
last_week_rookie_qb <- rookie_qb_epa_weekly_2024 %>%
  group_by(passer) %>%
  slice_max(week, n = 1)
```


```{r plot_rookie_qb_epa, include=TRUE, fig.width=9}
rookie_qb_epa_weekly_2024 %>% 
  ggplot(.,
         aes(x=week,
             y=mean_qb_epa,
             color=posteam,
             alpha=if_else(passer %in% c('C.Williams','D.Maye'), 'Not playoffs', 'Playoffs'))) + 
  geom_line(linewidth=1.2) + 
  geom_point(data=last_week_rookie_qb,
             size=3) + 
  geom_text(data=last_week_rookie_qb,
            aes(x=week + 1,
                label=passer),
            family='Lexend') + 
  geom_hline(yintercept = 0, color='black', linetype='dashed') + 
  labs(title='EPA per dropback of 1st round rookies in 2024',
       # subtitle = glue('Through Week {max_week_param}'),
       caption = 'Source: {nflverse} package<br>Minimum 10 attempts to qualify as a full game',
       x='Week',
       y='EPA/dropback') + 
  scale_alpha_manual(values = c('Not playoffs' = .3,
                                'Playoffs' = 1)) + 
  theme_nfl_analytics() +
  scale_color_nfl(type='secondary') + 
  theme(legend.position = 'none')
  # theme(axis.title.y = element_text(angle=0))
```

