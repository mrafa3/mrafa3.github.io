{
  "hash": "ac968f7638b1a3416bfaf3a77b3191db",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"PART TWO: Data Manipulation and Visualization Basics using R\"\ndescription: \"This skills workshop introduced R and the tidyverse to Master's students at the University of Denver\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\n    #orcid: 0000-0002-5300-3075\ndate: 05-15-2018\ncategories: [R, tidyverse, ggplot, data-viz, domestic-politics] # self-defined categories\n#citation: \n # url: https://mrafa3.github.io/posts/2024-07-15-wikipedia-international-mens-soccer/ \nimage: civil_rights.png\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n---\n\n\nThis is a continuation of the \"Data Manipulation and Visualization Basics using R\" workshop, which was originally delivered in 2018. This post assumes that you know the content from Part 1.\n\n# Overview\n\nThis workshop session will help you familiarize with two of R's most widely used packages, `dplyr` and `ggplot2`. These packages are part of what is called the **tidyverse**, which is a collection of packages that are designed to work together in R to simplify and data manipulation, discovery, visualization, analysis, and more.[^1]\n\n<center>\n\n![Each tile is a package that makes up the \"tidyverse\"](tidyverse.png)\n\n</center>\n\n`dplyr` is designed to standardize the data management and manipulation process in R. `dplyr` has a small set of functions that help users navigate the most common challenges of data manipulation.[^2]  Generally speaking, these include restructuring, filtering, grouping, and summarizing your data, as well as creating new variables for your analysis.  \n\n`ggplot2` is a package for visualizing data. In this lesson, we will learn the building blocks for creating beautiful visualizations. We will learn how to produce **histograms**, **scatter plots**, and **line plots**, and we will visualize ungrouped and grouped data.  \n\n`dplyr` and `ggplot2` are packages that supply a **grammar** for data manipulation and data visualization, respectively. This workshop will only scratch the surface of what is possible, but learning the fundamentals of these packages can empower you to do a ton of exciting things in R.  \n\n[^1]: https://www.tidyverse.org/packages/\n[^2]: https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html\n\n# Part Two: Analysis of U.S. Supreme Court data\n\n<center>\n\n![The U.S. Supreme Court](https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Oblique_facade_2%2C_US_Supreme_Court.jpg/1024px-Oblique_facade_2%2C_US_Supreme_Court.jpg)\n\n</center>\n\n1.  Install the tidyverse and gapminder packages (`install.packages()`)  \n\n\n\n\n\n2.  Load the tidyverse and gapminder packages (`library()` and `require()` effectively do the same thing, but `library()` provides more information that is occasionally useful)  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)      #for data management, manipulation, visualization, and exploratory data analysis\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\n#for graphics styling\nlibrary(ggtext)         #for use of richtext in graphics\nlibrary(glue)           #to embed html in text\nlibrary(patchwork)      #for plot_annotation() function\n```\n:::\n\n\n3.  I am providing a dataset on all U.S. Supreme Court decisions since 1946, which are organized by case and justice vote. These data come from The Supreme Court Database at the Washington University in St. Louis Law School.[^10] I'd like for you to put together the skills that you've learned in this session to do some exploratory analysis of the data. \n\n[^10]: http://scdb.wustl.edu/data.php\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsup_court <- read.csv(url(\"https://github.com/mrafa3/korbel-skills-workshops/raw/master/supreme_court_1946_2018.csv\"))\n```\n:::\n\n\n4.  Let's look at the data together. Use the `glimpse()` function to peek at the sup_court object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(sup_court)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 78,857\nColumns: 10\n$ caseId        <chr> \"1946-001\", \"1946-001\", \"1946-001\", \"1946-001\", \"1946-00…\n$ caseName      <chr> \"HALLIBURTON OIL WELL CEMENTING CO. v. WALKER et al., DO…\n$ term          <int> 1946, 1946, 1946, 1946, 1946, 1946, 1946, 1946, 1946, 19…\n$ chief         <chr> \"Vinson\", \"Vinson\", \"Vinson\", \"Vinson\", \"Vinson\", \"Vinso…\n$ majVotes      <int> 8, 8, 8, 8, 8, 8, 8, 8, 8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5,…\n$ minVotes      <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4,…\n$ justiceName   <chr> \"HHBurton\", \"RHJackson\", \"WODouglas\", \"FFrankfurter\", \"S…\n$ issueAreaName <chr> \"Economic Activity\", \"Economic Activity\", \"Economic Acti…\n$ directionName <chr> \"conservative\", \"liberal\", \"liberal\", \"liberal\", \"libera…\n$ majorityName  <chr> \"dissent\", \"majority\", \"majority\", \"majority\", \"majority…\n```\n\n\n:::\n:::\n\n\nExplore the dataset on your own, and see what you can find! Try to ask a question of the dataset and come up with an answer. In case you want some examples to guide you, you might ask (the \"Code\" box is there if you are stuck, but try your best to do this on your own.)...\n\n*  Which Chief Justice has presided over the most cases since 1946? Which has heard the fewest?  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsup_court %>% \n  group_by(chief) %>% \n  summarise(count_cases = n()) %>% \n  arrange(desc(count_cases))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  chief     count_cases\n  <chr>           <int>\n1 Burger          25076\n2 Warren          19736\n3 Rehnquist       18322\n4 Roberts          8416\n5 Vinson           7307\n```\n\n\n:::\n:::\n\n\n*  How many decisions has Justice Gorsuch made in his short tenure on the bench? How often has he cast a dissenting opinion? How often has he made decisions that would be considered conservative? What types of cases has he heard most often to this point? (hint: Gorsuch can be found using the justiceName variable with **NMGorsuch**.) \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsup_court %>% \n  filter(justiceName == 'NMGorsuch') %>% \n  group_by(justiceName) %>% \n  summarise(count_cases = n())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  justiceName count_cases\n  <chr>             <int>\n1 NMGorsuch            44\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsup_court %>% \n  filter(justiceName == 'NMGorsuch') %>% \n  group_by(justiceName, majorityName) %>% \n  summarise(count_cases = n())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'justiceName'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n# Groups:   justiceName [1]\n  justiceName majorityName count_cases\n  <chr>       <chr>              <int>\n1 NMGorsuch   dissent                3\n2 NMGorsuch   majority              14\n3 NMGorsuch   <NA>                  27\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsup_court %>% \n  filter(justiceName == 'NMGorsuch') %>% \n  group_by(justiceName, directionName) %>% \n  summarise(count_cases = n())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'justiceName'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n# Groups:   justiceName [1]\n  justiceName directionName count_cases\n  <chr>       <chr>               <int>\n1 NMGorsuch   conservative           14\n2 NMGorsuch   liberal                 3\n3 NMGorsuch   <NA>                   27\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsup_court %>% \n  filter(justiceName == 'NMGorsuch') %>% \n  group_by(justiceName, issueAreaName) %>% \n  summarise(count_cases = n()) %>% \n  mutate(perc_cases = round(count_cases / sum(count_cases) * 100, 1)) %>% \n  arrange(desc(perc_cases))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'justiceName'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 4\n# Groups:   justiceName [1]\n  justiceName issueAreaName      count_cases perc_cases\n  <chr>       <chr>                    <int>      <dbl>\n1 NMGorsuch   Civil Rights                11       25  \n2 NMGorsuch   Judicial Power              10       22.7\n3 NMGorsuch   Economic Activity            7       15.9\n4 NMGorsuch   Criminal Procedure           6       13.6\n5 NMGorsuch   Due Process                  5       11.4\n6 NMGorsuch   First Amendment              3        6.8\n7 NMGorsuch   Federalism                   2        4.5\n```\n\n\n:::\n:::\n\n\n*  Justice Kennedy has a reputation as being the swing voter on the Supreme Court. How might you test this conventional wisdom with this dataset? (hint: you might consider using the **majVotes** and **minVotes** variables for this question) \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsup_court %>% \n  filter(majVotes == 5,\n         minVotes == 4) %>% \n  group_by(justiceName, majorityName) %>% \n  summarise(count_cases = n()) %>% \n  mutate(perc_cases = round(count_cases / sum(count_cases) * 100, 1)) %>% \n  arrange(desc(perc_cases))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'justiceName'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 74 × 4\n# Groups:   justiceName [37]\n   justiceName majorityName count_cases perc_cases\n   <chr>       <chr>              <int>      <dbl>\n 1 AJGoldberg  majority              30       78.9\n 2 AMKennedy   majority             390       76  \n 3 FMVinson    majority              81       71.1\n 4 SFReed      majority              99       68.8\n 5 LFPowell    majority             280       68.1\n 6 NMGorsuch   majority               2       66.7\n 7 SDOConnor   majority             352       66.2\n 8 WEBurger    majority             260       65.5\n 9 TCClark     majority             167       65.2\n10 BRWhite     majority             431       64.5\n# ℹ 64 more rows\n```\n\n\n:::\n:::\n\n\n*  Which justice has heard the most Supreme Court Cases since 1946? (hint: the justice is the primary unit of analysis) \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsup_court %>% \n  group_by(justiceName) %>% \n  summarise(count_cases = n()) %>% \n  arrange(desc(count_cases))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 37 × 2\n   justiceName count_cases\n   <chr>             <int>\n 1 WJBrennan          5325\n 2 BRWhite            4943\n 3 WHRehnquist        4529\n 4 JPStevens          4260\n 5 WODouglas          4001\n 6 TMarshall          3879\n 7 HABlackmun         3768\n 8 PStewart           3590\n 9 HLBlack            3302\n10 SDOConnor          2910\n# ℹ 27 more rows\n```\n\n\n:::\n:::\n\n\n*  What are the trends in the types of case heard by term? What is the trend in civil rights cases -- compared with other issue areas -- over time? (hint: **BY term and issue area**)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(sup_court_term_issue <- sup_court %>% \n  group_by(term, issueAreaName) %>% \n  summarise(count_cases = n()) %>% \n  arrange(term, desc(count_cases)))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'term'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 807 × 3\n# Groups:   term [71]\n    term issueAreaName        count_cases\n   <int> <chr>                      <int>\n 1  1946 Economic Activity            432\n 2  1946 Judicial Power               189\n 3  1946 Criminal Procedure           171\n 4  1946 Unions                       126\n 5  1946 Federal Taxation              90\n 6  1946 First Amendment               72\n 7  1946 Civil Rights                  63\n 8  1946 Federalism                    54\n 9  1946 Interstate Relations          36\n10  1946 Due Process                   27\n# ℹ 797 more rows\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsup_court_term_issue %>% \n  filter(!is.na(issueAreaName)) %>% \n  ggplot(.) + \n  geom_line(aes(x=term,\n                y=count_cases,\n                color=issueAreaName))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/sup_court_issue_history_viz1-1.png){fig-align='center' width=960}\n:::\n:::\n\n\nTo create a graphic, I'll show how you can create a theme to add to your ggplot object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy.theme <- theme(\n  text = element_text(family = 'Arial'), \n  plot.title = element_textbox_simple(color=\"black\", face=\"bold\", size=18, hjust=0), \n  plot.subtitle = element_textbox_simple(color=\"black\", size=12, hjust=0), \n  axis.text = element_text(size=15), \n  axis.ticks = element_line(color=\"gray90\"),\n  plot.caption = element_textbox_simple(color=\"black\", size=12), \n  panel.background =  element_blank(), \n  panel.grid.major = element_line(color=\"gray90\"),\n  panel.border = element_blank(), \n  legend.position = 'none',\n  strip.text = element_text(color=\"black\", size=14, face='bold'),\n  strip.background = element_blank())\n```\n:::\n\n\nAnd I'll create objects for the title, subtitle, and caption text.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntitle_text <- glue(\"Count of <span style='color:darkgreen;font-face:bold'>civil rights</span> cases heard by the U.S. Supreme Court over time\")\nsubtitle_text <- glue(\"<br>Count of cases\")\ncaption_text <- glue(\"*The Supreme Court Database* at the Washington University in St. Louis Law School\")\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsup_court_term_issue %>% \n  filter(!is.na(issueAreaName)) %>% \n  mutate(CivilRights = ifelse(issueAreaName=='Civil Rights', 'Civil Rights', 'Other')) %>% \n  ggplot(.) + \n  geom_line(aes(x=term,\n                y=count_cases,\n                group=issueAreaName,\n                color=CivilRights),\n            linewidth=1.1) + \n  labs(x='',\n       y='') + \n  scale_color_manual(values = c('Civil Rights' = 'darkgreen',\n                                'Other' = 'lightgray')) +\n  my.theme + \n  plot_annotation(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text, \n    theme = theme(text = element_text(family = 'Arial'),\n                  plot.title = element_textbox_simple(color=\"black\", \n                                                      face=\"bold\", size=20, hjust=0),\n                  plot.subtitle = element_textbox_simple(color=\"black\", \n                                                      size=15, hjust=0),\n                  plot.caption = element_textbox_simple(color=\"black\")))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/sup_court_issue_history_viz2-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n*  Does the Court seem to have strong tendencies for votes based on the issue area? (*Probably many ways that you could think about answering this one.*)\n\n\n\n\n\n*  Justice Scalia was known as a staunch conservative presence on the bench. Were there some issues that he leaned more centrist? (hint: `group_by()` and `summarise()` would come in handy here, yet again)  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsup_court %>% \n  filter(justiceName == 'AScalia') %>% \n  group_by(justiceName, issueAreaName, directionName) %>% \n  summarise(count_cases = n()) %>% \n  mutate(perc_cases = round(count_cases / sum(count_cases) *100, 1)) %>% \n  filter(directionName == 'liberal') %>% \n  arrange(-perc_cases)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'justiceName', 'issueAreaName'. You can\noverride using the `.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 5\n# Groups:   justiceName, issueAreaName [12]\n   justiceName issueAreaName      directionName count_cases perc_cases\n   <chr>       <chr>              <chr>               <int>      <dbl>\n 1 AScalia     Federal Taxation   liberal                47       69.1\n 2 AScalia     Federalism         liberal                83       50.9\n 3 AScalia     Economic Activity  liberal               234       45.5\n 4 AScalia     Attorneys          liberal                19       39.6\n 5 AScalia     Due Process        liberal                37       34.9\n 6 AScalia     Judicial Power     liberal               126       32.7\n 7 AScalia     Unions             liberal                22       30.6\n 8 AScalia     First Amendment    liberal                55       30.4\n 9 AScalia     Civil Rights       liberal               134       29.1\n10 AScalia     Criminal Procedure liberal               207       27.8\n11 AScalia     Privacy            liberal                13       22.4\n12 AScalia     Miscellaneous      liberal                 2       13.3\n```\n\n\n:::\n:::\n\n\n* To truly answer a question like the previous one, you would want to take into account the directionality of \nall voting justices by issue area. For instance, if you explored the previous question, you found that Scalia voted \"liberal\" on almost 70% of Federal Taxation cases. However, if the Court has a tendency to vote liberal on this issue, then Scalia might not be as \"liberal\" on this issue as it might seem. This question is a bit more complicated, but does Scalia *lean liberal* based on the Court's tendencies in Federal Taxation Cases? (*This question still uses `dplyr` -- and if you'd like, `ggplot2` -- but with a few bells and whistles.*)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(sup_court_fedtax <- sup_court %>% \n  filter(term > 1980, issueAreaName == 'Federal Taxation') %>% \n  group_by(justiceName, issueAreaName, directionName) %>% \n  summarise(count_cases = n(), .groups = \"drop_last\") %>% \n  mutate(perc_cases = count_cases / sum(count_cases)) %>% \n  filter(directionName == 'liberal') %>% \n  ungroup() %>% \n  left_join(x=.,\n            y=baseline_vote,\n            by='issueAreaName'))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 19 × 6\n   justiceName issueAreaName    directionName count_cases perc_cases\n   <chr>       <chr>            <chr>               <int>      <dbl>\n 1 AMKennedy   Federal Taxation liberal                47      0.746\n 2 AScalia     Federal Taxation liberal                47      0.691\n 3 BRWhite     Federal Taxation liberal                47      0.922\n 4 CThomas     Federal Taxation liberal                27      0.574\n 5 DHSouter    Federal Taxation liberal                29      0.707\n 6 EKagan      Federal Taxation liberal                 4      0.5  \n 7 HABlackmun  Federal Taxation liberal                41      0.774\n 8 JGRoberts   Federal Taxation liberal                10      0.833\n 9 JPStevens   Federal Taxation liberal                48      0.6  \n10 LFPowell    Federal Taxation liberal                16      0.64 \n11 RBGinsburg  Federal Taxation liberal                29      0.784\n12 SAAlito     Federal Taxation liberal                 9      0.75 \n13 SDOConnor   Federal Taxation liberal                44      0.579\n14 SGBreyer    Federal Taxation liberal                27      0.771\n15 SSotomayor  Federal Taxation liberal                 7      0.875\n16 TMarshall   Federal Taxation liberal                28      0.683\n17 WEBurger    Federal Taxation liberal                16      0.8  \n18 WHRehnquist Federal Taxation liberal                55      0.724\n19 WJBrennan   Federal Taxation liberal                29      0.744\n# ℹ 1 more variable: baseline_issue_vote <dbl>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(scales)                 #for changing axis label to include '%'\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'scales'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:purrr':\n\n    discard\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:readr':\n\n    col_factor\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsup_court_fedtax %>% \n  filter(count_cases >=10) %>% \n  mutate(fedtax_lean = ifelse(perc_cases > baseline_issue_vote, 'Liberal', 'Conservative')) %>% \n  ggplot(.) + \n  geom_point(aes(x=perc_cases,\n                 y=reorder(justiceName, perc_cases),\n                 color=fedtax_lean), size=5) + \n  geom_vline(xintercept = sup_court_fedtax$baseline_issue_vote) + \n  annotate(geom='text', x=.48, y='JGRoberts', \n           label=paste('Baseline vote for Federal Taxation cases is ', \n                       round(sup_court_fedtax$baseline_issue_vote[1] * 100), '%', sep = ''),\n           size=5) + \n  scale_x_continuous(labels = percent,\n                     limits = c(0, 1)) + \n  ggtitle('The Court leans liberal on Federal Taxation cases',\n          subtitle = 'Percent of Federal Taxation cases with liberal decision by Justice since 1980') + \n  labs(x='Percent of cases coded as a liberal decision\\n',\n       y='',\n       color='',\n       caption='Source: Washington University of St. Louis\\nThe Supreme Court Database\\nExcluded Justices with less than 10 Federal Taxation cases') + \n  theme_minimal() + \n  scale_color_manual(values = c('Liberal' = 'blue',\n                                'Conservative' = 'red')) + \ntheme(legend.position = 'top',\n        text = element_text(size=15),\n        plot.title = element_text(size=18, face='bold'),\n\n        plot.subtitle = element_text(size=16),\n        strip.text = element_text(size=15, face='bold'))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot_fedtax-1.png){fig-align='center' width=960}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}