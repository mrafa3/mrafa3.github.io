{
  "hash": "21cafd315193b5d92da22e831db6f834",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualizing the prevalence and occurence of modern slavery globally\"\ndescription: \"Remaking a table from the Global Slavery Index Report (2023) by Walk Free\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\ndate: 12-12-2024\ncategories: [R, \"#MakeoverMonday\", gt] # self-defined categories\nimage: \"mm_2024_47_thumbnail.png\"\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n\neditor_options: \n  chunk_output_type: inline\n  \nexecute: \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n\n\n\n![Table illustrating the country-level prevalence and absolute estimates of modern slavery. Data source: Walk Free's Global Slavery Index Report (2023).](mm_2024_47.png){#fig-1}\n\n![Bubble plot illustrating the country-level estimates of enslaved people. Bubble size corresponds with the estimated number of people in slavery in that country, and color corresponds to the geographic region. Data source: Walk Free's Global Slavery Index Report (2023).](mm_2024_47_circlepack.png){#fig-2}\n\n![Companion chart with Figure 2, showing the five countries in each region with the largest estimates of enslaved people. Data source: Walk Free's Global Slavery Index Report (2023).](mm_2024_47_top5_by_region.png){#fig-3}\n\n# 1. Load Packages & Setup\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,\n    devtools,\n    httr,\n    readxl,\n    dlookr,\n    ggtext,\n    gt,\n    gtExtras,  #for font awesome icons in gt tables\n    ggbump,\n    ggcirclepack,\n    showtext,\n    tidycountries,\n    janitor,   #for clean_names()\n    scales,\n    patchwork,\n    htmltools, #for tagList()\n    glue,\n    here,\n    geomtextpath\n)  \n\n# install_github(\"EvaMaeRey/ggcirclepack\")\n```\n:::\n\n\n\n\n# 2. Read in the Data\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nResponse [https://download.data.world/file_download/makeovermonday/2024w47-global-slavery-index/MM%20W49%20-%20Global%20Slavery%20Index%202023.xlsx?auth=eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJwcm9kLXVzZXItY2xpZW50Om1yYWZhMyIsImlzcyI6ImFnZW50Om1yYWZhMzo6ODg0MjQ2ZDItMTgzMy00NmZjLTk2YTMtZjQ2MWMzMDJjOTZiIiwiaWF0IjoxNzM0MDE4Mzg5LCJyb2xlIjpbInVzZXIiLCJ1c2VyX2FwaV9hZG1pbiIsInVzZXJfYXBpX2VudGVycHJpc2VfYWRtaW4iLCJ1c2VyX2FwaV9yZWFkIiwidXNlcl9hcGlfd3JpdGUiXSwiZ2VuZXJhbC1wdXJwb3NlIjpmYWxzZSwidXJsIjoiNjI5OGY4ZmE0MDlkZTYxNTk5ZjFmM2M1Zjk4YjA1ZjVkYzcyZmE1ZCJ9.41u7KXt0E1E6-eg9iVwIiM5F-9nxsSrpPHJJnTtHXVoynnZWCU5kBr2b3B6OGXtBMjOkJXsDt4ybxJbSW5nn7g]\n  Date: 2024-12-13 18:05\n  Status: 200\n  Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\n  Size: 126 kB\n<ON DISK>  /var/folders/ck/dmgn8lbx6vl8sl89vlhr0sv00000gn/T//Rtmp879t4D/file79131c38e2a0.xlsx\n```\n\n\n:::\n:::\n\n\n\n\n# 3. Examine the Data \n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 17 × 6\n   variables        types missing_count missing_percent unique_count unique_rate\n   <chr>            <chr>         <int>           <dbl>        <int>       <dbl>\n 1 country          char…             0            0             180      1     \n 2 population       nume…             0            0             176      0.978 \n 3 region           char…             0            0               5      0.0278\n 4 estimated_preva… nume…            20           11.1           161      0.894 \n 5 estimated_numbe… nume…            20           11.1           118      0.656 \n 6 governance_issu… nume…            20           11.1           161      0.894 \n 7 lack_of_basic_n… nume…            20           11.1           161      0.894 \n 8 inequality_vuln… nume…            20           11.1           160      0.889 \n 9 disenfranchised… nume…            20           11.1           160      0.889 \n10 effects_of_conf… nume…            20           11.1           160      0.889 \n11 total_vulnerabi… nume…            20           11.1           161      0.894 \n12 survivors_of_sl… nume…             4            2.22           21      0.117 \n13 criminal_justic… nume…             4            2.22           19      0.106 \n14 coordination_oc… nume…             4            2.22            8      0.0444\n15 risk_factors_su… nume…             4            2.22           14      0.0778\n16 government_and_… nume…             4            2.22            5      0.0278\n17 government_resp… nume…             4            2.22           42      0.233 \n```\n\n\n:::\n:::\n\n\n\n\n# 4. Tidy the Data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df %>% \n  mutate(country = case_match(country,\n                              'Türkiye' ~ 'Turkey',\n                              'United States of America' ~ 'United States',\n                              'Democratic Republic of the Congo' ~ 'DR Congo',\n                              'Viet Nam' ~ 'Vietnam',\n                              \"Côte d'Ivoire\" ~ 'Ivory Coast',\n                              'Lao PDR' ~ 'Laos',\n                              'Brunei Darussalam' ~ 'Brunei',\n                              .default = country),\n         percentile_nmbr_in_slavery = \n           round(100 * percent_rank(estimated_number_of_people_in_modern_slavery), 0),\n         rank_prevalence = rank(-estimated_prevalence_of_modern_slavery_per_1_000_population),\n         rank_absolute = round(rank(-estimated_number_of_people_in_modern_slavery), 0),\n         perc_ttl_nmbr_in_slavery = estimated_number_of_people_in_modern_slavery / sum(estimated_number_of_people_in_modern_slavery, na.rm=TRUE)) %>% \n  left_join(x=.,\n            y=country_df,\n            by=c('country' = 'common_name'))\n```\n:::\n\n\n\n\n# 5. Evaluate the Original Plot\n\n![Original plot visualizing countries with the highest and lowest estimated prevalence of modern slavery. Source: Walk Free](mm_wk47_2024_orig.png){#fig-2}\n\nThis is an interesting dataset that reminds me of some work that I contributed to at the Pardee Center. There's a lot that could be explored here, including things like mapping or analyzing the data with cluster analysis or PCA.\n\nI like a chart to display this information, but there’s some elements that I’ll reconsider:\n\n*  The **color encoding of prevalence rate has no meaning**. It's also odd/counterintuitive to use yellow for the countries with the highest prevalence and red for those with the lowest.\n*  The **chart titles aren't clear as a standalone**, and I typically prefer to make charts that can be lifted from reports while maintaining enough context to explain.\n*  The **number of people estimated to be in modern slavery is washed out** by the prevalence rates. Yes, prevalence rate likely corresponds to the subtitle of the charts – countries with poor governance or high conflict zones are likely to have higher rates of slavery. But I couldn’t help but notice Japan’s estimate is very high, despite it being among the bottom 10 in prevalence rate. There could be something there to work on. Maybe adding a column for percentile rank of the number of people estimated to be in slavery conditions.\n*  Slicing this and show the top and bottom 10 by prevalence rate is an efficient use of space, but the distribution of **prevalence rate is heavily skewed, which seems to make that approach less meaningful**.\n*  I'd like to **add the country flags** to the table, because it's a small design element that improves the recognition of some countries (at least for some). I have never used the {tidycountries} package, so I'll give that a try.\n\n# 6. Visualization Parameters \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregion_cols <- c('Asia and the Pacific' = \"#8dd3c7\",\n                 'Europe and Central Asia' = \"#ffffb3\",\n                 'Africa' = \"#bebada\",\n                 'Americas' = \"#fb8072\",\n                 'Arab States' = \"#80b1d3\")\n\nregion_cols_alpha <- sapply(region_cols, alpha, alpha = 0.2)\n\nmy_theme <- theme(\n  text = element_text(family = 'Lato', size=12, color='black'), \n  axis.ticks = element_blank(), \n  plot.background = element_rect(color='white'),\n  panel.background =  element_blank(), \n  legend.background = element_blank(), \n  panel.grid.major = element_blank(),\n  panel.grid.minor = element_blank(),\n  panel.border = element_blank(), \n  legend.title=element_blank(), \n  legend.position = 'none')\n```\n:::\n\n\n\n\n\n# 7. Plot \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngt_walk_free <- df %>% \n  select(flags_png, country, rank_prevalence, estimated_prevalence_of_modern_slavery_per_1_000_population, estimated_number_of_people_in_modern_slavery, percentile_nmbr_in_slavery) %>%\n  arrange(rank_prevalence) %>% \n  slice_max(n=25, estimated_prevalence_of_modern_slavery_per_1_000_population) %>% \n  gt() %>% \n  cols_label(country = '',\n             flags_png = '',\n             rank_prevalence = 'Rank (Prevalence)',\n             estimated_prevalence_of_modern_slavery_per_1_000_population = 'Prevalence Rate',\n             estimated_number_of_people_in_modern_slavery = '# of People (percentile rank)') %>% \n  tab_header(title = md(\"**Countries with highest prevalence modern slavery from the Global Slavery Index Report (2023)**\"),\n             subtitle = md(\"Prevalence defined as the estimated number of people in slavery per 1,000 population<br><br>Highlighted rows indicate countries that are in the top 25% in terms of the number of people in slavery and includes many countries with relatively low prevalence rates, including South Korea, Argentina, Italy, and the United States\")) %>% \n  tab_source_note(source_note = \"Estimates from Walk Free's Global Slavery Index Report (2023)\") %>% \n  gt_merge_stack(col1 = estimated_number_of_people_in_modern_slavery, col2 = percentile_nmbr_in_slavery) %>%\n  fmt_number(columns = estimated_number_of_people_in_modern_slavery,\n             decimals = 0) %>% \n  fmt_number(columns = estimated_prevalence_of_modern_slavery_per_1_000_population,\n             decimals = 1) %>% \n  gt_img_rows(\n    columns = flags_png,\n    height = 10\n  ) %>% \n  gt_highlight_rows(\n    rows = percentile_nmbr_in_slavery >= 75,# a logic statement\n    fill = \"gray90\",\n    bold_target_only = FALSE) %>% \n  tab_style(\n    style = cell_text(size = px(35)),\n    locations = cells_title(groups = \"title\")\n  ) %>% \n  data_color(columns = estimated_prevalence_of_modern_slavery_per_1_000_population,\n             palette = c(\"white\", \"red\")) %>%\n  gt_theme_538()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_circlepack <- df %>% \n   filter(complete.cases(.)) %>% \n   ggplot(., \n       aes(id=country, \n           area=estimated_number_of_people_in_modern_slavery,\n           fill=region)) +\n  ggcirclepack::geom_circlepack(linewidth = 1) +\n  ggcirclepack::geom_circlepack_text() + \n  coord_fixed() + \n  labs(title=glue(\"<span style='color:#8dd3c7'>**Asia and the Pacific**</span> has an estimated **29 million people in slavery**\"),\n       subtitle='This constitutes nearly **60% of the global estimate** of people in slavery<br>**5 of the top 6 countries** are in the Asia and the Pacific region',\n       caption='**Source**: Walk Free<br>Global Slavery Index Report (2023)') + \n  scale_fill_manual(values = region_cols) + \n  my_theme + \n  theme(plot.title = element_textbox_simple(size=rel(3.4), margin = margin(t=20, b=6, l=-50),\n                                            lineheight = .4),\n        plot.subtitle = element_textbox(size=rel(2), margin = margin(l=-50), lineheight = .4),\n        plot.caption = element_textbox(size=rel(1.5), margin = margin(r=-10), lineheight = .4),\n        axis.text = element_blank())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngt_walk_free_region_top_5 <- df %>% \n  group_by(region) %>% \n  slice_max(n=5, estimated_number_of_people_in_modern_slavery) %>% \n  ungroup() %>% \n  select(flags_png, country, region, estimated_number_of_people_in_modern_slavery, rank_absolute) %>% \n  gt(groupname_col = 'region') %>% \n  cols_label(country = '',\n             flags_png = '',\n             estimated_number_of_people_in_modern_slavery = '# of People',\n             rank_absolute = 'Global Rank') %>% \n  tab_header(title = md(\"**Estimates of modern slavery by region from the Global Slavery Index (2023)**\"),\n             subtitle = \"Top 5 countries in each region shown\") %>% \n  tab_source_note(source_note = \"Estimates from Walk Free's Global Slavery Index Report (2023)\") %>% \n  # gt_merge_stack(col1 = estimated_number_of_people_in_modern_slavery, col2 = percentile_nmbr_in_slavery) %>%\n  fmt_number(columns = estimated_number_of_people_in_modern_slavery,\n             decimals = 0) %>% \n  gt_img_rows(\n    columns = flags_png,\n    height = 10\n  ) %>% \n  data_color(columns = estimated_number_of_people_in_modern_slavery,\n             palette = c(\"white\", \"red\")) %>%\n  tab_style(\n    style = list(\n      cell_fill(color = region_cols_alpha['Asia and the Pacific']),\n      cell_text(weight = \"bold\")\n    ),\n    locations = cells_row_groups(groups = \"Asia and the Pacific\")\n  ) %>%\n  tab_style(\n    style = list(\n      cell_fill(color = region_cols_alpha['Europe and Central Asia']),\n      cell_text(weight = \"bold\")\n    ),\n    locations = cells_row_groups(groups = \"Europe and Central Asia\")\n  ) %>%\n  tab_style(\n    style = list(\n      cell_fill(color = region_cols_alpha['Africa']),\n      cell_text(weight = \"bold\")\n    ),\n    locations = cells_row_groups(groups = \"Africa\")\n  ) %>%\n  tab_style(\n    style = list(\n      cell_fill(color = region_cols_alpha['Americas']),\n      cell_text(weight = \"bold\")\n    ),\n    locations = cells_row_groups(groups = \"Americas\")\n  ) %>%\n  tab_style(\n    style = list(\n      cell_fill(color = region_cols_alpha['Arab States']),\n      cell_text(weight = \"bold\")\n    ),\n    locations = cells_row_groups(groups = \"Arab States\")\n  ) %>% \n  tab_style(\n    style = cell_text(size = px(35)),\n    locations = cells_title(groups = \"title\")\n  ) %>% \n  gt_theme_538()\n```\n:::\n\n\n\n\n# 8. Save \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# TOP 25 PREVALENCE TABLE\ngt_walk_free %>% \n  gtsave(\n  filename = glue(\"mm_{mm_year}_{mm_week}.png\"),\n  path = here::here('.//visualizations/2024-12-12-mm-wk47-2024/')\n)\n\n# CIRCLE PLOT\nggsave(\n  filename = glue(\"mm_{mm_year}_{mm_week}_circlepack.png\"),\n  plot = plot_circlepack,\n  width = 4, height = 4, units = \"in\", dpi = 320\n)\n\n# TOP 5 BY REGION TABLE\ngt_walk_free_region_top_5 %>% \n  gtsave(\n  filename = glue(\"mm_{mm_year}_{mm_week}_top5_by_region.png\"),\n  path = here::here('.//visualizations/2024-12-12-mm-wk47-2024/')\n)\n\n# make thumbnail for page\nmagick::image_read(glue(\"mm_{mm_year}_{mm_week}.png\")) %>%\n  magick::image_resize(geometry = \"400\") %>%\n  magick::image_write(glue(\"mm_{mm_year}_{mm_week}_thumbnail.png\"))\n```\n:::\n\n\n\n\n# 9. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.0 (2024-04-24)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.6.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: America/Denver\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] geomtextpath_0.1.4      here_1.0.1              glue_1.8.0             \n [4] htmltools_0.5.8.1       patchwork_1.3.0         scales_1.3.0           \n [7] janitor_2.2.0           tidycountries_0.1.0     showtext_0.9-7         \n[10] showtextdb_3.0          sysfonts_0.8.9          ggcirclepack_0.0.0.9000\n[13] ggbump_0.1.0            gtExtras_0.5.0          gt_0.11.1              \n[16] ggtext_0.1.2            dlookr_0.6.3            readxl_1.4.3           \n[19] httr_1.4.7              devtools_2.4.5          usethis_3.0.0          \n[22] lubridate_1.9.3         forcats_1.0.0           stringr_1.5.1          \n[25] dplyr_1.1.4             purrr_1.0.2             readr_2.1.5            \n[28] tidyr_1.3.1             tibble_3.2.1            ggplot2_3.5.1          \n[31] tidyverse_2.0.0         pacman_0.5.1           \n\nloaded via a namespace (and not attached):\n  [1] rstudioapi_0.17.1       jsonlite_1.8.9          magrittr_2.0.3         \n  [4] magick_2.8.5            farver_2.1.2            rmarkdown_2.28         \n  [7] ragg_1.3.3              fs_1.6.4                vctrs_0.6.5            \n [10] memoise_2.0.1           paletteer_1.6.0         base64enc_0.1-3        \n [13] curl_5.2.3              cellranger_1.1.0        sass_0.4.9             \n [16] KernSmooth_2.23-24      htmlwidgets_1.6.4       fontawesome_0.5.2      \n [19] cachem_1.1.0            commonmark_1.9.2        mime_0.12              \n [22] lifecycle_1.0.4         pkgconfig_2.0.3         webshot2_0.1.1         \n [25] R6_2.5.1                fastmap_1.2.0           shiny_1.9.1            \n [28] snakecase_0.11.1        digest_0.6.37           colorspace_2.1-1       \n [31] rematch2_2.1.2          ps_1.8.0                rprojroot_2.0.4        \n [34] pkgload_1.4.0           textshaping_0.4.0       labeling_0.4.3         \n [37] fansi_1.0.6             timechange_0.3.0        compiler_4.4.0         \n [40] proxy_0.4-27            remotes_2.5.0           fontquiver_0.2.1       \n [43] withr_3.0.2             backports_1.5.0         DBI_1.2.3              \n [46] pkgbuild_1.4.4          Rttf2pt1_1.3.12         sessioninfo_1.2.2      \n [49] classInt_0.4-10         tools_4.4.0             chromote_0.3.1         \n [52] units_0.8-5             reactable_0.4.4         httpuv_1.6.15          \n [55] extrafontdb_1.0         promises_1.3.0          gridtext_0.1.5         \n [58] grid_4.4.0              sf_1.0-18               checkmate_2.3.2        \n [61] generics_0.1.3          gtable_0.3.6            tzdb_0.4.0             \n [64] class_7.3-22            websocket_1.4.2         hms_1.1.3              \n [67] xml2_1.3.6              utf8_1.2.4              pillar_1.9.0           \n [70] markdown_1.13           later_1.3.2             tidyselect_1.2.1       \n [73] pagedown_0.21           fontLiberation_0.1.0    miniUI_0.1.1.1         \n [76] knitr_1.48              fontBitstreamVera_0.1.1 gridExtra_2.3          \n [79] svglite_2.1.3           xfun_0.48               stringi_1.8.4          \n [82] yaml_2.3.10             kableExtra_1.4.0        evaluate_1.0.1         \n [85] extrafont_0.19          gdtools_0.4.0           packcircles_0.3.7      \n [88] cli_3.6.3               xtable_1.8-4            systemfonts_1.1.0      \n [91] munsell_0.5.1           processx_3.8.4          Rcpp_1.0.13-1          \n [94] ellipsis_0.3.2          profvis_0.4.0           urlchecker_1.0.1       \n [97] viridisLite_0.4.2       hrbrthemes_0.8.7        e1071_1.7-16           \n[100] rlang_1.1.4            \n```\n\n\n:::\n:::\n\n\n\n:::\n\n# 10. Github Repository \n\n::: {.callout-tip collapse=\"true\"}\n\n##### Expand for GitHub Repo\n \n[Access the GitHub repository here](https://github.com/mrafa3/mrafa3.github.io)\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}