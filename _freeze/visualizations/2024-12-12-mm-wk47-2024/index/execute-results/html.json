{
  "hash": "8f4ec035683aab9b277e126f3f309fac",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualizing the prevalence and occurence of modern slavery globally\"\ndescription: \"Remaking a table from the Global Slavery Index Report by Walk Free\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\ndate: 12-12-2024\ncategories: [R, \"#MakeoverMonday\", gt] # self-defined categories\nimage: \"mm_2024_47_thumbnail.png\"\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n\neditor_options: \n  chunk_output_type: inline\n  \nexecute: \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n\n\n![Table illustrating the country-level prevalence and absolute estimates of modern slavery. Source: Walk Free's Global Slavery Index Report.](mm_2024_47.png){#fig-1}\n\n# 1. Load Packages & Setup\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,\n    httr,\n    readxl,\n    dlookr,\n    ggtext,\n    gt,\n    gtExtras,  #for font awesome icons in gt tables\n    ggbump,\n    showtext,\n    tidycountries,\n    janitor,   #for clean_names()\n    scales,\n    htmltools, #for tagList()\n    glue,\n    here,\n    geomtextpath\n)    \n```\n:::\n\n\n\n# 2. Read in the Data\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nResponse [https://download.data.world/file_download/makeovermonday/2024w47-global-slavery-index/MM%20W49%20-%20Global%20Slavery%20Index%202023.xlsx?auth=eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJwcm9kLXVzZXItY2xpZW50Om1yYWZhMyIsImlzcyI6ImFnZW50Om1yYWZhMzo6ODg0MjQ2ZDItMTgzMy00NmZjLTk2YTMtZjQ2MWMzMDJjOTZiIiwiaWF0IjoxNzM0MDE4Mzg5LCJyb2xlIjpbInVzZXIiLCJ1c2VyX2FwaV9hZG1pbiIsInVzZXJfYXBpX2VudGVycHJpc2VfYWRtaW4iLCJ1c2VyX2FwaV9yZWFkIiwidXNlcl9hcGlfd3JpdGUiXSwiZ2VuZXJhbC1wdXJwb3NlIjpmYWxzZSwidXJsIjoiNjI5OGY4ZmE0MDlkZTYxNTk5ZjFmM2M1Zjk4YjA1ZjVkYzcyZmE1ZCJ9.41u7KXt0E1E6-eg9iVwIiM5F-9nxsSrpPHJJnTtHXVoynnZWCU5kBr2b3B6OGXtBMjOkJXsDt4ybxJbSW5nn7g]\n  Date: 2024-12-12 19:22\n  Status: 200\n  Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\n  Size: 126 kB\n<ON DISK>  /var/folders/ck/dmgn8lbx6vl8sl89vlhr0sv00000gn/T//RtmpHZYhA0/file4781675ff761.xlsx\n```\n\n\n:::\n:::\n\n\n\n# 3. Examine the Data \n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 17 × 6\n   variables        types missing_count missing_percent unique_count unique_rate\n   <chr>            <chr>         <int>           <dbl>        <int>       <dbl>\n 1 country          char…             0            0             180      1     \n 2 population       nume…             0            0             176      0.978 \n 3 region           char…             0            0               5      0.0278\n 4 estimated_preva… nume…            20           11.1           161      0.894 \n 5 estimated_numbe… nume…            20           11.1           118      0.656 \n 6 governance_issu… nume…            20           11.1           161      0.894 \n 7 lack_of_basic_n… nume…            20           11.1           161      0.894 \n 8 inequality_vuln… nume…            20           11.1           160      0.889 \n 9 disenfranchised… nume…            20           11.1           160      0.889 \n10 effects_of_conf… nume…            20           11.1           160      0.889 \n11 total_vulnerabi… nume…            20           11.1           161      0.894 \n12 survivors_of_sl… nume…             4            2.22           21      0.117 \n13 criminal_justic… nume…             4            2.22           19      0.106 \n14 coordination_oc… nume…             4            2.22            8      0.0444\n15 risk_factors_su… nume…             4            2.22           14      0.0778\n16 government_and_… nume…             4            2.22            5      0.0278\n17 government_resp… nume…             4            2.22           42      0.233 \n```\n\n\n:::\n:::\n\n\n\n# 4. Tidy the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- df %>% \n  mutate(country = case_match(country,\n                              'Türkiye' ~ 'Turkey',\n                              'United States of America' ~ 'United States',\n                              'Democratic Republic of the Congo' ~ 'DR Congo',\n                              'Viet Nam' ~ 'Vietnam',\n                              \"Côte d'Ivoire\" ~ 'Ivory Coast',\n                              'Lao PDR' ~ 'Laos',\n                              'Brunei Darussalam' ~ 'Brunei',\n                              .default = country),\n         percentile_nmbr_in_slavery = \n           round(100 * percent_rank(estimated_number_of_people_in_modern_slavery), 0),\n         rank_prevalence = rank(-estimated_prevalence_of_modern_slavery_per_1_000_population)) %>% \n  left_join(x=.,\n            y=country_df,\n            by=c('country' = 'common_name'))\n```\n:::\n\n\n\n# 5. Evaluate the Original Plot\n\n![Original plot visualizing countries with the highest and lowest estimated prevalence of modern slavery. Source: Walk Free](mm_wk47_2024_orig.png){#fig-2}\n\nThis is an interesting dataset that reminds me of some work that I contributed to at the Pardee Center. There's a lot that could be explored here, including things like mapping or analyzing the data with cluster analysis or PCA.\n\nWhile there's data available, the Makeover Monday is specifically about the top and bottom 10 prevalence charts, so that's what I'll give my take on. I like a chart to display this information, but there’s some elements that I’ll reconsider:\n\n*  The **color encoding of prevalence rate has no meaning**. It's also odd/counterintuitive to use yellow for the countries with the highest prevalence and red for those with the lowest.\n*  The **number of people estimated to be in modern slavery is washed out** by the prevalence rates. Yes, prevalence rate likely corresponds to the subtitle of the charts – countries with poor governance or high conflict zones are likely to have higher rates of slavery. But I couldn’t help but notice Japan’s estimate is very high, despite it being among the bottom 10 in prevalence rate. There could be something there to work on. Maybe adding a column for percentile rank of the number of people estimated to be in slavery conditions.\n*  I want to create a long table (not just a top 10) to showcase the full data set and highlight countries with the *largest numbers* of people in modern slavery. Slicing this and show the top and bottom 10 by prevalence rate is an efficient use of space, but the distribution of prevalence rate is very heavily skewed, which makes that approach less meaningful.\n*  I'd like to **add the country flags** to the table, because it's a small design element that improves the recognition of some countries (at least for some). I have never used the {tidycountries} package, so I'll give that a try.\n\n# 6. Visualization Parameters \n\nNone (using theme functions from {gtExtras} to style the table).\n\n# 7. Plot \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngt_walk_free <- df %>% \n  select(flags_png, country, rank_prevalence, estimated_prevalence_of_modern_slavery_per_1_000_population, estimated_number_of_people_in_modern_slavery, percentile_nmbr_in_slavery) %>%\n  filter(!is.na(estimated_number_of_people_in_modern_slavery)) %>% \n  arrange(rank_prevalence) %>% \n  gt() %>% \n  cols_label(country = '',\n             flags_png = '',\n             rank_prevalence = 'Rank (Prevalence)',\n             estimated_prevalence_of_modern_slavery_per_1_000_population = 'Prevalence Rate',\n             estimated_number_of_people_in_modern_slavery = '# of People (percentile rank)') %>% \n  tab_header(title = md(\"**Estimates of modern slavery by country from the Global Slavery Index**\"),\n             subtitle = md(\"Prevalence defined as the estimated number of people in slavery per 1,000 population<br><br>Highlighted rows indicate countries that are in the top 25% in terms of the number of people in slavery and includes many countries with relatively low prevalence rates, including South Korea, Argentina, Italy, and the United States\")) %>% \n  tab_source_note(source_note = \"Estimates from Walk Free's Global Slavery Index Report\") %>% \n  gt_merge_stack(col1 = estimated_number_of_people_in_modern_slavery, col2 = percentile_nmbr_in_slavery) %>%\n  fmt_number(columns = estimated_number_of_people_in_modern_slavery,\n             decimals = 0) %>% \n  fmt_number(columns = estimated_prevalence_of_modern_slavery_per_1_000_population,\n             decimals = 1) %>% \n  gt_img_rows(\n    columns = flags_png,\n    height = 10\n  ) %>% \n  gt_highlight_rows(\n    rows = percentile_nmbr_in_slavery >= 75,# a logic statement\n    fill = \"gray90\",\n    bold_target_only = FALSE) %>% \n  data_color(columns = estimated_prevalence_of_modern_slavery_per_1_000_population,\n             palette = c(\"white\", \"red\")) %>%\n  gt_theme_538()\n```\n:::\n\n\n\n# 8. Save \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save the plot as PNG\ngt_walk_free %>% \n  gtsave(\n  filename = glue(\"mm_{mm_year}_{mm_week}.png\"),\n  path = here::here('.//visualizations/2024-12-12-mm-wk47-2024/')\n)\n\n# make thumbnail for page\nmagick::image_read(glue(\"mm_{mm_year}_{mm_week}.png\")) %>%\n  magick::image_resize(geometry = \"400\") %>%\n  magick::image_write(glue(\"mm_{mm_year}_{mm_week}_thumbnail.png\"))\n```\n:::\n\n\n\n# 9. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.0 (2024-04-24)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.6.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: America/Denver\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] geomtextpath_0.1.4  here_1.0.1          glue_1.8.0         \n [4] htmltools_0.5.8.1   scales_1.3.0        janitor_2.2.0      \n [7] tidycountries_0.1.0 showtext_0.9-7      showtextdb_3.0     \n[10] sysfonts_0.8.9      ggbump_0.1.0        gtExtras_0.5.0     \n[13] gt_0.11.1           ggtext_0.1.2        dlookr_0.6.3       \n[16] readxl_1.4.3        httr_1.4.7          lubridate_1.9.3    \n[19] forcats_1.0.0       stringr_1.5.1       dplyr_1.1.4        \n[22] purrr_1.0.2         readr_2.1.5         tidyr_1.3.1        \n[25] tibble_3.2.1        ggplot2_3.5.1       tidyverse_2.0.0    \n[28] pacman_0.5.1       \n\nloaded via a namespace (and not attached):\n [1] DBI_1.2.3               gridExtra_2.3           rematch2_2.1.2         \n [4] rlang_1.1.4             magrittr_2.0.3          hrbrthemes_0.8.7       \n [7] snakecase_0.11.1        e1071_1.7-16            compiler_4.4.0         \n[10] systemfonts_1.1.0       vctrs_0.6.5             pkgconfig_2.0.3        \n[13] fastmap_1.2.0           magick_2.8.5            fontawesome_0.5.2      \n[16] utf8_1.2.4              promises_1.3.0          rmarkdown_2.28         \n[19] markdown_1.13           tzdb_0.4.0              ps_1.8.0               \n[22] xfun_0.48               jsonlite_1.8.9          later_1.3.2            \n[25] R6_2.5.1                stringi_1.8.4           pagedown_0.21          \n[28] extrafontdb_1.0         cellranger_1.1.0        Rcpp_1.0.13            \n[31] knitr_1.48              base64enc_0.1-3         extrafont_0.19         \n[34] httpuv_1.6.15           timechange_0.3.0        tidyselect_1.2.1       \n[37] rstudioapi_0.17.1       yaml_2.3.10             websocket_1.4.2        \n[40] processx_3.8.4          curl_5.2.3              shiny_1.9.1            \n[43] withr_3.0.1             evaluate_1.0.1          sf_1.0-18              \n[46] units_0.8-5             proxy_0.4-27            xml2_1.3.6             \n[49] pillar_1.9.0            KernSmooth_2.23-24      generics_0.1.3         \n[52] rprojroot_2.0.4         chromote_0.3.1          paletteer_1.6.0        \n[55] hms_1.1.3               commonmark_1.9.2        munsell_0.5.1          \n[58] xtable_1.8-4            class_7.3-22            gdtools_0.4.0          \n[61] webshot2_0.1.1          tools_4.4.0             reactable_0.4.4        \n[64] fs_1.6.4                grid_4.4.0              Rttf2pt1_1.3.12        \n[67] colorspace_2.1-1        cli_3.6.3               kableExtra_1.4.0       \n[70] textshaping_0.4.0       fontBitstreamVera_0.1.1 fansi_1.0.6            \n[73] viridisLite_0.4.2       svglite_2.1.3           gtable_0.3.5           \n[76] sass_0.4.9              digest_0.6.37           fontquiver_0.2.1       \n[79] classInt_0.4-10         htmlwidgets_1.6.4       farver_2.1.2           \n[82] lifecycle_1.0.4         mime_0.12               fontLiberation_0.1.0   \n[85] gridtext_0.1.5         \n```\n\n\n:::\n:::\n\n\n:::\n\n# 10. Github Repository \n\n::: {.callout-tip collapse=\"true\"}\n\n##### Expand for GitHub Repo\n \n[Access the GitHub repository here](https://github.com/mrafa3/mrafa3.github.io)\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}