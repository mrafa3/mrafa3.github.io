{
  "hash": "071534000a2f98ee2e54e73148e80bba",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualizing Australian climate data over time\"\ndescription: \"Putting Australia's extreme climate conditions in 2019 into historical context\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\ndate: 09-23-2020\ncategories: [R, \"#TidyTuesday\", line-plot] # self-defined categories\nimage: \"tt_2020_2_thumbnail.png\"\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n\neditor_options: \n  chunk_output_type: inline\n  \nexecute: \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n\n\n![Plot showing the average maximum annual rainfall and temperatures across major Australian cities from 1900-2019. Australia was experiencing a 60-year drought, and at that point in 2019, the hottest temperatures on record. Source: Australian Bureau of Meteorology. Inspiration: Tidy Tuesday work from [jkaupp](https://github.com/jkaupp/tidytuesdays/tree/master/2020/week2).](tt_2020_2.png){#fig-1 width=\"100%\"}\n\n# 1. Load Packages & Setup\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,\n    tidytuesdayR,\n    dlookr,\n    ggtext,\n    ggforce,\n    showtext,\n    janitor,   #for clean_names()\n    scales,\n    glue,\n    here,\n    patchwork,\n    zoo\n)    \n\nfont_add('fa-brands', 'fonts/Font Awesome 6 Brands-Regular-400.otf')\nfont_add_google(\"Roboto\")\nfont_add_google(\"Roboto Condensed\")\n```\n:::\n\n\n\n# 2. Read in the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntt_year <- 2020\ntt_week <- 2\n\ntuesdata <- tidytuesdayR::tt_load(tt_year, week = tt_week)\n\nrainfall <- tuesdata$rainfall\ntemperature <- tuesdata$temperature\n```\n:::\n\n\n\n# 3. Examine the Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrainfall %>%\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 179,273\nColumns: 11\n$ station_code <chr> \"009151\", \"009151\", \"009151\", \"009151\", \"009151\", \"009151…\n$ city_name    <chr> \"Perth\", \"Perth\", \"Perth\", \"Perth\", \"Perth\", \"Perth\", \"Pe…\n$ year         <dbl> 1967, 1967, 1967, 1967, 1967, 1967, 1967, 1967, 1967, 196…\n$ month        <chr> \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01…\n$ day          <chr> \"01\", \"02\", \"03\", \"04\", \"05\", \"06\", \"07\", \"08\", \"09\", \"10…\n$ rainfall     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ period       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ quality      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ lat          <dbl> -31.96, -31.96, -31.96, -31.96, -31.96, -31.96, -31.96, -…\n$ long         <dbl> 115.79, 115.79, 115.79, 115.79, 115.79, 115.79, 115.79, 1…\n$ station_name <chr> \"Subiaco Wastewater Treatment Plant\", \"Subiaco Wastewater…\n```\n\n\n:::\n\n```{.r .cell-code}\ntemperature %>% \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 528,278\nColumns: 5\n$ city_name   <chr> \"PERTH\", \"PERTH\", \"PERTH\", \"PERTH\", \"PERTH\", \"PERTH\", \"PER…\n$ date        <date> 1910-01-01, 1910-01-02, 1910-01-03, 1910-01-04, 1910-01-0…\n$ temperature <dbl> 26.7, 27.0, 27.5, 24.0, 24.8, 24.4, 25.3, 28.0, 32.6, 35.9…\n$ temp_type   <chr> \"max\", \"max\", \"max\", \"max\", \"max\", \"max\", \"max\", \"max\", \"m…\n$ site_name   <chr> \"PERTH AIRPORT\", \"PERTH AIRPORT\", \"PERTH AIRPORT\", \"PERTH …\n```\n\n\n:::\n:::\n\n\n\n# 4. Tidy the Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nannual_rainfall <- rainfall %>% \n  group_by(year, month) %>% \n  summarize(avg_monthly_rainfall = mean(rainfall, na.rm = TRUE),\n            .groups = 'drop') %>% \n  group_by(year) %>% \n  summarize(annual_rainfall = sum(avg_monthly_rainfall, na.rm = TRUE),\n            .groups = 'drop')\n\nannual_temperature <- temperature %>% \n  filter(temp_type == 'max') %>% \n  mutate(year = year(date)) %>% \n  group_by(year) %>% \n  summarise(avg_temperature = mean(temperature, na.rm = TRUE),\n            .groups = 'drop') %>% \n  filter(year < 2020)\n```\n:::\n\n\n\n# 5. Visualization Parameters \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_theme <- theme(\n  plot.title = element_text(family=\"Roboto\", color=\"black\", face=\"bold\", size=48, hjust=0), \n  plot.subtitle = element_text(family=\"Roboto\", color=\"black\", size=34, hjust=0), \n  axis.title = element_text(family=\"Roboto\", color=\"black\", face=\"bold\", size=16), \n  axis.text = element_text(family=\"Roboto\", color=\"black\", size=28), \n  axis.ticks = element_blank(),\n  plot.caption = element_text(family=\"Roboto\", color=\"black\", size=24), \n  panel.background =  element_blank(), \n  panel.grid.major = element_line(colour = \"grey90\", linewidth = 0.5),\n  panel.grid.minor = element_line(colour = \"grey93\", linewidth = 0.5),\n  panel.border = element_blank(), \n  legend.title=element_blank(), \n  legend.text = element_text(family=\"Roboto\", color=\"black\", size=12, hjust=0),\n  legend.position = 'top',\n)\n```\n:::\n\n\n\n# 6. Plot \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot_rainfall <- annual_rainfall %>% \n  filter(year >= 1900 & year < 2020) %>% \n  mutate(ma10 = zoo::rollapply(annual_rainfall, width=10, FUN=mean, align='right', partial = TRUE)) %>% \n  ggplot(.,\n         aes(x=year,\n             y=annual_rainfall)) + \n  geom_line(color = 'cornflowerblue') + \n  geom_point(color = 'cornflowerblue') + \n  geom_line(aes(y=ma10), \n            linetype='longdash', color='gray30') + \n  geom_mark_circle(aes(filter = year == 2019, \n                       label = glue(\"Total Rainfall: {round(annual_rainfall,1)} mm\"), \n                       description = \"Annual rainfall at a 60 year low\"), \n                   label.family = c(\"Roboto\", \"Roboto Condensed\"), label.buffer = unit(6, \"cm\"), label.fontsize = 18) + \n  scale_x_continuous(limits = c(1900, 2020), breaks = seq(1900, 2020, 20)) +\n  labs(x='',\n       y='') + \n   scale_y_continuous(limits = c(10, 50), \n                  breaks = seq(10, 50, 10),\n                  labels = scales::label_number(suffix = \" mm\")) + \n  my_theme\n\nplot_temperature <- annual_temperature %>% \n  mutate(ma10 = zoo::rollapply(avg_temperature, width=10, FUN=mean, align='right', partial = TRUE)) %>% \n  ggplot(.,\n         aes(x=year,\n             y=avg_temperature)) + \n  geom_line(color = 'firebrick3') + \n  geom_point(color = 'firebrick3') + \n  geom_line(aes(y=ma10),\n            linetype='longdash', color='gray30') + \n  geom_mark_circle(aes(filter = year == 2019, \n                       label = glue(\"Avg Max Temp: {round(avg_temperature, 1)}°C\"),\n                       description = \"Data through May 2019\"), \n                   label.family = c(\"Roboto\", \"Roboto Condensed\"), label.buffer = unit(6, \"cm\"), label.fontsize = 18) + \n  labs(x='',\n       y='') + \n  scale_x_continuous(limits = c(1900, 2020), breaks = seq(1900, 2020, 20)) +\n  # scale_y_continuous(limits = c(10, 30), breaks = seq(10, 30, 10), label = label_number(unit = \"° C\", sep = \"\"), position = \"right\") +\n   scale_y_continuous(limits = c(10, 30), \n                  breaks = seq(10, 30, 10),\n                  labels = scales::label_number(suffix = \"°C\"),\n                  position = \"right\") + \n  my_theme\n\nplot_rain_temp <- plot_rainfall + \n  plot_temperature + \n  theme(plot.margin = margin(r = 30, l = 30)) + \n  plot_annotation(\n    title = \"Historic Lows in Rainfall and Records High Temperatures a Factor in Australia's Devastating Wildfires\",\n    subtitle = glue(\n      \"<span style='color:cornflowerblue'>**Total rainfall**</span> and <span style='color:firebrick3'>**average maximum temperature**</span> across Australian cities from 1900 to 2019\"\n    ),\n    caption = \"Tidy Tuesday Week 2 (2020). **Source**: Australian Bureau of Meterology\",\n    theme = theme(\n      plot.title = element_textbox_simple(family='Roboto', size=48, face='bold'),\n      plot.subtitle = element_textbox_simple(family='Roboto', size=34),\n      plot.caption = element_textbox_simple(family = 'Roboto', size=18)\n    )\n  )\n```\n:::\n\n\n\n# 7. Save \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save the plot as PNG\nggsave(\n  filename = glue(\"tt_{tt_year}_{tt_week}.png\"),\n  plot = plot_rain_temp,\n  width = 10, height = 6, units = \"in\", dpi = 320\n)\n\n# make thumbnail for page\nmagick::image_read(glue(\"tt_{tt_year}_{tt_week}.png\")) %>%\n  magick::image_resize(geometry = \"400\") %>%\n  magick::image_write(glue(\"tt_{tt_year}_{tt_week}_thumbnail.png\"))\n```\n:::\n\n\n\n# 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.0 (2024-04-24)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.6.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: America/Denver\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] zoo_1.8-12         patchwork_1.3.0    here_1.0.1         glue_1.8.0        \n [5] scales_1.3.0       janitor_2.2.0      showtext_0.9-7     showtextdb_3.0    \n [9] sysfonts_0.8.9     ggforce_0.4.2      ggtext_0.1.2       dlookr_0.6.3      \n[13] tidytuesdayR_1.1.2 lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1     \n[17] dplyr_1.1.4        purrr_1.0.2        readr_2.1.5        tidyr_1.3.1       \n[21] tibble_3.2.1       ggplot2_3.5.1      tidyverse_2.0.0    pacman_0.5.1      \n\nloaded via a namespace (and not attached):\n [1] tidyselect_1.2.1        viridisLite_0.4.2       farver_2.1.2           \n [4] fastmap_1.2.0           gh_1.4.1                tweenr_2.0.3           \n [7] pagedown_0.21           fontquiver_0.2.1        promises_1.3.0         \n[10] digest_0.6.37           timechange_0.3.0        mime_0.12              \n[13] lifecycle_1.0.4         magrittr_2.0.3          compiler_4.4.0         \n[16] rlang_1.1.4             tools_4.4.0             utf8_1.2.4             \n[19] yaml_2.3.10             knitr_1.48              htmlwidgets_1.6.4      \n[22] bit_4.5.0               curl_5.2.3              xml2_1.3.6             \n[25] withr_3.0.1             grid_4.4.0              polyclip_1.10-7        \n[28] fansi_1.0.6             gdtools_0.4.0           xtable_1.8-4           \n[31] colorspace_2.1-1        extrafontdb_1.0         gitcreds_0.1.2         \n[34] MASS_7.3-61             cli_3.6.3               crayon_1.5.3           \n[37] rmarkdown_2.28          ragg_1.3.3              generics_0.1.3         \n[40] rstudioapi_0.17.1       tzdb_0.4.0              commonmark_1.9.2       \n[43] parallel_4.4.0          vctrs_0.6.5             jsonlite_1.8.9         \n[46] fontBitstreamVera_0.1.1 hms_1.1.3               bit64_4.5.2            \n[49] magick_2.8.5            systemfonts_1.1.0       stringi_1.8.4          \n[52] gtable_0.3.5            later_1.3.2             extrafont_0.19         \n[55] munsell_0.5.1           pillar_1.9.0            rappdirs_0.3.3         \n[58] htmltools_0.5.8.1       reactable_0.4.4         R6_2.5.1               \n[61] httr2_1.0.5             textshaping_0.4.0       rprojroot_2.0.4        \n[64] vroom_1.6.5             evaluate_1.0.1          shiny_1.9.1            \n[67] kableExtra_1.4.0        lattice_0.22-6          markdown_1.13          \n[70] gridtext_0.1.5          snakecase_0.11.1        fontLiberation_0.1.0   \n[73] httpuv_1.6.15           hrbrthemes_0.8.7        Rcpp_1.0.13            \n[76] svglite_2.1.3           gridExtra_2.3           Rttf2pt1_1.3.12        \n[79] xfun_0.48               pkgconfig_2.0.3        \n```\n\n\n:::\n:::\n\n\n:::\n\n# 9. Github Repository \n\n::: {.callout-tip collapse=\"true\"}\n\n##### Expand for GitHub Repo\n \n[Access the GitHub repository here](https://github.com/mrafa3/mrafa3.github.io)\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}