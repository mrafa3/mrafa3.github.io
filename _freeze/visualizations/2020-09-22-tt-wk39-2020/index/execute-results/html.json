{
  "hash": "8c57c734a1af2a090af9ef954385edb8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualizing the Himalayas and expeditions over time\"\ndescription: \"Using data from the Himalayan Database to put the scope and expedition activity into perspective\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\ndate: 09-22-2020\ncategories: [R, \"#TidyTuesday\", histogram, line-plot] # self-defined categories\nimage: \"tt_2020_39_hist_thumbnail.png\"\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n\neditor_options: \n  chunk_output_type: inline\n  \nexecute: \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n\n\n\n![Histogram showing the distribution of peak heights in the Himalayas. **Source**:The Himalayan Database.](tt_2020_39_hist.png){#fig-1}\n\n![Line plot showing the rise in the number of expeditions on Mount Everest over time. **Source**:The Himalayan Database.](tt_2020_39_line.png){#fig-2}\n\n# 1. Load Packages & Setup\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,\n    tidytuesdayR,\n    ggtext,\n    showtext,\n    janitor,   #for clean_names()\n    scales,\n    glue,\n    here\n)    \n\nfont_add_google(\"Open Sans\")\n```\n:::\n\n\n\n\n# 2. Read in the Data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntt_year <- 2020\ntt_week <- 39\n\ntuesdata <- tidytuesdayR::tt_load(tt_year, week = tt_week)\n\npeaks <- tuesdata$peaks\nexpeditions <- tuesdata$expeditions\n```\n:::\n\n\n\n\n# 3. Examine the Data \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeaks %>% \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 468\nColumns: 8\n$ peak_id                    <chr> \"AMAD\", \"AMPG\", \"ANN1\", \"ANN2\", \"ANN3\", \"AN…\n$ peak_name                  <chr> \"Ama Dablam\", \"Amphu Gyabjen\", \"Annapurna I…\n$ peak_alternative_name      <chr> \"Amai Dablang\", NA, NA, NA, NA, NA, NA, NA,…\n$ height_metres              <dbl> 6814, 5630, 8091, 7937, 7555, 7525, 8026, 8…\n$ climbing_status            <chr> \"Climbed\", \"Climbed\", \"Climbed\", \"Climbed\",…\n$ first_ascent_year          <dbl> 1961, 1953, 1950, 1960, 1961, 1955, 1974, 1…\n$ first_ascent_country       <chr> \"New Zealand, USA, UK\", \"UK\", \"France\", \"UK…\n$ first_ascent_expedition_id <chr> \"AMAD61101\", \"AMPG53101\", \"ANN150101\", \"ANN…\n```\n\n\n:::\n\n```{.r .cell-code}\nexpeditions %>% \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 10,364\nColumns: 16\n$ expedition_id      <chr> \"ANN260101\", \"ANN269301\", \"ANN273101\", \"ANN278301\",…\n$ peak_id            <chr> \"ANN2\", \"ANN2\", \"ANN2\", \"ANN2\", \"ANN2\", \"ANN2\", \"AN…\n$ peak_name          <chr> \"Annapurna II\", \"Annapurna II\", \"Annapurna II\", \"An…\n$ year               <dbl> 1960, 1969, 1973, 1978, 1979, 1980, 1980, 1981, 198…\n$ season             <chr> \"Spring\", \"Autumn\", \"Spring\", \"Autumn\", \"Autumn\", \"…\n$ basecamp_date      <date> 1960-03-15, 1969-09-25, 1973-03-16, 1978-09-08, NA…\n$ highpoint_date     <date> 1960-05-17, 1969-10-22, 1973-05-06, 1978-10-02, 19…\n$ termination_date   <date> NA, 1969-10-26, NA, 1978-10-05, 1979-10-20, 1980-0…\n$ termination_reason <chr> \"Success (main peak)\", \"Success (main peak)\", \"Succ…\n$ highpoint_metres   <dbl> 7937, 7937, 7937, 7000, 7160, 7000, 7250, 6400, 740…\n$ members            <dbl> 10, 10, 6, 2, 3, 6, 7, 19, 9, 5, 5, 5, 6, 4, 3, 4, …\n$ member_deaths      <dbl> 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, …\n$ hired_staff        <dbl> 9, 0, 8, 0, 0, 2, 2, 0, 3, 0, 0, 3, 4, 2, 0, 2, 5, …\n$ hired_staff_deaths <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ oxygen_used        <lgl> TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…\n$ trekking_agency    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, \"Kunga\"…\n```\n\n\n:::\n:::\n\n\n\n\n# 4. Tidy the Data \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexpedition_attempts <- peaks %>% \n  select(peak_id, height_metres) %>% \n  left_join(x=.,\n            y=expeditions,\n            by='peak_id') %>% \n  mutate(basecamp_year = year(basecamp_date)) %>% \n  group_by(peak_name, basecamp_year) %>% \n  summarise(count_expeditions = n(),\n            .groups = 'drop') %>% \n  mutate(is_everest = if_else(peak_name == 'Everest',\n                              'Everest', 'Other'))\n```\n:::\n\n\n\n\n# 5. Visualization Parameters \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_theme <- theme(\n  # choose font family\n  text = element_text(family = 'Open Sans', size=14), \n  axis.ticks = element_blank(), \n  plot.background = element_rect(fill = \"white\", colour = NA),\n  panel.background =  element_rect(fill = \"white\", colour = NA), \n  legend.position = 'none',\n  panel.grid.major = element_blank(),\n  panel.grid.minor = element_blank(),\n  panel.border = element_blank())\n\narw <- arrow(length = unit(5, \"pt\"), type = \"closed\")\n```\n:::\n\n\n\n\n# 6. Plot \n\n#### Histogram \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeak_hist_viz <- peaks %>% \n  ggplot(.) + \n  geom_histogram(aes(x=height_metres),\n                 fill='slategray3',\n                 color='gray80',\n                 bins=30) + \n  geom_curve(data = data.frame(), \n             aes(x = 8600, y = 9, xend = 8850, yend = 4), \n             color = 'black', arrow = arw) +\n  annotate(\"text\", x=8600, y=11, label = 'Mt. Everest', family='Open Sans', size=7) + \n  ggtitle('Mount Everest is really tall',\n          subtitle = 'Distribution of peak heights in the Himalayas') + \n  labs(x='<br>Height (meters)',\n       y='Count',\n       caption='<br>Tidy Tuesday Week 39 (2020)<br>**Source**:The Himalayan Database') + \n  scale_x_continuous(labels = comma) + \n  my_theme + \n  theme(plot.title = element_textbox(size=rel(2.7), face='bold'),\n        plot.subtitle = element_text(size=rel(1.3)),\n        plot.caption = element_textbox(size=rel(1.1), lineheight = .3),\n        axis.title.y = element_textbox(hjust = 1, size=rel(1.3), face='bold'),\n        axis.title.x = element_textbox(size=rel(1.3), face='bold'),\n        axis.text = element_text(size=rel(1.4)))\n```\n:::\n\n\n\n\n#### Line plot \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npaving_everest_viz <- expedition_attempts %>%\n  ungroup() %>% \n  filter(complete.cases(.)) %>% \n  ggplot(.,\n         aes(x=basecamp_year,\n             y=count_expeditions,\n             color=is_everest,\n             size=is_everest)) + \n  geom_line(aes(group=peak_name)) + \n  geom_point(data=. %>% filter(basecamp_year == 2019,\n                               peak_name == 'Everest')) + \n  annotate(geom = \"text\", x=2016, y=100,\n           label='Everest',\n           color='darkblue',\n           size=6,\n           fontface='bold') + \n  ggtitle('Paving Everest?',\n          subtitle = 'Tracking the increase in expeditions over time of Himalayan peaks') + \n  labs(x='Year (of basecamp)<br>',\n       y='Number of<br>expeditions',\n       caption='Tidy Tuesday Week 39 (2020)<br>**Source**:The Himalayan Database') + \n  scale_size_manual(values = c('Everest' = 1.2,\n                               'Other' = .8)) + \n  scale_color_manual(values = c('Everest' = 'darkblue',\n                                'Other' = 'gray60')) + \n  scale_y_continuous(position = 'right',\n                     breaks = seq(0, 90, by=30),  \n                     labels = c('', '30', '60', '90')) + \n  my_theme + \n  theme(plot.title = element_textbox(size=rel(2.7), face='bold'),\n        plot.subtitle = element_text(size=rel(1.3)),\n        plot.caption = element_textbox(size=rel(1.1), lineheight = .3),\n        axis.title.y = element_textbox(size=rel(1.3), face='bold', lineheight = .3),\n        axis.title.x = element_textbox(size=rel(1.3), face='bold'),\n        axis.text = element_text(size=rel(1.4)))\n```\n:::\n\n\n\n\n# 7. Save \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save the plot as PNG\nggsave(\n  filename = glue(\"tt_{tt_year}_{tt_week}_hist.png\"),\n  plot = peak_hist_viz,\n  width = 10, height = 6.25, units = \"in\", dpi = 320\n)\n\nggsave(\n  filename = glue(\"tt_{tt_year}_{tt_week}_line.png\"),\n  plot = paving_everest_viz,\n  width = 10, height = 6.25, units = \"in\", dpi = 320\n)\n\n# make thumbnail for page\nmagick::image_read(glue(\"tt_{tt_year}_{tt_week}_hist.png\")) %>%\n  magick::image_resize(geometry = \"400\") %>%\n  magick::image_write(glue(\"tt_{tt_year}_{tt_week}_hist_thumbnail.png\"))\n\nmagick::image_read(glue(\"tt_{tt_year}_{tt_week}_line.png\")) %>%\n  magick::image_resize(geometry = \"400\") %>%\n  magick::image_write(glue(\"tt_{tt_year}_{tt_week}_line_thumbnail.png\"))\n```\n:::\n\n\n\n\n# 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.0 (2024-04-24)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.6.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: America/Denver\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] here_1.0.1         glue_1.8.0         scales_1.3.0       janitor_2.2.0     \n [5] showtext_0.9-7     showtextdb_3.0     sysfonts_0.8.9     ggtext_0.1.2      \n [9] tidytuesdayR_1.1.2 lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1     \n[13] dplyr_1.1.4        purrr_1.0.2        readr_2.1.5        tidyr_1.3.1       \n[17] tibble_3.2.1       ggplot2_3.5.1      tidyverse_2.0.0    pacman_0.5.1      \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.5      xfun_0.48         httr2_1.0.5       htmlwidgets_1.6.4\n [5] gh_1.4.1          tzdb_0.4.0        vctrs_0.6.5       tools_4.4.0      \n [9] generics_0.1.3    curl_5.2.3        parallel_4.4.0    fansi_1.0.6      \n[13] pkgconfig_2.0.3   lifecycle_1.0.4   farver_2.1.2      compiler_4.4.0   \n[17] textshaping_0.4.0 munsell_0.5.1     snakecase_0.11.1  htmltools_0.5.8.1\n[21] yaml_2.3.10       pillar_1.9.0      crayon_1.5.3      magick_2.8.5     \n[25] commonmark_1.9.2  tidyselect_1.2.1  digest_0.6.37     stringi_1.8.4    \n[29] labeling_0.4.3    rprojroot_2.0.4   fastmap_1.2.0     grid_4.4.0       \n[33] colorspace_2.1-1  cli_3.6.3         magrittr_2.0.3    utf8_1.2.4       \n[37] withr_3.0.1       rappdirs_0.3.3    bit64_4.5.2       timechange_0.3.0 \n[41] rmarkdown_2.28    gitcreds_0.1.2    bit_4.5.0         ragg_1.3.3       \n[45] hms_1.1.3         evaluate_1.0.1    knitr_1.48        markdown_1.13    \n[49] rlang_1.1.4       gridtext_0.1.5    Rcpp_1.0.13       xml2_1.3.6       \n[53] rstudioapi_0.17.1 vroom_1.6.5       jsonlite_1.8.9    R6_2.5.1         \n[57] systemfonts_1.1.0\n```\n\n\n:::\n:::\n\n\n\n:::\n\n# 9. Github Repository \n\n::: {.callout-tip collapse=\"true\"}\n\n##### Expand for GitHub Repo\n \n[Access the GitHub repository here](https://github.com/mrafa3/mrafa3.github.io)\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}