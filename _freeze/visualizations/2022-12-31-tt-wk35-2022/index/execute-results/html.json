{
  "hash": "ec17e428df243c68dcc39dd8919905fa",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualizing Pell Grant Awards in the U.S. in 2017\"\ndescription: \"Exploring Colorado trends and the overall state-level Pell grant distribution\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\ndate: 12-30-2022\ncategories: [R, \"#TidyTuesday\", line-plot, gt] # self-defined categories\nimage: \"tt_2022_35_thumbnail.png\"\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n\neditor_options: \n  chunk_output_type: inline\n  \nexecute: \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n\n\n![Line plot depicting the minimum and maximum annual Pell grant awards each year in Colorado (1999-2017).](tt_2022_35.png){#fig-1}\n\n![Table showing the distribution of annual awards of Pell grants by U.S. state/territory in 2017.](tt_2022_35_tbl.png){#fig-1}\n\n# 1. Load Packages & Setup\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,\n    tidytuesdayR,\n    dlookr,\n    ggtext,\n    gt,\n    gtExtras,  #for font awesome icons in gt tables\n    ggbump,\n    showtext,\n    janitor,   #for clean_names()\n    scales,\n    htmltools, #for tagList()\n    glue,\n    epoxy,\n    here,\n    geomtextpath\n)    \n\nfont_add('fa-brands', 'fonts/Font Awesome 6 Brands-Regular-400.otf')\nsysfonts::font_add_google(\"Lato\",\"lato\")\nshowtext::showtext_auto()\n```\n:::\n\n\n\n# 2. Read in the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntt_year <- 2022\ntt_week <- 35\n\ntuesdata <- tidytuesdayR::tt_load(tt_year, week = tt_week)\n\ndf <- tuesdata$pell %>% \n  clean_names()\n```\n:::\n\n\n\n\n# 3. Examine the Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 100,474\nColumns: 6\n$ state     <chr> \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AK\", \"AL\", \"AL\", \"AL\", \"AL\", …\n$ award     <dbl> 197232.9, 133148.0, 107287.0, 3425148.8, 2441864.0, 353170.0…\n$ recipient <dbl> 109, 69, 72, 1920, 1256, 221, 2369, 837, 3236, 854, 2842, 16…\n$ name      <chr> \"Alaska Pacific University\", \"Alaska Vocational Technical Ce…\n$ session   <chr> \"1999-00\", \"1999-00\", \"1999-00\", \"1999-00\", \"1999-00\", \"1999…\n$ year      <dbl> 1999, 1999, 1999, 1999, 1999, 1999, 1999, 1999, 1999, 1999, …\n```\n\n\n:::\n:::\n\n\n\n\n# 4. Tidy the Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_colorado <- df %>% \n  filter(state == 'CO') %>% \n  mutate(award_per_recipent = award / recipient)\n\ndf_colorado_min <- df_colorado %>% \n  filter(recipient >= 10) %>% \n  group_by(year) %>% \n  slice_min(award_per_recipent) %>% \n  mutate(min_max_label = 'Min')\n\ndf_colorado_max <- df_colorado %>% \n  filter(recipient >= 10) %>% \n  group_by(year) %>% \n  slice_max(award_per_recipent) %>% \n  mutate(min_max_label = 'Max')\n\ndf_colorado_min_max <- bind_rows(df_colorado_min, df_colorado_max)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_tbl <- df %>% \n  slice_max(year) %>% \n  group_by(state) %>% \n  summarise(sum_award = sum(award, na.rm = TRUE),\n            sum_recipients = sum(recipient, na.rm = TRUE)) %>% \n  ungroup() %>% \n  mutate(award_per_recipient = sum_award / sum_recipients) %>% \n  arrange(-award_per_recipient)\n```\n:::\n\n\n\n# 5. Visualization Parameters \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_theme <- theme(\n  text = element_text(family = 'Lato', size=14, color='black'), \n  # plot.title = element_textbox_simple(color=\"black\", face=\"bold\", size=20, hjust=0), \n  # plot.subtitle = element_textbox_simple(color=\"black\", size=12, hjust=0), \n  #axis.title = element_blank(), \n  #axis.text = element_blank(), \n  axis.ticks = element_blank(),\n  #axis.line = element_blank(), \n  # plot.caption = element_textbox_simple(color=\"black\", size=12), \n  panel.background =  element_blank(), \n  panel.grid.major = element_blank(),\n  panel.grid.minor = element_blank(),\n  panel.border = element_blank(), \n  legend.position = 'none')\n\ntxt <- 'black'\ntwitter <- glue(\"<span style='font-family:fa-brands; color:{txt}'>&#xf099;</span>\")\ngithub <- glue(\"<span style='font-family:fa-brands; color:{txt}'>&#xf09b;</span>\")\nspace <- glue(\"<span style='color:black;font-size:1px'>'</span>\")\n\nviz_colors <- c('Max' = '#645A7B', 'Min' = '#6ED187')\n\ntitle_text <- 'Pell Grant Award Value per Recipient'\nsubtitle_text <- glue(\"<span style='color:#6ED187'>Min</span> and <span style='color:#645A7B'>Max</span> values each year in Colorado\")\ncaption_text <- glue(\"Tidy Tuesday Week 35 (2022)<br>{twitter} @mickey.rafa • {github} mrafa3\")\n\nmax_value <- df_colorado_min_max %>% \n  filter(year == 2010,\n         min_max_label == 'Max') %>% \n  pull(award_per_recipent)\n```\n:::\n\n\n\n\n# 6. Plot \n\n#### What is the overall trend in Pell grant awards in Colorado?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nviz_pell_colorado <- df_colorado_min_max %>% \n  ggplot(.,\n         aes(x=year,\n             y=award_per_recipent,\n             color=min_max_label)) + \n  geom_point(size=1) + \n  geom_line() + \n  ggforce::geom_mark_circle(aes(filter = year == 2010 & min_max_label == 'Max', \n                                label = name,\n                                description = epoxy(\"Peak value of {.dollar round(max_value, 0)} in 2010\")),\n                            label.family = 'Lato',\n                            label.fontsize = c(20, 13)) + \n  labs(x='',\n       y='',\n       title = title_text,\n       subtitle = subtitle_text,\n       caption = caption_text) + \n  scale_y_continuous(labels = c('', '$2,000', '$4,000', '$6,000', ''),\n                     limits = c(0,8000)) + \n  scale_color_manual(values = viz_colors) + \n  my_theme + \n  theme(plot.title = element_textbox(size=rel(4), face='bold'),\n        plot.subtitle = element_textbox(size=rel(2.1)),\n        plot.caption = element_textbox(size=rel(1.5), lineheight=.3),\n        axis.text = element_text(size=rel(1.5)))\n```\n:::\n\n\n\n#### Which state has the highest pell award per student?  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_viz <- df_tbl %>% \n  arrange(-sum_award) %>% \n  gt() %>% \n  gt::cols_label(state = 'State',\n                 sum_award = 'Total Pell $',\n                 sum_recipients = 'Total Pell Recipients',\n                 award_per_recipient = 'Avg Pell Award $') %>% \n  tab_header(title = md(\"**Pell Grant Awards in 2017**\"),\n             subtitle = md(\"Schools in **New Hampshire** and **Puero Rico** average the lowest and highest average awards respectively\")) %>% \n  tab_source_note(source_note = \"Data from Tidy Tuesday Week 35 (2022)\") %>% \n  fmt_currency(columns = c(sum_award, award_per_recipient), \n               decimals = 0) %>% \n  fmt_number(columns = c(sum_recipients), \n               decimals = 0) %>% \n  gt_highlight_rows(\n    rows = c(10,39), \n    fill = \"lightgrey\",\n    bold_target_only = TRUE,\n    target_col = state\n    ) %>% \n  gt_hulk_col_numeric(award_per_recipient) %>% \n  tab_style(\n    locations = cells_column_labels(columns = everything()),\n    style = list(\n      #thick border\n      cell_borders(sides = \"bottom\", weight = px(3)),\n      #make text bold\n      cell_text(weight = \"bold\")\n    )\n  ) %>% \n  #apply different style to title\n  tab_style(locations = cells_title(groups = \"title\"),\n            style = list(\n              cell_text(weight = \"bold\", size = 24)\n            )) %>% \n  opt_all_caps() %>% \n  opt_table_font(\n    font = list(\n      google_font(\"Nunito Sans\"),\n      default_fonts()\n    )\n  ) %>% \n  tab_options(\n    #remove border between column headers and title\n    column_labels.border.top.width = px(3),\n    column_labels.border.top.color = \"transparent\",\n    #remove border around the table\n    table.border.top.color = \"transparent\",\n    table.border.bottom.color = \"transparent\",\n    #adjust font sizes and alignment\n    source_notes.font.size = 12,\n    heading.align = \"left\"\n  )\n```\n:::\n\n\n\n\n# 7. Save \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save the plot as PNG\nggsave(\n  filename = glue(\"tt_{tt_year}_{tt_week}.png\"),\n  plot = viz_pell_colorado,\n  width = 5, height = 3.5, units = \"in\", dpi = 320\n)\n\ntbl_viz %>% \n  gtsave(\n    filename = glue(\"tt_{tt_year}_{tt_week}_tbl.png\"),\n    path = here::here()\n    )\n\n# make thumbnail for page\nmagick::image_read(glue(\"tt_{tt_year}_{tt_week}.png\")) %>%\n  magick::image_resize(geometry = \"400\") %>%\n  magick::image_write(glue(\"tt_{tt_year}_{tt_week}_thumbnail.png\"))\n```\n:::\n\n\n\n# 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.0 (2024-04-24)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.6.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: America/Denver\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] geomtextpath_0.1.4 here_1.0.1         epoxy_1.0.0        glue_1.8.0        \n [5] htmltools_0.5.8.1  scales_1.3.0       janitor_2.2.0      showtext_0.9-7    \n [9] showtextdb_3.0     sysfonts_0.8.9     ggbump_0.1.0       gtExtras_0.5.0    \n[13] gt_0.11.1          ggtext_0.1.2       dlookr_0.6.3       tidytuesdayR_1.1.2\n[17] lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1      dplyr_1.1.4       \n[21] purrr_1.0.2        readr_2.1.5        tidyr_1.3.1        tibble_3.2.1      \n[25] ggplot2_3.5.1      tidyverse_2.0.0    pacman_0.5.1      \n\nloaded via a namespace (and not attached):\n [1] gridExtra_2.3           httr2_1.0.5             rematch2_2.1.2         \n [4] rlang_1.1.4             magrittr_2.0.3          hrbrthemes_0.8.7       \n [7] snakecase_0.11.1        compiler_4.4.0          systemfonts_1.1.0      \n[10] vctrs_0.6.5             pkgconfig_2.0.3         crayon_1.5.3           \n[13] fastmap_1.2.0           magick_2.8.5            labeling_0.4.3         \n[16] fontawesome_0.5.2       utf8_1.2.4              promises_1.3.0         \n[19] rmarkdown_2.28          markdown_1.13           tzdb_0.4.0             \n[22] ps_1.8.0                ragg_1.3.3              bit_4.5.0              \n[25] xfun_0.48               jsonlite_1.8.9          later_1.3.2            \n[28] tweenr_2.0.3            parallel_4.4.0          R6_2.5.1               \n[31] stringi_1.8.4           pagedown_0.21           extrafontdb_1.0        \n[34] Rcpp_1.0.13             knitr_1.48              base64enc_0.1-3        \n[37] extrafont_0.19          gitcreds_0.1.2          httpuv_1.6.15          \n[40] timechange_0.3.0        tidyselect_1.2.1        rstudioapi_0.17.1      \n[43] yaml_2.3.10             websocket_1.4.2         processx_3.8.4         \n[46] curl_5.2.3              shiny_1.9.1             withr_3.0.1            \n[49] and_0.1.5               evaluate_1.0.1          polyclip_1.10-7        \n[52] xml2_1.3.6              pillar_1.9.0            generics_0.1.3         \n[55] vroom_1.6.5             rprojroot_2.0.4         chromote_0.3.1         \n[58] paletteer_1.6.0         hms_1.1.3               commonmark_1.9.2       \n[61] munsell_0.5.1           xtable_1.8-4            gdtools_0.4.0          \n[64] webshot2_0.1.1          tools_4.4.0             reactable_0.4.4        \n[67] fs_1.6.4                grid_4.4.0              Rttf2pt1_1.3.12        \n[70] gh_1.4.1                colorspace_2.1-1        ggforce_0.4.2          \n[73] cli_3.6.3               rappdirs_0.3.3          kableExtra_1.4.0       \n[76] textshaping_0.4.0       fontBitstreamVera_0.1.1 fansi_1.0.6            \n[79] viridisLite_0.4.2       svglite_2.1.3           gtable_0.3.5           \n[82] sass_0.4.9              digest_0.6.37           fontquiver_0.2.1       \n[85] htmlwidgets_1.6.4       farver_2.1.2            lifecycle_1.0.4        \n[88] mime_0.12               fontLiberation_0.1.0    gridtext_0.1.5         \n[91] bit64_4.5.2             MASS_7.3-61            \n```\n\n\n:::\n:::\n\n\n:::\n\n# 9. Github Repository \n\n::: {.callout-tip collapse=\"true\"}\n\n##### Expand for GitHub Repo\n \n[Access the GitHub repository here](https://github.com/mrafa3/mrafa3.github.io)\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}