{
  "hash": "970cea3df5109c6b8504da4d5c193416",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Animating the Gapminder dataset using gganimate\"\ndescription: \"This post outlines the value in building nested models using the purrr and broom packages\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\n    #orcid: 0000-0002-5300-3075\ndate: 10-15-2017\ncategories: [R, data-viz, tidyverse, gganimate] # self-defined categories\n#citation: \n # url: https://mrafa3.github.io/posts/2024-07-15-wikipedia-international-mens-soccer/ \n#image: model_fit_plot.png\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n---\n\n\n## Setup\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n        country        continent        year         lifeExp     \n Afghanistan:  12   Africa  :624   Min.   :1952   Min.   :23.60  \n Albania    :  12   Americas:300   1st Qu.:1966   1st Qu.:48.20  \n Algeria    :  12   Asia    :396   Median :1980   Median :60.71  \n Angola     :  12   Europe  :360   Mean   :1980   Mean   :59.47  \n Argentina  :  12   Oceania : 24   3rd Qu.:1993   3rd Qu.:70.85  \n Australia  :  12                  Max.   :2007   Max.   :82.60  \n (Other)    :1632                                                \n      pop              gdpPercap       \n Min.   :6.001e+04   Min.   :   241.2  \n 1st Qu.:2.794e+06   1st Qu.:  1202.1  \n Median :7.024e+06   Median :  3531.8  \n Mean   :2.960e+07   Mean   :  7215.3  \n 3rd Qu.:1.959e+07   3rd Qu.:  9325.5  \n Max.   :1.319e+09   Max.   :113523.1  \n                                       \n```\n\n\n:::\n:::\n\n\n<center>\n\n[](https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gapminder.org%2Ftag%2Fgapminder-world%2F&psig=AOvVaw2IwfQSTFDghid4GnL0WUtb&ust=1721330817600000&source=images&cd=vfe&opi=89978449&ved=0CBQQjRxqFwoTCLjn9pPnrocDFQAAAAAdAAAAABAE)\n\n</center>\n\n## gganimate::\n\nIn this graphic, I want to spotlight China's development path, and also show the story of differences by continent. First, I'll show all the data, which makes clear the need for animation of this data.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngapminder %>% \n  ggplot(.,\n         aes(x=gdpPercap,\n             y=lifeExp,\n             size=pop,\n             color=continent)) +\n  geom_point() + \n  geom_text(data=gapminder %>% filter(country == 'China'),\n                           aes(label=country), \n                           family='Arial', size= 3, color='black', nudge_y = 2) + \n  scale_x_log10() + \n  ggtitle('Change in life expectancy and income over time',\n          subtitle = 'Bubble size indicates population size') + \n  labs(x='GDP per capita (logged)\\n',\n       y='Life expectancy (years)',\n       caption='Source: Gapminder dataset') + \n  theme(legend.position = 'top') + \n  guides(size='none')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## gganimate::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngapminder %>% \n  ggplot(.,\n         aes(x=gdpPercap,\n             y=lifeExp,\n             size=pop,\n             color=continent)) +\n  geom_point() + \n  geom_text(data=gapminder %>% filter(country == 'China'),\n                           aes(label=country), \n                           family='Arial', size= 3, color='black', nudge_y = 2) + \n  scale_x_log10() + \n  ggtitle('Change in life expectancy and income over time in {closest_state}',\n          subtitle = 'Bubble size indicates population size') + \n  labs(x='GDP per capita (logged)\\n',\n       y='Life expectancy (years)',\n       caption='Source: Gapminder dataset') + \n  theme(legend.position = 'top') + \n  guides(size='none') + \n  my.theme + \n  transition_states(\n    year,\n    transition_length = 2,\n    state_length = 1,\n    wrap = TRUE\n  ) + \n  enter_fade() + \n  exit_shrink() +\n  ease_aes()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.gif){fig-align='center'}\n:::\n:::\n\n\n# Using the tweener:: package\n\nThe `gganimate::` code is simple enough to use, but the dataset is every five years, which makes for a somewhat jerky animation experience. With the `tweener::` package, we can quickly interpolate between values to smooth out the animation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder_edit <- gapminder %>%\n  arrange(country, year) %>%\n  select(gdpPercap,lifeExp,year,country, continent, pop) %>%\n  rename(x=gdpPercap,y=lifeExp,time=year,id=country) %>%\n  mutate(ease=\"linear\")\n\ngapminder_tween <- tween_elements(gapminder_edit,\n                                  \"time\", \"id\", \"ease\", nframes = 300) %>%\n  mutate(year = round(time), country = .group) %>%\n  left_join(gapminder, by=c(\"country\",\"year\",\"continent\")) %>%\n  rename(population = pop.x)\n\n\ngapminder_tween %>% \n  mutate(IsChina = ifelse(country == 'China', 'China', 'Other')) %>% \n  ggplot(.,\n         aes(x=x, y=y, frame = .frame)) +\n  geom_point(aes(size=population, color=continent, alpha=IsChina)) +\n  ggtitle('GDP per capita and life expectancy in {closest_state}',\n          subtitle = 'China highlighted') + \n  labs(x='GDP per capita (logged)\\n',\n       y='Life expectancy (years)',\n       caption='Source: Gapminder dataset') + \n  scale_x_log10() + \n  my.theme + \n  transition_states(\n    year,\n    transition_length = 2,\n    state_length = 1,\n    wrap = TRUE\n  ) + \n  scale_alpha_discrete(range = c('China' = 1,\n                                  'Other' = .1)) + \n  theme(legend.position = 'top') + \n  guides(size='none', alpha='none')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using alpha for a discrete variable is not advised.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.gif)\n:::\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}