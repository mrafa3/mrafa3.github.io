{
  "hash": "9f2b451f4dd6b9d612aa48ccc2f10f58",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Experimenting with distance as a concept for SDG achievement\"\ndescription: \"Exploring how to conceptualize and visualize distance from Sustainable Development Goal targets\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\n    #orcid: 0000-0002-5300-3075\ndate: 04-15-2019\ncategories: [R, data-viz, tidyverse, international-development, cluster-analysis, mapping] # self-defined categories\n#citation: \n # url: https://mrafa3.github.io/posts/2024-07-15-wikipedia-international-mens-soccer/ \nimage: distance_plot.png\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#code for the targets of each health-related goal\nsdg_targets <- data.frame(\n  variable = c(\"MATMORTRATIO\", \"NEONATMOR\", \"CHILDDTHR\", \"NonCommun\", \"TrafficAcc\", \"AIDS\", \"Malaria\"),\n  country = rep(\"TARGET\", 7),\n  `2030` = c(70, 12, 25, 2/3, 0.5, 0.001, 0.001)\n) %>% \n  rename(\"2030\" = \"X2030\")\n\n(df <- read_csv('.//data/IFs_results_02apr2019.csv') %>% \n   filter(scenario == '00CP_adj_ADB') %>% \n   select(1:5, `2015`, `2020`, `2030`, `2063`))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 1458 Columns: 111\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (5): variable, country, unit, dim, scenario\ndbl (89): 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 1969, 1970, ...\nnum (17): 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, ...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 486 × 9\n   variable  country  unit       dim   scenario     `2015` `2020` `2030` `2063`\n   <chr>     <chr>    <chr>      <chr> <chr>         <dbl>  <dbl>  <dbl>  <dbl>\n 1 DeathRate Algeria  TrafficAcc Total 00CP_adj_ADB 0.268  0.271  0.284   0.337\n 2 DeathRate Algeria  AIDS       Total 00CP_adj_ADB 0.005  0.008  0.005   0.001\n 3 DeathRate Algeria  Malaria    Total 00CP_adj_ADB 0.0002 0.0002 0.0001  0    \n 4 DeathRate Angola   TrafficAcc Total 00CP_adj_ADB 0.386  0.37   0.402   0.525\n 5 DeathRate Angola   AIDS       Total 00CP_adj_ADB 0.395  0.314  0.198   0.021\n 6 DeathRate Angola   Malaria    Total 00CP_adj_ADB 0.52   0.512  0.375   0.052\n 7 DeathRate Benin    TrafficAcc Total 00CP_adj_ADB 0.213  0.219  0.229   0.387\n 8 DeathRate Benin    AIDS       Total 00CP_adj_ADB 0.274  0.203  0.111   0.007\n 9 DeathRate Benin    Malaria    Total 00CP_adj_ADB 1.21   0.808  0.424   0.083\n10 DeathRate Botswana TrafficAcc Total 00CP_adj_ADB 0.174  0.177  0.183   0.192\n# ℹ 476 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(df_scaled_dist_results <- df %>% \n  filter(variable %in% c('MATMORTRATIO', 'NEONATMOR', 'CHILDDTHR') | \n         unit %in% c('AIDS', 'Malaria')) %>% \n  mutate(variable = ifelse(unit %in% c('AIDS', 'Malaria'), as.character(unit), as.character(variable))) %>% \n  select(variable, country, `2030`) %>% \n  spread(variable, `2030`) %>% \n  #add targets as row by reshaping the targets dataframe\n  bind_rows(., \n            sdg_targets %>%\n              spread(variable, `2030`)) %>% \n  mutate_at(vars(AIDS:NEONATMOR), funs(scale(.))) %>% \n  select(-c(7:8)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 55 × 6\n   country     AIDS[,1] CHILDDTHR[,1] Malaria[,1] MATMORTRATIO[,1] NEONATMOR[,1]\n   <chr>          <dbl>         <dbl>       <dbl>            <dbl>         <dbl>\n 1 Algeria       -0.812      -1.04        -0.785            -1.04        -0.440 \n 2 Angola        -0.340       1.22         0.363             0.417        3.07  \n 3 Benin         -0.553       0.475        0.513            -0.117        0.0158\n 4 Botswana       1.29       -0.708       -0.766            -1.20        -0.126 \n 5 Burkina Fa…   -0.648       0.386        1.16             -0.227       -0.182 \n 6 Burundi       -0.575       0.00822     -0.0256            1.11        -0.212 \n 7 Cameroon       0.432       0.805        1.29              0.683        0.376 \n 8 Cape Verde    -0.294      -1.27        -0.784            -1.46        -0.971 \n 9 Central AfR    0.569       1.73         0.501             1.63         1.32  \n10 Chad          -0.558       2.78         0.648             1.78         2.14  \n# ℹ 45 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(df_scaled_dist_results_rel_targets <- df %>% \n  filter(unit %in% c('TrafficAcc', 'NonCommun')) %>% \n  select(unit, country, `2015`, `2020`, `2030`) %>% \n  rename('variable' = 'unit') %>% \n  mutate(ratio_ = ifelse(variable == 'TrafficAcc', `2020` / `2015`, `2030` / `2015`)) %>% \n  select(-c(3:5)) %>% \n  spread(variable, ratio_) %>% \n  bind_rows(., \n            #add targets as row by reshaping the targets dataframe\n            sdg_targets %>%\n              filter(variable %in% c('TrafficAcc', 'NonCommun')) %>% \n              spread(variable, `2030`)) %>% \n  mutate_at(vars(NonCommun:TrafficAcc), funs(scale(.))))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 55 × 3\n   country      NonCommun[,1] TrafficAcc[,1]\n   <chr>                <dbl>          <dbl>\n 1 Algeria              1.52          0.0612\n 2 Angola              -0.304        -0.570 \n 3 Benin               -0.518         0.265 \n 4 Botswana             1.66          0.134 \n 5 Burkina Faso        -0.640         0.306 \n 6 Burundi             -0.928        -1.03  \n 7 Cameroon            -0.761         0.319 \n 8 Cape Verde          -0.388         0.539 \n 9 Central AfR         -0.497        -0.0730\n10 Chad                -0.974        -0.452 \n# ℹ 45 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmy.theme.minimal <- theme(\n  plot.title = element_text(color=\"black\", face=\"plain\", size=10, hjust=0), \n  plot.subtitle = element_text(color=\"black\", size=15, hjust=0), \n  axis.title = element_text(color=\"black\", face=\"plain\", size=14), \n  axis.text.y = element_text(size=13), \n  axis.text.x = element_text(angle = 90, hjust = 1, size=16), \n  axis.line = element_line(linewidth = .5, color = \"black\"),\n  plot.caption = element_text(color=\"black\", size=13), \n  panel.background =  element_blank(), \n  panel.border = element_blank(), \n  legend.title=element_blank(), \n  legend.text = element_text(color=\"black\", size=14, hjust=0),\n  legend.spacing.x = unit(.5, 'cm'), \n  legend.position = 'bottom',\n  strip.text = element_text(color=\"black\", face=\"plain\", size=16),\n  strip.background = element_rect(fill = \"white\"))\n```\n:::\n\n\n## Setting order by distance from achievement \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 54 × 2\n   country               avg_val\n   <chr>                   <dbl>\n 1 Libya                  -0.703\n 2 Sao Tome and Principe  -0.677\n 3 Cape Verde             -0.661\n 4 Seychelles             -0.635\n 5 Egypt                  -0.630\n 6 Tunisia                -0.552\n 7 Senegal                -0.453\n 8 Niger                  -0.387\n 9 Eritrea                -0.373\n10 Algeria                -0.363\n# ℹ 44 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(dist_plot_df <- df_scaled_dist_results %>% \n  filter(country != 'TARGET') %>% \n  left_join(x=.,\n            y=df_scaled_dist_results_rel_targets,\n            by='country') %>% \n  left_join(x=.,\n            y=cntry_order,\n            by='country') %>% \n  arrange(-avg_val) %>% \n  gather(var, val, 2:8))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: attributes are not identical across measure variables; they will be\ndropped\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 378 × 4\n   country     avg_val var        val\n   <chr>         <dbl> <chr>    <dbl>\n 1 Nigeria       1.15  AIDS  -0.00515\n 2 Somalia       0.922 AIDS  -0.711  \n 3 Equa Guinea   0.843 AIDS   0.902  \n 4 Chad          0.766 AIDS  -0.558  \n 5 Central AfR   0.741 AIDS   0.569  \n 6 SierraLeo     0.610 AIDS  -0.372  \n 7 Lesotho       0.610 AIDS   3.90   \n 8 Angola        0.551 AIDS  -0.340  \n 9 Sudan South   0.527 AIDS   1.02   \n10 Cameroon      0.449 AIDS   0.432  \n# ℹ 368 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncntry_order$country <- as.factor(cntry_order$country)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(df_target_scaled_vals <- df_scaled_dist_results %>% \n  filter(country == 'TARGET') %>% \n  left_join(x=.,\n            y=df_scaled_dist_results_rel_targets %>% filter(country == 'TARGET'),\n            by='country') %>% \n  gather(var, target, 2:8) %>% \n  select(2:3))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: attributes are not identical across measure variables; they will be\ndropped\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 2\n  var          target\n  <chr>         <dbl>\n1 AIDS         -0.821\n2 CHILDDTHR    -0.868\n3 Malaria      -0.782\n4 MATMORTRATIO -1.08 \n5 NEONATMOR    -0.516\n6 NonCommun    -3.05 \n7 TrafficAcc   -6.07 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncbPalette <- c(\"#999999\", \"#E69F00\", \"#56B4E9\", \"#009E73\", \"#F0E442\", \"#0072B2\", \"#D55E00\", \"#CC79A7\")\n\ntarg_cols <- c('AIDS' = \"#E69F00\", \n               'CHILDDTHR' = \"#56B4E9\",\n               'Malaria' = \"#009E73\",\n               'MATMORTRATIO' = \"#F0E442\",\n               'NEONATMOR' = \"#0072B2\",\n               'NonCommun' = \"#D55E00\",\n               'TrafficAcc' = \"#CC79A7\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(dist_plot_df_2 <- dist_plot_df %>% \n  left_join(x=.,\n            y=df_target_scaled_vals,\n            by='var'))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 378 × 5\n   country     avg_val var        val target\n   <chr>         <dbl> <chr>    <dbl>  <dbl>\n 1 Nigeria       1.15  AIDS  -0.00515 -0.821\n 2 Somalia       0.922 AIDS  -0.711   -0.821\n 3 Equa Guinea   0.843 AIDS   0.902   -0.821\n 4 Chad          0.766 AIDS  -0.558   -0.821\n 5 Central AfR   0.741 AIDS   0.569   -0.821\n 6 SierraLeo     0.610 AIDS  -0.372   -0.821\n 7 Lesotho       0.610 AIDS   3.90    -0.821\n 8 Angola        0.551 AIDS  -0.340   -0.821\n 9 Sudan South   0.527 AIDS   1.02    -0.821\n10 Cameroon      0.449 AIDS   0.432   -0.821\n# ℹ 368 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(seg_length <- dist_plot_df_2 %>% \n  mutate(achieve = ifelse(val <= target, 1, 0)) %>% \n  filter(achieve == 0) %>% \n  group_by(country) %>% \n  summarise(min_val = min(val),\n            max_val = max(val)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 54 × 3\n   country      min_val max_val\n   <chr>          <dbl>   <dbl>\n 1 Algeria       -1.04    1.52 \n 2 Angola        -0.570   3.07 \n 3 Benin         -0.553   0.513\n 4 Botswana      -0.766   1.66 \n 5 Burkina Faso  -0.648   1.16 \n 6 Burundi       -1.03    1.11 \n 7 Cameroon      -0.761   1.29 \n 8 Cape Verde    -0.388   0.539\n 9 Central AfR   -0.497   1.73 \n10 Chad          -0.974   2.78 \n# ℹ 44 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndist_plot_df_2 %>% \n  mutate(achieve = ifelse(val <= target, 1, 0)) %>% \n  filter(achieve == 0) %>% \n  ggplot(.,\n         aes(x=val, \n             y=factor(country, levels=cntry_order$country))) + \n  geom_point(aes(color=var), \n             #height=.25, width=0,\n             alpha=.5, size=8) + \n  geom_segment(data=seg_length,\n               aes(x=min_val, xend=max_val, yend=country),\n               color='gray60', linewidth=1) + \n  labs(x='',\n       y='') + \n  my.theme.minimal + \n  theme(legend.position = 'top') + \n  scale_color_manual(values = targ_cols,\n                     labels = c('MATMORTRATIO' = 'Maternal Mortality',\n                               'NEONATMOR' = 'Neonatal Mortality',\n                               'CHILDDTHR' = '< 5 Mortality',\n                               'NonCommun' = 'NCDs',\n                               'TrafficAcc' = 'Traffic Mortality')) + \n  scale_y_discrete(labels = function(x) str_wrap(x, width = 10)) + \n  scale_x_continuous(position = 'top')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}