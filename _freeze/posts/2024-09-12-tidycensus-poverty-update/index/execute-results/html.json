{
  "hash": "718427ed5a8c0180b8b5ff8e97be7145",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Reviewing the ACS-1 2023 child poverty estimates\"\ndescription: \"This post looks at how child poverty estimates have changed in the latest U.S. Census data\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\n    #orcid: 0000-0002-5300-3075\ndate: 09-12-2024\ncategories: [R, data-viz, tidyverse, tidycensus, api, purrr] # self-defined categories\n#citation: \n # url: https://mrafa3.github.io/posts/2024-07-15-wikipedia-international-mens-soccer/ \n# image: co_county_pov_2022.png\ndraft: true # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\ncode-annotations: hover\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n\n\n# Introduction\n\nIn a [previous tidycensus:: post](), I showed how to fetch data and do some basic, longitudinal analysis of U.S. Census data. Today, the Census Bureau released the 1-year estimates from the American Community Survey (ACS), so I'd like to see how child poverty seems to be changing from the 2022 to 2023 releases.\n\n## Setup\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidycensus)\nlibrary(scales) # <1>\nlibrary(gt) # <2>\nlibrary(glue) # <3>\nlibrary(ggforce) # <4>\n\n# census_api_key('INSERT KEY HERE', install = TRUE) # <5>\n```\n:::\n\n\n\n\n1. Loading the `scales::` package to transform ggplot scales simply (some people choose to explicitly define `scales::` in their code rather than loading the library).\n2. The `gt::` library provides functionality for creating ggplot-esque tables.\n3. The `glue::` package allows for simple addition of HTML to ggplot graphics.\n4. The `ggforce::` package includes a `geom_link()` function, which I'll use to create the comet effect in the comet plots that I use.\n5. The first time that you're working with the `tidycensus::` package, you need to request an API key at https://api.census.gov/data/key_signup.html. The `install=` argument will install your personal key to the .Renviron file, and you won't need to use the `census_api_key()` function again.  \n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n# Data\n\nFor this analysis, I'm interested in looking at the most recent state-level child poverty data available from the U.S. Census Bureau, and I want to construct a longitudinal sense of the change in child poverty. \n\nFirst, let's revisit the different American Community Survey products -- **ACS-1** and **ACS-5**.\n\n*What's the difference between these, and how do you choose which survey product to use for your purposes?*\n\n\n| Feature                    | ACS 1-Year Estimates                                 | ACS 5-Year Estimates                               |\n|----------------------------|-----------------------------------------------------|---------------------------------------------------|\n| Data Collection Period      | 12 months                                           | 60 months                                         |\n| Population Coverage         | Areas with 65,000 or more people                    | All geographic areas, including those with fewer than 65,000 people |\n| Sample Size                 | Smallest                                            | Largest                                           |\n| Reliability                 | Less reliable due to smaller sample size            | More reliable due to larger sample size            |\n| Currency                    | Most current data                                   | Less current, includes older data                 |\n| Release Frequency           | Annually                                            | Annually                                          |\n| Best Used For               | Analyzing large populations, when currency is more important than precision | Analyzing small populations, where precision is more important than currency |\n| Example Usage               | Examining recent economic changes                   | Examining trends in small geographic areas or small population subgroups |\n\n\nFor this post, I am interested in constructing a longitudinal dataset of the most recent year-on-year estimates, including the 2023 1-year estimates that were released today. Note that for the ACS-1 products, estimates are only available for geographic units with populations greater than 65,000.\n\nAs I did in prior posts, I'll use the following series from the American Community Survey:\n\n-   *B01001_003*: Estimate!!Total:!!Male:!!Under 5 years (all racial\n    groups)\n-   *B01001_027*: Estimate!!Total:!!Female:!!Under 5 years (all racial\n    groups)\n-   *B17001_004*: Estimate!!Total:!!Income in the past 12 months below\n    poverty level:!!Male:!!Under 5 years\n-   *B17001_018*: Estimate!!Total:!!Income in the past 12 months below\n    poverty level:!!Female:!!Under 5 years\n\n## Fetching from the `tidycensus::` API\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyears <- c(2022, 2023)\n```\n:::\n\n\n\n\nNext, I'll define a function to fetch the ACS data for each year in the vector.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfetch_acs_data <- function(year) {\n  get_acs(geography = \"state\", \n          survey = 'acs1',\n          variables = c(male_u5_pop = 'B01001_003', \n                        female_u5_pop = 'B01001_027', \n                        male_u5_poverty = 'B17001_004', \n                        female_u5_poverty = 'B17001_018'),\n          year = year,\n          output = 'wide') %>% \n    mutate(year = year,\n           total_u5_popE = male_u5_popE + female_u5_popE, # <6>\n           total_u5_povertyE = male_u5_povertyE + female_u5_povertyE, # <6>\n           perc_u5_poverty = total_u5_povertyE / total_u5_popE) # <6>\n}\n\nfetch_acs_data_county <- function(year) {\n  get_acs(geography = \"county\", \n          survey = 'acs1',\n          variables = c(male_u5_pop = 'B01001_003', \n                        female_u5_pop = 'B01001_027', \n                        male_u5_poverty = 'B17001_004', \n                        female_u5_poverty = 'B17001_018'),\n          year = year,\n          geometry = TRUE,\n          output = 'wide') %>% \n    mutate(year = year,\n           total_u5_popE = male_u5_popE + female_u5_popE,\n           total_u5_povertyE = male_u5_povertyE + female_u5_povertyE,\n           perc_u5_poverty = total_u5_povertyE / total_u5_popE,\n           county = str_remove(NAME, \" County.*\"), # <7>\n           state = str_extract(NAME, \"[\\\\w\\\\s]+$\") %>% str_trim()) %>% # <7>\n    select(county, state, everything())\n}\n```\n:::\n\n\n\n\n6. Creating some fields to combine gender-based poverty estimates and calculate a percent of the child population measure\n7. Creating a `state` and `county` fields to manipulate the dataframe and visualize with more simplicity\n\nThen, I'll use `purrr::map_df()` to apply each year to the `fetch_acs_data()` function that I created, which will result in a single dataframe of all years.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_acs_data <- map_df(years, fetch_acs_data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_acs_data_county <- map_df(years, fetch_acs_data_county)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2022 1-year ACS\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe 1-year ACS provides data for geographies with populations of 65,000 and greater.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |==                                                                    |   4%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |=======                                                               |  11%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |==============                                                        |  21%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |================                                                      |  24%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=====================                                                 |  31%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |=======================                                               |  34%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |============================                                          |  41%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===============================                                       |  45%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=================================                                     |  48%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |===================================                                   |  51%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |=====================================                                 |  54%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |==========================================                            |  61%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |============================================                          |  64%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |=================================================                     |  71%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |========================================================              |  81%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |==========================================================            |  84%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |===============================================================       |  91%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |=================================================================     |  94%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |====================================================================  |  98%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================|  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2023 1-year ACS\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe 1-year ACS provides data for geographies with populations of 65,000 and greater.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |==                                                                    |   4%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |=======                                                               |  11%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |==============                                                        |  21%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=====================                                                 |  31%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |============================                                          |  41%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |==============================                                        |  44%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===============================                                       |  45%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=================================                                     |  48%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |===================================                                   |  51%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |=====================================                                 |  54%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |==========================================                            |  61%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |============================================                          |  64%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |=================================================                     |  71%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |========================================================              |  81%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |===============================================================       |  91%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |====================================================================  |  98%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================|  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n:::\n\n\n\n\n# Analysis \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_acs_data <- combined_acs_data %>% \n  group_by(NAME) %>% \n  # group_by(NAME, county) %>% \n  mutate(perc_u5_poverty_tminus_1 = lag(perc_u5_poverty),\n         perc_u5_poverty_tminus_3 = lag(perc_u5_poverty, 3),\n         perc_u5_poverty_tminus_5 = lag(perc_u5_poverty, 5),\n         perc_u5_poverty_tminus_10 = lag(perc_u5_poverty, 10),\n         perc_diff_YoY = perc_u5_poverty - perc_u5_poverty_tminus_1,\n         perc_diff_tminus_3 = perc_u5_poverty - perc_u5_poverty_tminus_3,\n         perc_diff_tminus_5 = perc_u5_poverty - perc_u5_poverty_tminus_5,\n         perc_diff_tminus_10 = perc_u5_poverty - perc_u5_poverty_tminus_10) %>% \n  arrange(NAME)\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_acs_data %>% \n  filter(year == 2023,\n         NAME != 'Puerto Rico') %>% \n  arrange(-perc_diff_YoY) %>% \n  mutate(state = factor(NAME, levels = NAME),\n         direction = case_when(\n           perc_diff_YoY > .005 ~ \"Increase\",\n           perc_diff_YoY < -.005 ~ \"Decrease\",\n           TRUE ~ \"No Change\")) %>% \n         # direction = ifelse(perc_diff_YoY >= 0, \"Increase\", \"Decrease\")) %>% \n  ggplot(aes(y = reorder(NAME, -perc_diff_YoY),\n             color=direction)) +\n  geom_link(aes(x = perc_u5_poverty_tminus_1, y = fct_reorder(NAME, perc_diff_YoY), \n              xend = perc_u5_poverty, yend = fct_reorder(NAME, perc_diff_YoY), \n              size = stat(index))) + \n  geom_point(data = . %>% filter(perc_diff_YoY > 0),\n             aes(perc_u5_poverty, y = fct_reorder(NAME, perc_diff_YoY)),\n             shape = 21, fill = \"white\", size = 4)  +\n  geom_point(data = . %>% filter(perc_diff_YoY < 0),\n             aes(perc_u5_poverty, y = fct_reorder(NAME, perc_diff_YoY)),\n             shape = 21, fill = \"white\", size = 4) +\n  annotate(geom = 'label', x = .27, y = 49, label = \"Poverty rate increased\\n in 2023\", \n         family = \"Palatino\", color = \"#E64B35FF\", fontface = 'bold', \n         fill = \"floralwhite\",\n         label.size = 0, size = 4) + \n  annotate(geom = 'label', x = .27, y = 36.5, label = \"Poverty rate unchanged\\n in 2023\", \n         family = \"Palatino\", color = \"#444444\", fontface = 'bold', \n         fill = \"floralwhite\",\n         label.size = 0, size = 4) + \n  annotate(geom = 'label', x = .27, y = 24.5, label = \"Poverty rate decreased\\nin 2023\", \n         family = \"Palatino\", color = \"#00A087FF\", fontface = 'bold', \n         fill = \"floralwhite\",\n         label.size = 0, size = 4) + \n  scale_color_manual(values = c(\"Decrease\" = \"#00A087FF\", \"Increase\" = \"#E64B35FF\", \"No Change\" = \"#444444\")) +\n  scale_size(range = c(.01, 4)) +\n  labs(title='Change in State-level Child Poverty from 2022 to 2023',\n       subtitle = 'Size of the color band corresponds to the magnitude of change<br>', \n       caption=\"<br>Source: U.S. Census Bureau's American Community Survey 1-year Estimates<br>ACS-1 has wider undercertainty bands due to smaller sampling\",\n       x='\\n% of children (under 5 y.o.) living\\nunder the Federal Poverty Line in 2023\\n',\n       y='') + \n  scale_x_continuous(labels = percent, position='top') + \n  my_theme + \n  theme(legend.position = 'none')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: `stat(index)` was deprecated in ggplot2 3.4.0.\n Please use `after_stat(index)` instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n\n\n\n\nThinking about a comet plot. Use this as a guide: https://thef5.substack.com/p/how-to-comet-plot\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\nIt's important to remember that all ACS estimates have a margin of error (which by default is a 90% confidence interval), so point estimates should be complemented with their respective error bands. ACS-1 is a smaller sampling than the ACS-5 product, so these margins of error can be more significant. This shows that one of *New Mexico*, *Louisiana*, or *West Virginia* could have the highest under-five poverty rate as of the 2023 survey.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncombined_acs_data %>% \n  filter(year == 2023,\n         NAME != 'Puerto Rico') %>%\n  group_by(NAME) %>% \n  mutate(total_u5_poverty_MOEcalc = moe_sum(male_u5_povertyM, female_u5_povertyM),\n         perc_u5_poverty_MOEcalc = total_u5_poverty_MOEcalc / total_u5_popE) %>% \n  ggplot(\n    aes(x=perc_u5_poverty, \n        y=reorder(NAME, perc_u5_poverty))) + \n  geom_point(size=3) +\n  geom_errorbarh(aes(xmin=perc_u5_poverty - perc_u5_poverty_MOEcalc, \n                     xmax=perc_u5_poverty + perc_u5_poverty_MOEcalc),\n                 height = 0.4) + \n  labs(y='',\n       x='',\n       caption=caption_text) + \n  ggtitle(title_text,\n          subtitle=subtitle_text) +\n  scale_x_continuous(labels = percent,\n                     position = 'top') + \n  my_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/dot_plot-1.png){fig-align='center' width=1056}\n:::\n:::\n\n\n\n\n1. Using the `tidycensus::` margin of error aggregation functions to create confidence bands around the point estimate.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_acs_data_county <- combined_acs_data_county %>% \n  group_by(state, county) %>% \n  mutate(perc_u5_poverty_tminus_1 = lag(perc_u5_poverty),\n           perc_diff_YoY = perc_u5_poverty - perc_u5_poverty_tminus_1) %>% \n  arrange(NAME)\n```\n:::\n\n\n\n\n# Colorado \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# library(tigris)\n# library(patchwork)\n# \n# # Load state boundaries from tigris\n# states_sf <- states(cb = TRUE) %>% \n#   filter(!STUSPS %in% c('GU', 'AS', 'MP', 'VI', 'PR'))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the main map\n# main_map <- combined_acs_data_county %>%\n#   filter(year == 2023) %>%\n#   filter(!state %in% c('Alaska', 'Hawaii')) %>%\n#   ggplot() +\n#   geom_sf(aes(fill = perc_diff_YoY), color = NA) +\n#   geom_sf(data = states_sf, fill = NA, color = \"black\", size = 0.2) +  # Add state outlines\n#   coord_sf(datum = NA) +\n#   scale_fill_gradient2(low = muted(\"blue\"), mid = \"white\", high = muted(\"red\"),\n#                        labels = percent) +\n#   ggtitle('Percentage point change in child poverty (2022 to 2023)') +\n#   labs(caption = 'Source: U.S. Census Bureau, ACS 1-year estimates') +\n#   theme_minimal() +\n#   theme(plot.title = element_textbox_simple(face = \"bold\", size = 14),\n#         legend.title = element_blank(),\n#         legend.key.size = unit(1.25, \"cm\"),\n#         legend.text = element_text(size = 12))\n# \n# # Create inset maps for Alaska and Hawaii\n# alaska_map <- combined_acs_data_county %>%\n#   filter(year == 2023, state == 'Alaska') %>%\n#   ggplot() +\n#   geom_sf(aes(fill = perc_diff_YoY), color = NA) +\n#   coord_sf(datum = NA) +\n#   scale_fill_gradient2(low = muted(\"blue\"), mid = \"white\", high = muted(\"red\"),\n#                        labels = percent) +\n#   theme_void() +\n#   theme(legend.position = \"none\") +\n#   labs(title = \"Alaska\")\n# \n# hawaii_map <- combined_acs_data_county %>%\n#   filter(year == 2023, state == 'Hawaii') %>%\n#   ggplot() +\n#   geom_sf(aes(fill = perc_diff_YoY), color = NA) +\n#   coord_sf(datum = NA) +\n#   scale_fill_gradient2(low = muted(\"blue\"), mid = \"white\", high = muted(\"red\"),\n#                        labels = percent) +\n#   theme_void() +\n#   theme(legend.position = \"none\") +\n#   labs(title = \"Hawaii\")\n# \n# # Combine the main map with insets using patchwork\n# final_map <- main_map +\n#   inset_element(alaska_map, left = 0.15, bottom = 0.1, right = 0.35, top = 0.3) +\n#   inset_element(hawaii_map, left = 0.4, bottom = 0.1, right = 0.5, top = 0.2) +\n#   plot_layout(guides = \"collect\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_acs_data_county %>% \n  filter(year == 2023) %>%\n  filter(!state %in% c('Alaska', 'Hawaii')) %>% \n         # state == 'Colorado') %>% \n  ggplot() + \n  geom_sf(aes(fill=perc_diff_YoY), color=NA) + \n  # geom_sf(data = states_sf, fill = NA, color = \"black\", size = 0.2) +\n  coord_sf(datum = NA) + \n  scale_fill_gradient2(low = muted(\"blue\"), mid = \"white\", high = muted(\"red\"),\n                       labels = percent) + \n  # scale_fill_viridis_b(labels = percent,\n  #                      n.breaks = 5) + \n  ggtitle('Percentage point change in child poverty (2022 to 2023)') + \n  labs(caption = 'Source: U.S. Census Bureau, ACS 1-year estimates') + \n  theme_minimal() + \n  theme(plot.title = ggtext::element_textbox_simple(face=\"bold\", size=14),\n        legend.title = element_blank(),\n        legend.key.size = unit(1.25, \"cm\"),\n        legend.text = element_text(size = 12))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_acs_data_county %>% \n  filter(year == 2023,\n         state == 'Colorado') %>% \n  arrange(-perc_diff_YoY) %>% \n  mutate(county = factor(county, levels = county),\n         direction = case_when(\n           perc_diff_YoY > .005 ~ \"Increase\",\n           perc_diff_YoY < -.005 ~ \"Decrease\",\n           TRUE ~ \"No Change\")) %>% \n         # direction = ifelse(perc_diff_YoY >= 0, \"Increase\", \"Decrease\")) %>% \n  ggplot(aes(y = reorder(county, -perc_diff_YoY),\n             color=direction)) +\n  geom_link(aes(x = perc_u5_poverty_tminus_1, y = fct_reorder(county, perc_diff_YoY), \n              xend = perc_u5_poverty, yend = fct_reorder(county, perc_diff_YoY), \n              size = stat(index))) + \n  geom_point(data = . %>% filter(perc_diff_YoY > 0),\n             aes(perc_u5_poverty, y = fct_reorder(county, perc_diff_YoY)),\n             shape = 21, fill = \"white\", size = 4)  +\n  geom_point(data = . %>% filter(perc_diff_YoY < 0),\n             aes(perc_u5_poverty, y = fct_reorder(county, perc_diff_YoY)),\n             shape = 21, fill = \"white\", size = 4) +\n  # annotate(geom = 'label', x = .27, y = 49, label = \"Poverty rate increased\\n in 2023\", \n  #        family = \"Palatino\", color = \"#E64B35FF\", fontface = 'bold', \n  #        fill = \"floralwhite\",\n  #        label.size = 0, size = 4) + \n  # annotate(geom = 'label', x = .27, y = 36.5, label = \"Poverty rate unchanged\\n in 2023\", \n  #        family = \"Palatino\", color = \"#444444\", fontface = 'bold', \n  #        fill = \"floralwhite\",\n  #        label.size = 0, size = 4) + \n  # annotate(geom = 'label', x = .27, y = 24.5, label = \"Poverty rate decreased\\nin 2023\", \n  #        family = \"Palatino\", color = \"#00A087FF\", fontface = 'bold', \n  #        fill = \"floralwhite\",\n  #        label.size = 0, size = 4) + \n  scale_color_manual(values = c(\"Decrease\" = \"#00A087FF\", \"Increase\" = \"#E64B35FF\", \"No Change\" = \"#444444\")) +\n  scale_size(range = c(.01, 4)) +\n  labs(title='Change in County-level Child Poverty in Colorado from 2022 to 2023',\n       subtitle = 'Size of the color band corresponds to the magnitude of change<br>', \n       caption=\"<br>Source: U.S. Census Bureau's American Community Survey 1-year Estimates<br>ACS-1 has wider undercertainty bands due to smaller sampling\",\n       x='\\n% of children (under 5 y.o.) living\\nunder the Federal Poverty Line in 2023\\n',\n       y='') + \n  scale_x_continuous(labels = percent, position='top') + \n  my_theme + \n  theme(legend.position = 'none')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/colorado_comet-1.png){width=768}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncombined_acs_data_county %>% \n  filter(year == 2023,\n         state == 'Colorado') %>%\n  group_by(county) %>% \n  mutate(total_u5_poverty_MOEcalc = moe_sum(male_u5_povertyM, female_u5_povertyM),\n         perc_u5_poverty_MOEcalc = total_u5_poverty_MOEcalc / total_u5_popE) %>% \n  ggplot(\n    aes(x=perc_u5_poverty, \n        y=reorder(county, perc_u5_poverty))) + \n  geom_point(size=3) +\n  geom_errorbarh(aes(xmin=if_else(perc_u5_poverty - perc_u5_poverty_MOEcalc < 0, 0, perc_u5_poverty - perc_u5_poverty_MOEcalc), \n                     xmax=perc_u5_poverty + perc_u5_poverty_MOEcalc),\n                 height = 0.4) + \n  labs(y='',\n       x='',\n       caption=caption_text) + \n  ggtitle('Percent of children in poverty in Colorado in 2023',\n          subtitle=subtitle_text) +\n  scale_x_continuous(labels = percent,\n                     position = 'top') + \n  my_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/dot_plot2-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n\n\n\n# Conclusion\n\nIn this `tidycensus::` post, I demonstrated:\n\n-   How to fetch data across multiple years from the U.S. Census Bureau and wrangle the data for longitudinal analysis\n-   How to move between R or Python objects and Observable JS objects in Quarto \n-   How to make some simple interactive graphics with Observable Plot\n\nMore to come on poverty analysis in future posts!\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}