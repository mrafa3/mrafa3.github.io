{
  "hash": "e96bd7b73c15a38174f9c170a5fc2c12",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analyzing Health Professional Shortage Areas in the U.S.\"\ndescription: \"\"\nauthor:\n  - name: Mickey Rafa\n    url: https://mrafa3.github.io/\n    #orcid: 0000-0002-5300-3075\ndate: 10-02-2024\ncategories: [R, data-viz, mapping, tidyverse, mental-health, web-scraping] # self-defined categories\n#citation: \n # url: https://mrafa3.github.io/posts/2024-07-15-wikipedia-international-mens-soccer/ \n# image: theme_map.png\ndraft: true # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\ncode-annotations: hover\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n\n\n# Introduction\n\nI'm a big fan of the [*American Inequality*](https://americaninequality.substack.com/) project. *American Inequality* uses data storytelling and mapping to tell important stories about patterns of social and economic inequality across the U.S., including topics like food deserts, public school funding, and climate change vulnerability. In a recent post on mental health, *American Inequality* used a data on [Mental Healthcare Professional Shortage Areas](https://data.hrsa.gov/topics/health-workforce/shortage-areas), as measured by the U.S. Health Resources and Services Administration. After reading this analysis, I wanted to explore this dataset myself.\n\n## Purpose \n\nTo review and understand what is measured and available in the Healthcare Professional Shortage Areas data.\n\n## Setup\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggtext)\nlibrary(rvest)\nlibrary(dlookr)\nlibrary(tigris)\nlibrary(biscale)\nlibrary(glue)\nlibrary(maps)\nlibrary(sf)\nlibrary(patchwork)\n```\n:::\n\n\n\n\n\n\n# Data \n\n## Healthcare Professional Shortage Areas \n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_hpsa <- read_csv('https://data.hrsa.gov/DataDownload/DD_Files/HPSA_DASHBOARD.csv',\n                    col_types = col_types) %>% \n  janitor::clean_names() %>%\n  select(-x26)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNew names:\n• `` -> `...26`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat <- vroom(...)\n  problems(dat)\n```\n\n\n:::\n\n```{.r .cell-code}\n# write_csv(df_hpsa, './/data/hpsa_download.csv')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_hpsa %>% \n  dlookr::diagnose_category()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 171 × 6\n   variables  levels            N  freq ratio  rank\n   <chr>      <chr>         <int> <int> <dbl> <int>\n 1 discipline Primary Care  54982 21464 39.0      1\n 2 discipline Mental Health 54982 16979 30.9      2\n 3 discipline Dental Health 54982 16539 30.1      3\n 4 hhs_region Region 9      54982 11951 21.7      1\n 5 hhs_region Region 5      54982 10605 19.3      2\n 6 hhs_region Region 4      54982  8135 14.8      3\n 7 hhs_region Region 2      54982  4983  9.06     4\n 8 hhs_region Region 6      54982  4080  7.42     5\n 9 hhs_region Region 10     54982  3762  6.84     6\n10 hhs_region Region 3      54982  3617  6.58     7\n# ℹ 161 more rows\n```\n\n\n:::\n:::\n\n\n\n\nI'd like to analyze the bivariate relationship between mental healthcare providers (at correctional facilities) and the inmate populations across the U.S. *Which areas have the most acute shortage of healthcare professionals working in correctional facilities?*\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_hpsa %>% \n  filter(discipline == 'Mental Health',\n         hpsa_sub_type == 'Correctional Facility')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 537 × 25\n   discipline    hhs_region state          county   hpsa_id hpsa_name hpsa_score\n   <fct>         <fct>      <fct>          <chr>    <chr>   <chr>          <int>\n 1 Mental Health Region 5   Illinois       Randolph 717695… CF- Mena…          9\n 2 Mental Health Region 10  Washington     Pierce   753256… Washingt…         15\n 3 Mental Health Region 2   New York       Oneida   736785… Marcy Co…         12\n 4 Mental Health Region 9   Arizona        Maricopa 704968… Arizona …          6\n 5 Mental Health Region 5   Ohio           Madison  739871… Madison …          6\n 6 Mental Health Region 4   North Carolina Pasquot… 737839… Pasquota…         12\n 7 Mental Health Region 7   Missouri       Greene   729113… MCFP-Spr…         12\n 8 Mental Health Region 5   Ohio           Madison  739698… London C…         12\n 9 Mental Health Region 10  Idaho          Clearwa… 716505… Idaho Co…         15\n10 Mental Health Region 5   Ohio           Warren   739210… Lebanon …         12\n# ℹ 527 more rows\n# ℹ 18 more variables: hpsa_type_category <fct>, hpsa_type_code <fct>,\n#   hpsa_sub_type <fct>, hpsa_status <fct>, rural_status <fct>,\n#   hpsa_status_code <fct>, designation_date <date>, last_update_date <date>,\n#   hpsa_designation_population <dbl>, hpsa_component_id <chr>,\n#   hpsa_component_name <chr>, hpsa_component_type <fct>,\n#   hpsa_facility_address <chr>, hpsa_facility_city_and_state <chr>, …\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nzctas <- zctas(year = 2020, cb = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nZCTAs can take several minutes to download.  To cache the data and avoid re-downloading in future R sessions, set `options(tigris_use_cache = TRUE)`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |==                                                                    |   4%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |=======                                                               |  11%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |=========                                                             |  14%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |==============                                                        |  21%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |================                                                      |  24%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=====================                                                 |  31%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |=======================                                               |  34%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |============================                                          |  41%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |==============================                                        |  44%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===============================                                       |  45%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=================================                                     |  48%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |===================================                                   |  51%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |=====================================                                 |  54%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |==========================================                            |  61%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |============================================                          |  64%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |=================================================                     |  71%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |===================================================                   |  74%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |========================================================              |  81%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |==========================================================            |  84%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |===============================================================       |  91%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |=================================================================     |  94%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |====================================================================  |  98%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================|  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n\n```{.r .cell-code}\n# Download county data\ncounties <- counties(year = 2020, cb = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |==                                                                    |   4%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |=======                                                               |  11%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |==============                                                        |  21%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=====================                                                 |  31%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |============================                                          |  41%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===============================                                       |  45%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=================================                                     |  48%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |===================================                                   |  51%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |==========================================                            |  61%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |========================================================              |  81%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |===============================================================       |  91%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |====================================================================  |  98%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================|  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n\n```{.r .cell-code}\n# Perform a spatial join between ZCTAs and counties\nzcta_county <- st_join(zctas, counties)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_hpsa %>% \n  select(contains('zip'))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 54,982 × 2\n   hpsa_facility_zip_code zip_cleaned\n   <chr>                  <chr>      \n 1 <NA>                   <NA>       \n 2 40701-6285             40701      \n 3 <NA>                   <NA>       \n 4 <NA>                   <NA>       \n 5 67879-7708             67879      \n 6 53538-3100             53538      \n 7 10029                  10029      \n 8 <NA>                   <NA>       \n 9 61071-1005             61071      \n10 <NA>                   <NA>       \n# ℹ 54,972 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_mental_health <- df_hpsa %>% \n  filter(discipline == 'Mental Health',\n         hpsa_sub_type == 'Correctional Facility') %>% \n  group_by(state, county, zip_cleaned) %>% \n  summarise(count_mental_health_professionals = n(),\n            avg_hpsa_score = mean(hpsa_score, na.rm = TRUE),\n            sum_hpsa_designated_population = sum(hpsa_designation_population, na.rm = TRUE),\n            .groups = 'drop') %>% \n  # note that there's at least one empty geometry that I'll need to evaluate\n  left_join(x=.,\n            y=zcta_county %>% select(NAME, STUSPS, ZCTA5CE20, geometry) %>%\n              rename(county_name = NAME,\n                     state_name = STUSPS,\n                     zipcode = ZCTA5CE20),\n            by = c('zip_cleaned' = 'zipcode'))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in left_join(x = ., y = zcta_county %>% select(NAME, STUSPS, ZCTA5CE20, : Detected an unexpected many-to-many relationship between `x` and `y`.\nℹ Row 2 of `x` matches multiple rows in `y`.\nℹ Row 18844 of `y` matches multiple rows in `x`.\nℹ If a many-to-many relationship is expected, set `relationship =\n  \"many-to-many\"` to silence this warning.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# in progress\nstates <- map_data(\"state\")\ncounties <- map_data(\"county\")\n?map_data()\n```\n:::\n\n\n\n\nhttps://cran.r-project.org/web/packages/biscale/vignettes/biscale.html\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_mental_health %>% \n  # filter(!state_name %in% c('AK', 'HI', 'PR', 'GU')) %>% \n  filter(state_name %in% c('CO')) %>% \n  ggplot(.) + \n  geom_sf(aes(fill=avg_hpsa_score, geometry=geometry)) + \n  # geom_polygon(data = counties %>% filter(region == 'colorado'),\n  #              aes(x = long, y = lat, group = group),\n  #              fill = NA, linewidth = 0.5, color='black') + \n  # geom_polygon(data = states %>% filter(region == 'colorado'),\n  #              aes(x = long, y = lat, group = group),\n  #              fill = NA, linewidth = 0.5, color='black') +\n  coord_sf(datum = NA) + \n    scale_fill_gradient2(\n    low = \"#2469b3\",\n    mid = \"#f0eee5\",\n    high = \"#b6202c\",\n    midpoint = median(df_mental_health$avg_hpsa_score, na.rm = TRUE),\n    name = ''\n  ) + \n  theme_american_inequality_map()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n\n\n\n## Prison populations data \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_prison_pop <- read_html('https://www.prisonpolicy.org/data/prison_pops_2019_2023_sources.html') %>% \n  html_node(\"table\") %>%  # This selects the first table on the page\n  html_table() %>% \n  head(n = -2)\n\nnames(df_prison_pop) <- c(\"state\", \"prisonpop_2019\", \"prisonpop_2020\", \"prisonpop_2021\", \"prisonpop_2022\",\n                         \"prisonpop_2023\", \"source_2023\", \"source_url_2023\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_prison_pop <- df_prison_pop %>% \n  mutate(prisonpop_2023_derived = case_when(\n                                    str_starts(prisonpop_2023, \"No\") ~ prisonpop_2022,\n                                    TRUE ~ prisonpop_2023)\n         ) %>% \n  mutate(across(c('prisonpop_2019', 'prisonpop_2020', 'prisonpop_2021', 'prisonpop_2022', 'prisonpop_2023_derived'),\n                                 ~as.numeric(gsub(\"[^0-9.-]\", \"\", .))))\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_prison_pop %>% \n  top_n(10, prisonpop_2023_derived) %>% \n  ggplot(.) + \n  geom_col(aes(x=prisonpop_2023_derived,\n               y=reorder(state, prisonpop_2023_derived),\n               fill=if_else(state == 'Federal BOP', 'Federal BOP', 'Other'))) + \n  scale_x_continuous(labels = scales::comma,\n                     expand = expansion(mult = c(0, 0.05))) + \n  scale_fill_manual(values = bop_cols) + \n  ggtitle(glue(\"The <span style='color:#228B22'>**Federal Bureau of Prisons**</span> has a larger inmate<br>population than any state in 2023\"),\n          subtitle = '\\n') + \n  labs(x='',\n       y='',\n       caption='Source: Prison Policy Initiative\\nData for Texas from 2022') + \n  theme_american_inequality_map() + \n  theme(legend.position = 'none',\n        axis.text = element_text(size=14))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/prisonpop_2023_top10-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_population <- tidycensus::get_acs(\n  geography = 'state',\n  variables = 'B01003_001',\n  year = 2023,\n  survey = 'acs1',\n  geometry = FALSE\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2023 1-year ACS\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe 1-year ACS provides data for geographies with populations of 65,000 and greater.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_prison_pop %>% \n  left_join(x=.,\n            y=state_population,\n            by=c('state' = 'NAME')) %>% \n  ggplot(.,\n         aes(x=estimate,\n             y=prisonpop_2023_derived)) + \n  geom_point() + \n  geom_smooth(method='lm', se=FALSE) + \n  ggrepel::geom_text_repel(aes(label=state),\n                           box.padding = .5) + \n  scale_x_continuous(labels = scales::comma) + \n  scale_y_continuous(labels = scales::comma) + \n  theme_american_inequality_map()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# note: need to distribute Federal BOP populations according to BOP facilities\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(df_mental_health_state <- df_mental_health %>% \n  group_by(state) %>% \n  summarise(ttl_mental_health_professionals = sum(count_mental_health_professionals, na.rm = TRUE),\n            ttl_designated_population = sum(sum_hpsa_designated_population, na.rm = TRUE),\n            .groups = 'drop'))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 46 × 3\n   state         ttl_mental_health_professionals ttl_designated_population\n   <fct>                                   <int>                     <dbl>\n 1 New York                                   45                     48094\n 2 Kentucky                                   19                     29552\n 3 Illinois                                   46                    104585\n 4 Kansas                                      5                      9383\n 5 Wisconsin                                  40                     65390\n 6 Massachusetts                               6                      5408\n 7 California                                 65                    185181\n 8 Arizona                                    23                     78269\n 9 Washington                                 19                     75112\n10 Minnesota                                  28                     40693\n# ℹ 36 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_prison_pop %>% \n  left_join(x=.,\n            y=df_mental_health_state,\n            by='state') %>% \n  ggplot(.,\n         aes(x=prisonpop_2023_derived,\n             y=ttl_mental_health_professionals)) + \n  geom_point() + \n  geom_smooth(method='lm', se=FALSE) + \n  ggrepel::geom_text_repel(aes(label = state),\n                           box.padding = .5) + \n    scale_x_continuous(labels = scales::comma) + \n  scale_y_continuous(labels = scales::comma) + \n  theme_american_inequality_map()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 7 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 7 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 7 rows containing missing values or values outside the scale range\n(`geom_text_repel()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: ggrepel: 34 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n\n# Federal Bureau of Prisons \n\nThe Federal Bureau of Prisons has the largest population in this dataset, so I'll need to find a way to assign this population to individual states. I found the BOP inmate population by facility on the [bop.gov/ website](https://www.bop.gov/about/statistics/population_statistics.jsp#old_pops), so I've brought that in and summed the population numbers by state. I'll apply the percent from each state to the Federal BOP population and add that to the state.\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 187 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (2): X1, X2\ndbl (1): X3\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstates <- data.frame(\n  abbreviation = state.abb,\n  state_name = state.name,\n  stringsAsFactors = FALSE\n)\n\ndf_bop_grp <- df_bop_grp %>%\n  left_join(x=.,\n            y=states,\n            by=c('state' = 'abbreviation')) %>% \n  mutate(state_name = if_else(state == 'PR', 'Puerto Rico', state_name))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_map <- map_data(\"state\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/df_prisonpop2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_hpsa %>% \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 54,982\nColumns: 26\n$ discipline                                <fct> Primary Care, Primary Care, …\n$ hhs_region                                <fct> Region 2, Region 4, Region 5…\n$ state                                     <fct> New York, Kentucky, Illinois…\n$ county                                    <chr> \"Kings\", \"Knox\", \"Cook\", \"Di…\n$ hpsa_id                                   <chr> \"1369659769\", \"1219008521\", …\n$ hpsa_name                                 <chr> \"ME - Bushwick\", \"Trinity Fa…\n$ hpsa_score                                <int> 18, 19, 16, 21, 15, 15, 25, …\n$ hpsa_type_category                        <fct> Population Group, Facility, …\n$ hpsa_type_code                            <fct> Hpsa Pop, FQHC LAL, Hpsa Pop…\n$ hpsa_sub_type                             <fct> \"Medicaid Eligible Populatio…\n$ hpsa_status                               <fct> Designated, Designated, Desi…\n$ rural_status                              <fct> Non-Rural, Rural, Non-Rural,…\n$ hpsa_status_code                          <fct> D, D, D, D, D, D, D, D, D, D…\n$ designation_date                          <date> 2022-09-30, 2023-07-06, 201…\n$ last_update_date                          <date> 2022-09-30, 2023-07-06, 202…\n$ hpsa_designation_population               <dbl> 87167, 89994, 39782, 74606, …\n$ hpsa_component_id                         <chr> NA, \"1219008521\", NA, NA, \"7…\n$ hpsa_component_name                       <chr> \"Census Tract 419, Kings Cou…\n$ hpsa_component_type                       <fct> Census Tract, Unknown, Censu…\n$ hpsa_facility_address                     <chr> NA, \"14949 N Us Highway 25 E…\n$ hpsa_facility_city_and_state              <chr> NA, \"Corbin, KY\", NA, NA, \"T…\n$ hpsa_facility_zip_code                    <chr> NA, \"40701-6285\", NA, NA, \"6…\n$ proper_county_name_and_state_abbreviation <chr> \"Kings County, NY\", \"Knox Co…\n$ as_of_date_close_of_business_date         <date> NA, NA, NA, NA, NA, NA, NA,…\n$ hrsa_data_warehouse_processing_date       <date> 2024-11-07, 2024-11-07, 202…\n$ zip_cleaned                               <chr> NA, \"40701\", NA, NA, \"67879\"…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_hpsa %>% \n  diagnose()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 26 × 6\n   variables        types missing_count missing_percent unique_count unique_rate\n   <chr>            <chr>         <int>           <dbl>        <int>       <dbl>\n 1 discipline       fact…             0               0            3   0.0000546\n 2 hhs_region       fact…             0               0           10   0.000182 \n 3 state            fact…             0               0           59   0.00107  \n 4 county           char…             0               0         1965   0.0357   \n 5 hpsa_id          char…             0               0        21149   0.385    \n 6 hpsa_name        char…             0               0         9645   0.175    \n 7 hpsa_score       inte…             0               0           27   0.000491 \n 8 hpsa_type_categ… fact…             0               0            3   0.0000546\n 9 hpsa_type_code   fact…             0               0           10   0.000182 \n10 hpsa_sub_type    fact…             0               0           21   0.000382 \n# ℹ 16 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Exploratory Data Analysis\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_mental_health %>% \n  ggplot(.,\n         aes(x=count_mental_health_professionals,\n             y=sum_hpsa_designated_population)) + \n  geom_point() + \n  scale_x_continuous(breaks = scales::pretty_breaks()) + \n  scale_y_continuous(breaks = scales::pretty_breaks(),\n                     labels = scales::comma) + \n  theme_american_inequality_map()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n\n# Sandbox\n\n## Zip code analysis \n\n\n\n\n\n# Conclusion \n\n\nThis post demonstrates how to:\n\n*  Take control of `ggplot2` and its aesthetic elements\n*  Use the `sf::` package to pull in state boundaries and apply them as a layer to a map\n*  Use `patchwork::inset_element()` to overlay plots with full control\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}